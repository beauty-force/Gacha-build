import{c as s,o,b as c,d as C,r as g,a as p,w as x,i as f,n as v,e as y,t as _,F as w,f as k,h as P,l as b,g as D}from"./app--y6khcIC.js";import{A as I}from"./UserLayout-BdGQBedL.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{b as R,r as B,a as E}from"./ChevronRightIcon-BkjopzC-.js";import{r as j}from"./ChevronLeftIcon-C8D4FV6S.js";import"./useConfirm-BC6buQP1.js";import"./index-d_QLtXK2.js";function H(e,n){return o(),s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[c("path",{"fill-rule":"evenodd",d:"M12.53 16.28a.75.75 0 0 1-1.06 0l-7.5-7.5a.75.75 0 0 1 1.06-1.06L12 14.69l6.97-6.97a.75.75 0 1 1 1.06 1.06l-7.5 7.5Z","clip-rule":"evenodd"})])}function V(e,n){return o(),s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[c("path",{"fill-rule":"evenodd",d:"M11.47 7.72a.75.75 0 0 1 1.06 0l7.5 7.5a.75.75 0 1 1-1.06 1.06L12 9.31l-6.97 6.97a.75.75 0 0 1-1.06-1.06l7.5-7.5Z","clip-rule":"evenodd"})])}const z={components:{Head:C.Head,Link:C.Link,UserLayout:I,ChevronLeftIcon:j,ChevronRightIcon:E,ChevronDoubleLeftIcon:B,ChevronDoubleRightIcon:R,ChevronDownIcon:H,ChevronUpIcon:V},props:{notifications:[Array,Object],unreadCount:Number,personalUnreadCount:{type:Number,default:0},announcementUnreadCount:{type:Number,default:0},activeTab:{type:String,default:"personal"}},data(){return{expandedMessages:{},localPersonalUnreadCount:0,localAnnouncementUnreadCount:0,localUnreadCount:0}},mounted(){this.localPersonalUnreadCount=this.personalUnreadCount||0,this.localAnnouncementUnreadCount=this.announcementUnreadCount||0,this.localUnreadCount=this.unreadCount||0,window.addEventListener("pageshow",this.handlePageShow)},beforeUnmount(){window.removeEventListener("pageshow",this.handlePageShow)},computed:{filteredNotifications(){return this.notifications&&this.notifications.data?this.notifications.data:Array.isArray(this.notifications)?this.notifications:[]},hasUnread(){return this.filteredNotifications.some(e=>!e.is_read)},paginationLinks(){if(!this.notifications||!this.notifications.links)return[];const e=this.notifications.links.filter((u,l)=>l>0&&l<this.notifications.links.length-1),n=this.notifications.current_page||1,t=this.notifications.last_page||1,h=5;if(t<=h)return e;const d=2;let a=Math.max(1,n-d),m=Math.min(t,n+d);n<=d+1?(a=1,m=Math.min(h,t)):n>=t-d&&(a=Math.max(1,t-h+1),m=t);const i=[];return a>1&&i.push({url:null,label:"...",active:!1}),e.forEach(u=>{const l=parseInt(u.label);!isNaN(l)&&l>=a&&l<=m&&i.push(u)}),m<t&&i.push({url:null,label:"...",active:!1}),i},pageUnreadNotificationCount(){return C.usePage().props.value.unreadNotificationCount||0}},watch:{pageUnreadNotificationCount:function(e){},personalUnreadCount:function(e){this.localPersonalUnreadCount=e||0},announcementUnreadCount:function(e){this.localAnnouncementUnreadCount=e||0},unreadCount:function(e){this.localUnreadCount=e||0}},methods:{getDisplayDate(e){return e.published_at?e.published_at:e.created_at},formatDate(e){const n=new Date(e),t=n.getFullYear(),h=String(n.getMonth()+1).padStart(2,"0"),d=String(n.getDate()).padStart(2,"0"),a=String(n.getHours()).padStart(2,"0"),m=String(n.getMinutes()).padStart(2,"0");return`${t}/${h}/${d} ${a}:${m}`},getTypeLabel(e){if(!e)return"";const n=String(e).replace(/([a-z])([A-Z])/g,"$1_$2").replace(/[\s-]+/g,"_").toLowerCase();return{announcement:"お知らせ",maintenance:"メンテナンス",event:"イベント",campaign:"キャンペーン",important:"重要",coin_charge:"ポイントチャージ",shipping_request:"発送依頼",product_shipped:"発送完了"}[n]||e},getTruncatedMessage(e,n){if(!e)return"";const t=100;return this.expandedMessages[n]||e.length<=t?e:e.replace(/\n/g," ").substring(0,t)+"..."},toggleExpand(e){this.expandedMessages[e]=!this.expandedMessages[e],this.expandedMessages[e]&&this.markAsRead(e)},markAsRead(e){const n=this.filteredNotifications.find(u=>u.id===e);if(!n||n.is_read)return;const t=C.usePage().props.value,h=t.unreadNotificationCount||0,d=this.localPersonalUnreadCount,a=this.localAnnouncementUnreadCount,m=this.localUnreadCount;n.is_read=!0;const i=Math.max(0,h-1);h>0&&(t.unreadNotificationCount=i),this.activeTab==="personal"?this.localPersonalUnreadCount=Math.max(0,this.localPersonalUnreadCount-1):this.localAnnouncementUnreadCount=Math.max(0,this.localAnnouncementUnreadCount-1),this.localUnreadCount=Math.max(0,this.localUnreadCount-1),D.post(route("user.notifications.read",e)).then(u=>{if(u.data.success){const l=u.data;t.unreadNotificationCount=l.unreadNotificationCount||0,this.localPersonalUnreadCount=l.personalUnreadCount||0,this.localAnnouncementUnreadCount=l.announcementUnreadCount||0,this.localUnreadCount=(l.personalUnreadCount||0)+(l.announcementUnreadCount||0)}}).catch(u=>{n.is_read=!1,t.unreadNotificationCount=h,this.localPersonalUnreadCount=d,this.localAnnouncementUnreadCount=a,this.localUnreadCount=m,console.error("Error marking notification as read:",u)})},shouldShowReadMore(e){return e?e.length>100:!1},addTabToUrl(e){if(!e||!this.activeTab)return e;try{const n=new URL(e,window.location.origin);return n.searchParams.set("tab",this.activeTab),n.pathname+n.search}catch{const t=e.includes("?")?"&":"?";return e+t+"tab="+this.activeTab}},goBack(){window.history.back()},handlePageShow(e){e.persisted}}},F={class:"py-4 md:px-6 px-4 text-neutral-700"},Z={class:"flex border-b border-neutral-200 mb-4 font-semibold font-[mplus2]"},O={key:0,class:"bg-red-500 text-white text-xs font-bold rounded-full px-2 py-0.5 min-w-[20px] text-center"},W={key:0,class:"bg-red-500 text-white text-xs font-bold rounded-full px-2 py-0.5 min-w-[20px] text-center"},q={key:0,class:"space-y-4"},Y=["onClick"],G={class:"flex justify-between items-start"},J={class:"flex-1"},K={class:"text-xs text-neutral-500 mb-1 flex items-center gap-2"},Q={key:0,class:"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-neutral-100 text-neutral-600"},X={class:"text-sm text-neutral-700",style:{"white-space":"pre-line"}},$=["onClick","title"],ee={key:0,class:"ml-2 w-2 h-2 bg-yellow-500 rounded-full flex-shrink-0"},te={key:1,class:"text-center py-12"},ne={key:2,class:"mt-4 flex flex-col sm:flex-row justify-between items-center gap-3 px-3 lg:px-4"},ae={class:"text-sm text-gray-600 font-medium"},oe={class:"font-bold text-gray-900"},re={class:"flex items-center gap-0.5 md:gap-1"},se={key:1,class:"px-1 md:px-2 text-gray-400 text-xs md:text-sm"},ie={key:3,class:"mt-6 text-center"};function le(e,n,t,h,d,a){const m=g("Head"),i=g("Link"),u=g("ChevronDownIcon"),l=g("ChevronUpIcon"),L=g("ChevronDoubleLeftIcon"),T=g("ChevronLeftIcon"),N=g("ChevronRightIcon"),M=g("ChevronDoubleRightIcon"),A=g("UserLayout");return o(),s(w,null,[p(m,{title:"通知"}),p(A,null,{default:x(()=>[c("div",F,[c("div",Z,[p(i,{href:e.route("user.notifications",{tab:"personal"}),class:v(["px-4 py-2 border-b-2 transition-colors flex items-center gap-2",t.activeTab==="personal"?"border-yellow-500 text-yellow-600":"border-transparent text-neutral-500 hover:text-neutral-700"])},{default:x(()=>[n[0]||(n[0]=y(" あなたへの通知 ",-1)),t.personalUnreadCount>0?(o(),s("span",O,_(t.personalUnreadCount),1)):f("",!0)]),_:1},8,["href","class"]),p(i,{href:e.route("user.notifications",{tab:"announcement"}),class:v(["px-4 py-2 border-b-2 transition-colors flex items-center gap-2",t.activeTab==="announcement"?"border-yellow-500 text-yellow-600":"border-transparent text-neutral-500 hover:text-neutral-700"])},{default:x(()=>[n[1]||(n[1]=y(" お知らせ ",-1)),d.localAnnouncementUnreadCount>0?(o(),s("span",W,_(d.localAnnouncementUnreadCount),1)):f("",!0)]),_:1},8,["href","class"])]),a.filteredNotifications.length>0?(o(),s("div",q,[(o(!0),s(w,null,k(a.filteredNotifications,r=>(o(),s("div",{key:r.id,onClick:U=>a.markAsRead(r.id),class:v(["block p-4 rounded-lg border transition-colors cursor-pointer hover:shadow-md",r.is_read?"bg-white border-neutral-200":"bg-yellow-50 border-yellow-200"])},[c("div",G,[c("div",J,[c("p",K,[c("span",null,_(a.formatDate(a.getDisplayDate(r))),1),a.getTypeLabel(r.type)?(o(),s("span",Q,_(a.getTypeLabel(r.type)),1)):f("",!0)]),c("p",X,_(a.getTruncatedMessage(r.message,r.id)),1),a.shouldShowReadMore(r.message)?(o(),s("button",{key:0,onClick:P(U=>a.toggleExpand(r.id),["stop","prevent"]),class:"inline-flex items-center justify-center mt-2 p-1.5 rounded-full text-yellow-600 hover:text-yellow-700 hover:bg-yellow-100 transition-colors",title:d.expandedMessages[r.id]?"折りたたむ":"続きを読む"},[d.expandedMessages[r.id]?(o(),b(l,{key:1,class:"w-5 h-5"})):(o(),b(u,{key:0,class:"w-5 h-5"}))],8,$)):f("",!0)]),r.is_read?f("",!0):(o(),s("div",ee))])],10,Y))),128))])):(o(),s("div",te,[...n[2]||(n[2]=[c("p",{class:"text-neutral-500"},"通知はありません",-1)])])),t.notifications&&a.filteredNotifications.length>0?(o(),s("div",ne,[c("div",ae,[y(_(t.notifications.from)+" - "+_(t.notifications.to)+" / ",1),c("span",oe,_(t.notifications.total),1),n[3]||(n[3]=y("件 ",-1))]),c("div",re,[t.notifications.current_page>1?(o(),b(i,{key:0,href:a.addTabToUrl(t.notifications.first_page_url),class:"px-1 py-1 md:px-2 md:py-1.5 rounded text-xs md:text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors font-medium",title:"最初"},{default:x(()=>[p(L,{class:"w-3 h-3 md:w-4 md:h-4"})]),_:1},8,["href"])):f("",!0),t.notifications.prev_page_url?(o(),b(i,{key:1,href:a.addTabToUrl(t.notifications.prev_page_url),class:"px-1 py-1 md:px-2 md:py-1.5 rounded text-xs md:text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors font-medium"},{default:x(()=>[p(T,{class:"w-3 h-3 md:w-4 md:h-4"})]),_:1},8,["href"])):f("",!0),(o(!0),s(w,null,k(a.paginationLinks,(r,U)=>(o(),s(w,{key:U},[r.url?(o(),b(i,{key:0,href:a.addTabToUrl(r.url),class:v({"px-2 py-0.5 md:px-3 md:py-1 rounded text-xs md:text-sm font-semibold transition-colors":!0,"bg-yellow-500 text-white shadow-md":r.active,"bg-gray-200 text-gray-700 hover:bg-gray-300":!r.active})},{default:x(()=>[y(_(r.label),1)]),_:2},1032,["href","class"])):(o(),s("span",se,"..."))],64))),128)),t.notifications.next_page_url?(o(),b(i,{key:2,href:a.addTabToUrl(t.notifications.next_page_url),class:"px-1 py-1 md:px-2 md:py-1.5 rounded text-xs md:text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors font-medium"},{default:x(()=>[p(N,{class:"w-3 h-3 md:w-4 md:h-4"})]),_:1},8,["href"])):f("",!0),t.notifications.current_page<t.notifications.last_page?(o(),b(i,{key:3,href:a.addTabToUrl(t.notifications.last_page_url),class:"px-1 py-1 md:px-2 md:py-1.5 rounded text-xs md:text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors font-medium",title:"最後"},{default:x(()=>[p(M,{class:"w-3 h-3 md:w-4 md:h-4"})]),_:1},8,["href"])):f("",!0)])])):f("",!0),a.filteredNotifications.length>0&&a.hasUnread?(o(),s("div",ie,[p(i,{href:e.route("user.notifications.read-all"),method:"post",data:{tab:t.activeTab},as:"button",class:"inline-block px-6 py-2 bg-neutral-200 text-neutral-700 rounded-md text-sm font-medium hover:bg-neutral-300 transition-colors"},{default:x(()=>[...n[4]||(n[4]=[y(" すべて既読にする ",-1)])]),_:1},8,["href","data"])])):f("",!0)])]),_:1})],64)}const pe=S(z,[["render",le]]);export{pe as default};
