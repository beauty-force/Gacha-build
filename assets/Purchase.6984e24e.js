import{o as a,c as i,d as o,H as M,L as C,a as P,u as S,r as f,b as k,w as L,F as T,i as j,h as d,t as w,J as N,a2 as O,e as v,I as E,n as y}from"./app.ce20f14e.js";import{A as I}from"./UserLayout.360aff18.js";import{u as R}from"./useConfirm.801861ec.js";import{_ as V}from"./_plugin-vue_export-helper.cdc0426e.js";import"./Category.033ffe07.js";import"./index.de84a7b8.js";function B(n,e){return a(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})])}const H=3,D="merchant.com.eve-gacha",U="apple-pay-button",J=route("apple_pay_validate"),{confirm:_e,alert:c}=R(),z={components:{Head:M,AdminLayout:I,Link:C,ArrowLeftIcon:B},props:{errors:Object,auth:Object,point:Object,is_admin:Number,amount:Number,amount_str:String,testOrLive:String,supported_pay_type:Object,rank:Object,coupon_id:Number,no_applepay_support:String,no_applepay_setting:String},data(){return{selectedMethod:null,agreeTerms:!1,loading:!1,card_payment_uri:"user.point.card_payment",payment_stage:"register"}},methods:{selectPaymentMethod(n){this.selectedMethod=n},handleSubmit(){if(console.log(this.selectedMethod),!this.selectedMethod){c("\u652F\u6255\u3044\u65B9\u6CD5\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044");return}if(!this.agreeTerms){c("\u500B\u4EBA\u60C5\u5831\u306E\u53D6\u308A\u6271\u3044\u306B\u540C\u610F\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059");return}if(!this.supported_pay_type.includes(this.selectedMethod)){c("\u3053\u306E\u652F\u6255\u3044\u65B9\u6CD5\u306F\u8FD1\u3005\u5B9F\u88C5\u3055\u308C\u308B\u4E88\u5B9A\u3067\u3059\u3002");return}if(this.selectedMethod=="Applepay"&&!window.ApplePaySession){c(this.no_applepay_support,"","error");return}this.paymentRegister(this.selectedMethod)},submit(){},format_number(n){return String(n).replace(/(.)(?=(\d{3})+$)/g,"$1,")},paymentRegister(n){if(this.loading=!0,n=="Card"){window.location.href=route(this.card_payment_uri,{id:this.point.id,coupon_id:this.coupon_id});return}P.post(this.is_admin==1?route("test.user.point.paymentRegister"):route("user.point.paymentRegister"),{id:this.point.id,pay_type:n,coupon_id:this.coupon_id}).then(e=>{e.data.status==0?c(e.data.message):n=="Card"||n=="Paypay"||n=="Konbini"||n=="Virtualaccount"?e.data.status&&(window.location.href=e.data.link_url):n=="Applepay"&&(this.loading=!1,this.payment_stage="Applepay",this.$nextTick(()=>{const s=document.getElementById("applepay_container");s.innerHTML="",window.ApplePaySession?ApplePaySession.canMakePaymentsWithActiveCard(D).then(t=>{if(t){const r=document.createElement("button");r.setAttribute("id",U),r.setAttribute("lang","ja-JP");const m="buy",b="#d68d2f";r.setAttribute("style",`-webkit-appearance: -apple-pay-button;
                                                -apple-pay-button-type: ${m};
                                                -apple-pay-button-style: ${b};
                                                width: 220px;
                                                height: 48px;
                                                text-align: center;
                                                font-size: 18px;
                                                border-radius: 5px;
                                                `),s.appendChild(r),r.addEventListener("click",x=>{const l={countryCode:"JP",currencyCode:"JPY",supportedNetworks:["visa","masterCard","jcb","amex"],merchantCapabilities:["supports3DS"],total:{label:e.data.response.label,amount:e.data.response.amount}},p=new ApplePaySession(H,l);p.onvalidatemerchant=h=>{const _=h.validationURL;fetch(J,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({validationURL:_})}).then(u=>u.json()).then(u=>{p.completeMerchantValidation(u)})},p.oncancel=h=>{},p.onpaymentauthorized=h=>{const _=h.payment.token;p.completePayment(ApplePaySession.STATUS_SUCCESS);const u=btoa(JSON.stringify(_.paymentData));P.post(this.is_admin==1?route("test.user.point.paymentExecute"):route("user.point.paymentExecute"),{pay_type:n,order_id:e.data.response.id,access_id:e.data.response.access_id,token:u}).then(g=>{g.data.status==0?c(g.data.message):window.location.href=route(g.data.redirect_uri)})},p.begin()})}else s.innerHTML=this.no_applepay_setting}):s.innerHTML=this.no_applepay_support})),this.loading=!1})}},mounted(){var n;((n=S().props.value.auth.user)==null?void 0:n.type)==1&&(this.card_payment_uri="test.user.point.card_payment")}},K={class:"flex justify-center items-center flex-1 bg-white py-2"},F={class:"text-center"},Y={class:"p-6 w-full max-w-md"},q={key:0},W={class:"text-center text-xl font-semibold text-gray-800 mb-7"},G={key:0,class:"text-rose-500 leading-8 text-base"},Q={class:"bg-gray-100 p-4 text-xl text-center mb-4"},X={class:"text-center text-gray-600 mb-4 py-4"},Z={class:"flex items-center justify-center leading-7 gap-2"},$=["href"],ee={key:0,class:"mb-4"},te={key:1,class:"mb-4"},oe={key:2,class:"mb-4"},ne={key:3,class:"mb-4"},se={key:4,class:"mb-4"},re=["disabled"],ae={key:2,class:"fixed inset-0 flex justify-center items-center bg-gray-800 bg-opacity-75 z-[20]"},ie=o("div",{class:"w-16 h-16 bg-white p-4 rounded-full shadow-lg"},[o("svg",{class:"animate-spin h-8 w-8 text-yellow-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})])],-1),le=[ie],de={key:3,class:"text-center mt-3",id:"applepay_container"};function pe(n,e,s,A,t,r){const m=f("Head"),b=f("ArrowLeftIcon"),x=f("AdminLayout");return a(),i(T,null,[k(m,{title:"\u6C7A\u6E08\u767B\u9332"}),k(x,null,{default:L(()=>[o("div",K,[o("div",F,[t.payment_stage!="register"?(a(),j(b,{key:0,onClick:e[0]||(e[0]=l=>t.payment_stage="register"),class:"absolute left-2 top-10 text-neutral-600 w-8 p-1.5 hover:bg-yellow-500 hover:text-white rounded-full cursor-pointer"})):d("",!0)]),o("div",Y,[t.payment_stage=="register"?(a(),i("div",q,[o("h2",W,[o("div",null,w(r.format_number(s.point.point))+" \u30DD\u30A4\u30F3\u30C8\u8CFC\u5165",1),s.rank&&s.rank.pt_rate>0?(a(),i("span",G," ( + "+w(r.format_number(s.point.point*s.rank.pt_rate/100))+" \u30DC\u30FC\u30CA\u30B9 ) ",1)):d("",!0)]),o("div",Q," \xA5 "+w(s.amount_str),1),o("div",X,[o("label",Z,[N(o("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=l=>t.agreeTerms=l),class:"focus:ring-0 rounded-sm"},null,512),[[O,t.agreeTerms]]),v(" \u500B\u4EBA\u60C5\u5831\u306E\u53D6\u308A\u6271\u3044\u306B\u540C\u610F\u3059\u308B ")]),v(" \uFF08 "),o("a",{href:n.route("main.privacy_police"),class:"text-yellow-500 hover:text-yellow-600"},"\u53D6\u308A\u6271\u3044\u306E\u8A73\u7D30\u3092\u78BA\u8A8D\u3059\u308B",8,$),v(" \uFF09 ")])])):d("",!0),t.payment_stage=="register"?(a(),i("form",{key:1,onSubmit:e[7]||(e[7]=E((...l)=>r.handleSubmit&&r.handleSubmit(...l),["prevent"]))},[s.supported_pay_type.includes("Card")?(a(),i("div",ee,[o("button",{type:"button",onClick:e[2]||(e[2]=l=>r.selectPaymentMethod("Card")),class:y([{"border-yellow-500 bg-yellow-100 font-bold text-yellow-500":t.selectedMethod==="Card","hover:bg-gray-100 hover:border-gray-300":t.selectedMethod!=="Card"},"w-full p-4 bg-white border-2 border-gray-200 rounded-lg flex justify-center items-center transition duration-200 hover:-translate-y-0.5"])}," \u30AF\u30EC\u30B8\u30C3\u30C8\u30AB\u30FC\u30C9 ",2)])):d("",!0),s.supported_pay_type.includes("Applepay")?(a(),i("div",te,[o("button",{type:"button",onClick:e[3]||(e[3]=l=>r.selectPaymentMethod("Applepay")),class:y([{"border-yellow-500 bg-yellow-100 font-bold text-yellow-500":t.selectedMethod==="Applepay","hover:bg-gray-100 hover:border-gray-300":t.selectedMethod!=="Applepay"},"w-full p-4 bg-white border-2 border-gray-200 rounded-lg flex justify-center items-center transition duration-200 hover:-translate-y-0.5"])}," Apple Pay ",2)])):d("",!0),s.supported_pay_type.includes("Paypay")?(a(),i("div",oe,[o("button",{type:"button",onClick:e[4]||(e[4]=l=>r.selectPaymentMethod("Paypay")),class:y([{"border-yellow-500 bg-yellow-100 font-bold text-yellow-500":t.selectedMethod==="Paypay","hover:bg-gray-100 hover:border-gray-300":t.selectedMethod!=="Paypay"},"w-full p-4 bg-white border-2 border-gray-200 rounded-lg flex justify-center items-center transition duration-200 hover:-translate-y-0.5"])}," PayPay ",2)])):d("",!0),s.supported_pay_type.includes("Konbini")?(a(),i("div",ne,[o("button",{type:"button",onClick:e[5]||(e[5]=l=>r.selectPaymentMethod("Konbini")),class:y([{"border-yellow-500 bg-yellow-100 font-bold text-yellow-500":t.selectedMethod==="Konbini","hover:bg-gray-100 hover:border-gray-300":t.selectedMethod!=="Konbini"},"w-full p-4 bg-white border-2 border-gray-200 rounded-lg flex justify-center items-center transition duration-200 hover:-translate-y-0.5"])}," \u30B3\u30F3\u30D3\u30CB\u6255\u3044 ",2)])):d("",!0),s.supported_pay_type.includes("Virtualaccount")?(a(),i("div",se,[o("button",{type:"button",onClick:e[6]||(e[6]=l=>r.selectPaymentMethod("Virtualaccount")),class:y([{"border-yellow-500 bg-yellow-100 font-bold text-yellow-500":t.selectedMethod==="Virtualaccount","hover:bg-gray-100 hover:border-gray-300":t.selectedMethod!=="Virtualaccount"},"w-full p-4 bg-white border-2 border-gray-200 rounded-lg flex justify-center items-center transition duration-200 hover:-translate-y-0.5"])}," \u9280\u884C\u632F\u8FBC ",2)])):d("",!0),o("button",{type:"submit",disabled:t.selectedMethod==null,class:"w-full p-4 bg-yellow-500 text-white rounded-lg text-lg font-semibold transition duration-200 hover:bg-yellow-600 mt-4"}," \u652F\u6255\u3044 ",8,re)],32)):d("",!0),t.loading?(a(),i("div",ae,le)):d("",!0),t.payment_stage=="Applepay"?(a(),i("div",de)):d("",!0)])])]),_:1})],64)}const ge=V(z,[["render",pe]]);export{ge as default};
