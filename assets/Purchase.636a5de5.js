import{o as s,c as r,d as t,H as N,L as j,a as A,u as L,r as C,b as M,w as E,F as T,i as I,h as c,t as w,J as B,a2 as R,e as S,I as z,f as O,n as D}from"./app.2859992f.js";import{A as V}from"./UserLayout.cb87064d.js";import{u as G}from"./useConfirm.5a652704.js";import{_ as J}from"./_plugin-vue_export-helper.cdc0426e.js";import"./index.672efbf3.js";function H(e,a){return s(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})])}const U=3,Y="merchant.com.eve-gacha",q="apple-pay-button",F=route("apple_pay_validate"),{confirm:Ee,alert:y}=G(),K={components:{Head:N,AdminLayout:V,Link:j,ArrowLeftIcon:H},props:{errors:Object,auth:Object,point:Object,is_admin:Number,amount:Number,amount_str:String,supported_pay_type:Object,rank:Object,coupon_id:Number,no_applepay_support:String,no_applepay_setting:String},data(){return{selectedMethod:null,agreeTerms:!1,loading:!1,card_payment_uri:"user.point.card_payment",payment_stage:"register",pay_type_titles:{Card:"\u30AF\u30EC\u30B8\u30C3\u30C8\u30AB\u30FC\u30C9",Paypay:"PayPay",Konbini:"\u30B3\u30F3\u30D3\u30CB\u6255\u3044",Virtualaccount:"\u9280\u884C\u632F\u8FBC",Applepay:"Apple Pay",amazonpay:"Amazon Pay",Googlepay:"Google Pay"}}},methods:{selectPaymentMethod(e){this.selectedMethod=e},handleSubmit(){if(!this.selectedMethod){y("\u652F\u6255\u3044\u65B9\u6CD5\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044");return}if(!this.agreeTerms){y("\u500B\u4EBA\u60C5\u5831\u306E\u53D6\u308A\u6271\u3044\u306B\u540C\u610F\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059");return}if(!this.supported_pay_type.includes(this.selectedMethod)){y("\u3053\u306E\u652F\u6255\u3044\u65B9\u6CD5\u306F\u8FD1\u3005\u5B9F\u88C5\u3055\u308C\u308B\u4E88\u5B9A\u3067\u3059\u3002");return}if(this.selectedMethod=="Applepay"&&!window.ApplePaySession){y(this.no_applepay_support,"","error");return}this.paymentRegister(this.selectedMethod)},submit(){},format_number(e){return String(e).replace(/(.)(?=(\d{3})+$)/g,"$1,")},paymentRegister(e){if(this.loading=!0,e=="Card"){window.location.href=route(this.card_payment_uri,{id:this.point.id,coupon_id:this.coupon_id});return}A.post(this.is_admin==1?route("test.user.point.paymentRegister"):route("user.point.paymentRegister"),{id:this.point.id,pay_type:e,coupon_id:this.coupon_id}).then(a=>{if(a.data.status==0)y(a.data.message);else if(e=="Card"||e=="Paypay"||e=="Konbini"||e=="Virtualaccount")a.data.status&&(window.location.href=a.data.link_url);else if(e=="Applepay")this.payment_stage="Applepay",this.$nextTick(()=>{const n=document.getElementById("applepay_container");n.innerHTML="",window.ApplePaySession?ApplePaySession.canMakePaymentsWithActiveCard(Y).then(i=>{if(i){const l=document.createElement("button");l.setAttribute("id",q),l.setAttribute("lang","ja-JP");const b="buy",f="#d68d2f";l.setAttribute("style",`-webkit-appearance: -apple-pay-button;
                                                -apple-pay-button-type: ${b};
                                                -apple-pay-button-style: ${f};
                                                width: 220px;
                                                height: 48px;
                                                text-align: center;
                                                font-size: 18px;
                                                border-radius: 5px;
                                                `),n.appendChild(l),l.addEventListener("click",k=>{const o={countryCode:"JP",currencyCode:"JPY",supportedNetworks:["visa","masterCard","jcb","amex"],merchantCapabilities:["supports3DS"],total:{label:a.data.response.label,amount:a.data.response.amount}},p=new ApplePaySession(U,o);p.onvalidatemerchant=m=>{const _=m.validationURL;fetch(F,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({validationURL:_})}).then(u=>u.json()).then(u=>{p.completeMerchantValidation(u)})},p.oncancel=m=>{},p.onpaymentauthorized=m=>{const _=m.payment.token;p.completePayment(ApplePaySession.STATUS_SUCCESS);const u=btoa(JSON.stringify(_.paymentData));A.post(this.is_admin==1?route("test.user.point.paymentExecute"):route("user.point.paymentExecute"),{pay_type:e,order_id:a.data.response.id,access_id:a.data.response.access_id,token:u}).then(h=>{h.data.status==0?y(h.data.message):window.location.href=h.data.redirect_uri})},p.begin()})}else n.innerHTML=this.no_applepay_setting}):n.innerHTML=this.no_applepay_support});else if(e=="Googlepay"){const n=document.createElement("script");n.src="https://pay.google.com/gp/p/js/pay.js",n.onload=this.renderGooglePayButton.bind(this,a.data.response),document.head.appendChild(n)}else if(e=="amazonpay"){this.payment_stage="amazonpay";const n=document.createElement("script");n.src="https://static-fe.payments-amazon.com/checkout.js",n.onload=this.renderAmazonPayButton.bind(this,a.data.response),document.head.appendChild(n)}this.loading=!1})},renderAmazonPayButton(e){this.loading=!1,amazon.Pay.renderButton("#amazonpay_container",{merchantId:e.merchant_id,publicKeyId:e.public_key_id,ledgerCurrency:"JPY",checkoutLanguage:"ja_JP",productType:"PayOnly",placement:"Checkout",buttonColor:"Gold",buttonWidth:"300px",buttonHeight:"50px",createCheckoutSessionConfig:{payloadJSON:JSON.stringify(e.payload),signature:e.signature,algorithm:"AMZN-PAY-RSASSA-PSS-V2"}})},renderGooglePayButton(e){this.loading=!1,this.payment_stage="Googlepay";const a=new google.payments.api.PaymentsClient({environment:e.google_pay_environment}),n={apiVersion:2,apiVersionMinor:0},P={type:"PAYMENT_GATEWAY",parameters:{gateway:"fincode",gatewayMerchantId:e.shop_id}},i={merchantId:e.google_pay_merchant_id,merchantName:e.google_pay_merchant_name},l=d=>({currencyCode:"JPY",totalPrice:d,totalPriceStatus:"FINAL"}),o={type:"CARD",parameters:{allowedAuthMethods:["PAN_ONLY"],allowedCardNetworks:["VISA","MASTERCARD","JCB","AMEX","DISCOVER"],billingAddressParameters:{format:"FULL",phoneNumberRequired:!0}}},p=Object.assign({tokenizationSpecification:P},o),m=Object.assign({},n);m.allowedPaymentMethods=[p],m.transactionInfo=l(e.amount),m.merchantInfo=i;const _=(d,g)=>{const v=a.createButton({onClick:g,buttonColor:"default",buttonType:"long"});d.appendChild(v)},u=async()=>{try{const g=(await a.loadPaymentData(m)).paymentMethodData.tokenizationData.token,v=btoa(g);this.loading=!0,A.post(this.is_admin==1?route("test.user.point.paymentExecute"):route("user.point.paymentExecute"),{pay_type:"Googlepay",order_id:e.id,access_id:e.access_id,method:"1",token:v}).then(x=>{x.data.status==0?y(x.data.message):window.location.href=x.data.redirect_uri,this.loading=!1})}catch(d){console.error(d)}},h=Object.assign({},n);h.allowedPaymentMethods=[o],a.isReadyToPay(h).then(d=>{if(d.result){const g=document.getElementById("googlepay_container");g.innerHTML="",_(g,u)}}).catch(d=>{console.error(d)})}},mounted(){var e;((e=L().props.value.auth.user)==null?void 0:e.type)==1&&(this.card_payment_uri="test.user.point.card_payment")}},W={class:"flex justify-center items-center flex-1 bg-white py-2 relative"},X={class:"text-center"},Z={class:"p-6 w-full max-w-md"},Q={key:0},$={class:"text-center text-xl font-semibold text-gray-800 mb-7"},ee={key:0,class:"text-rose-500 leading-8 text-base"},te={class:"bg-gray-100 p-4 text-xl text-center mb-4"},ne={class:"text-center text-gray-600 mb-4 py-4"},ae={class:"flex items-center justify-center leading-7 gap-2"},oe=["href"],se=["onClick"],ie={key:0,class:"grid grid-cols-3 grid-rows-2 gap-1 w-24 h-10"},re=t("img",{src:"/images/credit_cards/visa.svg",alt:"Visa"},null,-1),ce=t("img",{src:"/images/credit_cards/master.svg",alt:"Mastercard"},null,-1),le=t("img",{src:"/images/credit_cards/jcb.svg",alt:"JCB"},null,-1),de=t("img",{src:"/images/credit_cards/amex.svg",alt:"American Express"},null,-1),pe=t("img",{src:"/images/credit_cards/diners.svg",alt:"Diners Club"},null,-1),me=t("img",{src:"/images/credit_cards/discover.svg",alt:"Discover"},null,-1),ue=[re,ce,le,de,pe,me],ye={key:1,src:"/images/payments/amazon-pay.png",alt:"Amazon Pay",class:"w-24 h-10 object-contain"},he={key:2,src:"/images/payments/apple-pay.png",alt:"Apple Pay",class:"w-24 h-10 object-contain"},ge={key:3,src:"/images/payments/paypay.png",alt:"PayPay",class:"w-24 h-10 object-contain"},_e={key:4,src:"/images/payments/konbini.png",alt:"Konbini",class:"w-36 h-10 object-contain"},be={key:5,src:"/images/payments/bank.png",alt:"Bank Transfer",class:"w-24 h-10 object-contain"},fe={key:6,src:"/images/payments/google-pay.svg",alt:"Google Pay",class:"w-24 h-10 object-contain"},we=["disabled"],Pe={key:2,class:"fixed inset-0 flex justify-center items-center bg-gray-800 bg-opacity-75 z-[20]"},ke=t("div",{class:"w-16 h-16 bg-white p-4 rounded-full shadow-lg"},[t("svg",{class:"animate-spin h-8 w-8 text-yellow-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})])],-1),ve=[ke],xe={key:3,class:"text-center",id:"applepay_container"},Ae={key:4,class:"text-center",id:"amazonpay_container"},Ce={key:5,class:"text-center",id:"googlepay_container"};function Se(e,a,n,P,i,l){const b=C("Head"),f=C("ArrowLeftIcon"),k=C("AdminLayout");return s(),r(T,null,[M(b,{title:"\u6C7A\u6E08\u767B\u9332"}),M(k,null,{default:E(()=>[t("div",W,[t("div",X,[i.payment_stage!="register"?(s(),I(f,{key:0,onClick:a[0]||(a[0]=o=>i.payment_stage="register"),class:"text-neutral-600 w-8 p-1.5 hover:bg-yellow-500 hover:text-white rounded-full cursor-pointer"})):c("",!0)]),t("div",Z,[i.payment_stage=="register"?(s(),r("div",Q,[t("h2",$,[t("div",null,w(l.format_number(n.point.point))+" \u30DD\u30A4\u30F3\u30C8\u8CFC\u5165",1),n.rank&&n.rank.pt_rate>0?(s(),r("span",ee," ( + "+w(l.format_number(n.point.point*n.rank.pt_rate/100))+"pt \u30DC\u30FC\u30CA\u30B9 ) ",1)):c("",!0)]),t("div",te,w(n.amount_str)+"\u5186 ",1),t("div",ne,[t("label",ae,[B(t("input",{type:"checkbox","onUpdate:modelValue":a[1]||(a[1]=o=>i.agreeTerms=o),class:"focus:ring-0 rounded-sm"},null,512),[[R,i.agreeTerms]]),S(" \u500B\u4EBA\u60C5\u5831\u306E\u53D6\u308A\u6271\u3044\u306B\u540C\u610F\u3059\u308B ")]),S(" \uFF08 "),t("a",{href:e.route("main.privacy_police"),class:"text-yellow-500 hover:text-yellow-600"},"\u53D6\u308A\u6271\u3044\u306E\u8A73\u7D30\u3092\u78BA\u8A8D\u3059\u308B",8,oe),S(" \uFF09 ")])])):c("",!0),i.payment_stage=="register"?(s(),r("form",{key:1,onSubmit:a[2]||(a[2]=z((...o)=>l.handleSubmit&&l.handleSubmit(...o),["prevent"]))},[(s(!0),r(T,null,O(n.supported_pay_type,o=>(s(),r("div",{class:"mb-4",key:o},[t("button",{type:"button",onClick:p=>l.selectPaymentMethod(o),class:D([{"border-yellow-500 bg-yellow-100 font-bold text-yellow-500":i.selectedMethod===o,"hover:bg-gray-100 hover:border-gray-300":i.selectedMethod!==o},"w-full px-4 py-2.5 bg-white border-2 border-gray-200 rounded-lg flex justify-between items-center transition duration-200 hover:-translate-y-0.5"])},[t("span",null,w(i.pay_type_titles[o]),1),o==="Card"?(s(),r("div",ie,ue)):c("",!0),o==="amazonpay"?(s(),r("img",ye)):c("",!0),o==="Applepay"?(s(),r("img",he)):c("",!0),o==="Paypay"?(s(),r("img",ge)):c("",!0),o==="Konbini"?(s(),r("img",_e)):c("",!0),o==="Virtualaccount"?(s(),r("img",be)):c("",!0),o==="Googlepay"?(s(),r("img",fe)):c("",!0)],10,se)]))),128)),t("button",{type:"submit",disabled:i.selectedMethod==null,class:"w-full p-4 bg-yellow-500 text-white rounded-lg text-lg font-semibold transition duration-200 hover:bg-yellow-600 mt-4"}," \u652F\u6255\u3044 ",8,we)],32)):c("",!0),i.loading?(s(),r("div",Pe,ve)):c("",!0),i.payment_stage=="Applepay"?(s(),r("div",xe)):c("",!0),i.payment_stage=="amazonpay"?(s(),r("div",Ae)):c("",!0),i.payment_stage=="Googlepay"?(s(),r("div",Ce)):c("",!0)])])]),_:1})],64)}const Ie=J(K,[["render",Se]]);export{Ie as default};
