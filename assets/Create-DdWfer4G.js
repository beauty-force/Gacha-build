import{a7 as U,d as c,r as f,c as o,o as l,a as p,w as g,b as e,h as w,j as u,i as m,k as S,t as i,e as y,v as b,x,F as h,f as V,m as L,g as A}from"./app-DsZT8ZFb.js";import{A as C}from"./Admin-DmD77vfe.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useConfirm-IV4jvDvB.js";const Q={components:{Head:c.Head,AdminLayout:C,Link:c.Link},props:{tags:Array,ranks:Array,plans:Array},data(){return{userSearchQuery:"",searchResults:[],selectedUser:null}},methods:{submit(){if(this.form.target_type!=="all"&&!this.form.target_id){this.form.setError("target_id","ターゲットを選択してください");return}this.form.post(route("admin.notifications.store"))},searchUsers:U.debounce(function(){if(this.userSearchQuery.length<2){this.searchResults=[];return}A.get(route("admin.notifications.search-users"),{params:{q:this.userSearchQuery}}).then(a=>{this.searchResults=a.data}).catch(a=>{console.error("User search error:",a)})},300),selectUser(a){this.selectedUser=a,this.form.target_id=a.id,this.searchResults=[],this.userSearchQuery=""},clearUserSelection(){this.selectedUser=null,this.form.target_id=null}},setup(a){return{form:c.useForm({type:"お知らせ",message:"",target_type:"all",target_id:null,is_published:!1})}}},M={class:"py-2"},E={class:"max-w-7xl mx-auto sm:px-0 lg:px-2"},H={class:"bg-white"},N={class:"p-6 text-gray-900"},B={key:0,class:"text-red-500 text-sm mt-1"},F={key:0,class:"text-red-500 text-sm mt-1"},j={class:"space-y-2"},q={class:"flex items-center"},D={class:"flex items-center"},T={key:0,class:"ml-6 mt-2"},I={key:0,class:"mt-2 border border-gray-200 rounded-md max-h-40 overflow-y-auto"},z=["onClick"],G={key:1,class:"mt-2 p-2 bg-blue-50 rounded-md"},J={class:"text-sm"},K={key:0,class:"text-red-500 text-sm mt-1"},O={key:1,class:"text-red-500 text-sm mt-1"},P={for:"is_published",class:"flex items-center"},W={class:"flex items-center justify-end space-x-4"},X=["disabled"];function Y(a,s,Z,r,d,n){const _=f("Head"),v=f("Link"),k=f("AdminLayout");return l(),o(h,null,[p(_,{title:"お知らせ作成"}),p(k,null,{default:g(()=>[e("div",M,[e("div",E,[e("div",H,[e("div",N,[e("form",{onSubmit:s[8]||(s[8]=w((...t)=>n.submit&&n.submit(...t),["prevent"])),class:"space-y-6"},[e("div",null,[s[10]||(s[10]=e("label",{for:"type",class:"block text-sm font-medium text-gray-700"}," タイプ ",-1)),u(e("select",{id:"type","onUpdate:modelValue":s[0]||(s[0]=t=>r.form.type=t),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},[...s[9]||(s[9]=[e("option",{value:"お知らせ"},"お知らせ",-1),e("option",{value:"メンテナンス"},"メンテナンス",-1),e("option",{value:"イベント"},"イベント",-1),e("option",{value:"キャンペーン"},"キャンペーン",-1),e("option",{value:"重要"},"重要",-1)])],512),[[S,r.form.type]]),r.form.errors.type?(l(),o("div",B,i(r.form.errors.type),1)):m("",!0)]),e("div",null,[s[11]||(s[11]=e("label",{for:"message",class:"block text-sm font-medium text-gray-700"},[y(" メッセージ "),e("span",{class:"text-red-500"},"*")],-1)),u(e("textarea",{id:"message","onUpdate:modelValue":s[1]||(s[1]=t=>r.form.message=t),rows:"4",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:""},null,512),[[b,r.form.message]]),r.form.errors.message?(l(),o("div",F,i(r.form.errors.message),1)):m("",!0)]),e("div",null,[s[14]||(s[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[y(" 配信対象 "),e("span",{class:"text-red-500"},"*")],-1)),e("div",j,[e("label",q,[u(e("input",{type:"radio","onUpdate:modelValue":s[2]||(s[2]=t=>r.form.target_type=t),value:"all",class:"mr-2"},null,512),[[x,r.form.target_type]]),s[12]||(s[12]=e("span",null,"全ユーザー",-1))]),e("label",D,[u(e("input",{type:"radio","onUpdate:modelValue":s[3]||(s[3]=t=>r.form.target_type=t),value:"user",class:"mr-2"},null,512),[[x,r.form.target_type]]),s[13]||(s[13]=e("span",null,"特定のユーザー",-1))]),r.form.target_type==="user"?(l(),o("div",T,[u(e("input",{type:"text","onUpdate:modelValue":s[4]||(s[4]=t=>d.userSearchQuery=t),onInput:s[5]||(s[5]=(...t)=>n.searchUsers&&n.searchUsers(...t)),placeholder:"ユーザーを検索...",class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,544),[[b,d.userSearchQuery]]),d.searchResults.length>0?(l(),o("div",I,[(l(!0),o(h,null,V(d.searchResults,t=>(l(),o("div",{key:t.id,onClick:$=>n.selectUser(t),class:"p-2 hover:bg-gray-100 cursor-pointer"},i(t.name)+" ("+i(t.email)+") ",9,z))),128))])):m("",!0),d.selectedUser?(l(),o("div",G,[e("span",J,"選択中: "+i(d.selectedUser.name)+" ("+i(d.selectedUser.email)+")",1),e("button",{type:"button",onClick:s[6]||(s[6]=(...t)=>n.clearUserSelection&&n.clearUserSelection(...t)),class:"ml-2 text-red-600 text-sm"},"削除")])):m("",!0)])):m("",!0)]),r.form.errors.target_type?(l(),o("div",K,i(r.form.errors.target_type),1)):m("",!0),r.form.errors.target_id?(l(),o("div",O,i(r.form.errors.target_id),1)):m("",!0)]),e("div",null,[e("label",P,[u(e("input",{type:"checkbox",id:"is_published","onUpdate:modelValue":s[7]||(s[7]=t=>r.form.is_published=t),class:"mr-2"},null,512),[[L,r.form.is_published]]),s[15]||(s[15]=e("span",{class:"text-sm font-medium text-gray-700"},"公開する",-1))])]),e("div",W,[p(v,{href:a.route("admin.notifications.index"),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:g(()=>[...s[16]||(s[16]=[y(" キャンセル ",-1)])]),_:1},8,["href"]),e("button",{type:"submit",disabled:r.form.processing,class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50"},i(r.form.processing?"作成中...":"作成"),9,X)])],32)])])])])]),_:1})],64)}const oe=R(Q,[["render",Y]]);export{oe as default};
