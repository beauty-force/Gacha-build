import{d as k,p as y,s as q,q as V,l as E,o as l,w as _,a as w,b as e,u as o,$ as j,h as B,c as a,i as n,j as c,e as p,k as h,t as u,v as g}from"./app-0wH1KzxS.js";import{A as M}from"./Admin-_XCIzOae.js";import{s as C}from"./vue-multiselect-CIo8grwB.js";import"./useConfirm-DiRK4iAb.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const D={class:"py-2"},K={class:"max-w-7xl mx-auto sm:px-0 lg:px-2"},O={class:"bg-white"},P={class:"p-6 text-gray-900"},R={key:0,class:"text-red-500 text-sm mt-1"},F={key:0,class:"text-red-500 text-sm mt-1"},I={key:0,class:"text-red-500 text-sm mt-1"},z={class:"text-center w-full"},H=["src"],X={key:0,class:"text-red-500 text-sm mt-1"},$={key:0,class:"border p-4 rounded-lg bg-gray-50"},G={key:0,class:"text-red-500 text-sm mt-1"},J={key:1,class:"border p-4 rounded-lg bg-gray-50"},Q={key:0,class:"text-red-500 text-sm mt-1"},W={key:2,class:"border p-4 rounded-lg bg-gray-50"},Y={key:0,class:"text-red-500 text-sm mt-1"},Z={key:0,class:"text-red-500 text-sm mt-1"},tt={class:"flex items-center justify-end space-x-4"},et=["disabled"],at={__name:"Edit",props:{item:Object},setup(b){const m=b,s=k.useForm({type:m.item.type||"",name:m.item.name||"",description:m.item.description||"",image:null,status:m.item.status??1,meta:m.item.meta||{}}),f=y(null),L=y(null),N=y(null),d=y([]),x=()=>{s.type==="point_lottery"&&s.meta.points&&Array.isArray(s.meta.points)?d.value=s.meta.points.map(r=>({label:Number(r).toLocaleString(),value:Number(r)})).sort((r,t)=>r.value-t.value):d.value=[]},v=()=>{s.type==="point_lottery"&&(s.meta.points=d.value.map(r=>r.value))},T=r=>{r=parseInt(r),r&&r>0&&!d.value.find(t=>t.value===r)&&(d.value.push({label:Number(r).toLocaleString(),value:r}),d.value.sort((t,i)=>t.value-i.value),v())};q(()=>{N.value=m.item.type,x()}),V(()=>s.type,(r,t)=>{r==="point_lottery"?((!s.meta.points||!Array.isArray(s.meta.points))&&(s.meta.points=[]),x()):t==="point_lottery"&&r!=="point_lottery"&&(d.value=[])}),V(()=>d.value,()=>{v()},{deep:!0});const U=r=>{const t=r.target.files[0];t&&(f.value=URL.createObjectURL(t),s.image=t)},A=r=>{r.target.tagName!=="TEXTAREA"&&(r.target.closest(".multiselect")||r.preventDefault())},S=async()=>{s.type==="point_lottery"&&v(),s.post(route("admin.items.update",m.item.id),{preserveScroll:!0,onSuccess:r=>{r.props.updated_item&&r.props.updated_item.meta&&(s.meta={...r.props.updated_item.meta},s.type==="point_lottery"&&x())}})};return(r,t)=>(l(),E(M,null,{default:_(()=>[w(o(k.Head),null,{default:_(()=>[...t[7]||(t[7]=[e("title",null,"アイテム編集",-1)])]),_:1}),e("div",D,[e("div",K,[e("div",O,[e("div",P,[e("form",{onSubmit:B(S,["prevent"]),onKeydown:j(A,["enter"]),class:"space-y-6"},[e("div",null,[t[9]||(t[9]=e("label",{for:"type",class:"block text-sm font-medium text-gray-700"},[p(" アイテムタイプ "),e("span",{class:"text-red-500"},"*")],-1)),c(e("select",{id:"type","onUpdate:modelValue":t[0]||(t[0]=i=>o(s).type=i),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:"",disabled:""},[...t[8]||(t[8]=[e("option",{value:"gacha_ticket"},"ガチャチケット",-1),e("option",{value:"point_lottery"},"ポイント抽選",-1),e("option",{value:"rank_double"},"ランクアップ2倍",-1),e("option",{value:"point_discount"},"ポイント購入割引",-1),e("option",{value:"daily_reset"},"日次リセット",-1),e("option",{value:"hidden_gacha_key"},"隠しガチャ鍵",-1),e("option",{value:"chip_card"},"チップカード",-1),e("option",{value:"purchase_discount"},"購入割引チケット",-1)])],512),[[h,o(s).type]]),o(s).errors.type?(l(),a("div",R,u(o(s).errors.type),1)):n("",!0)]),e("div",null,[t[10]||(t[10]=e("label",{for:"name",class:"block text-sm font-medium text-gray-700"},[p(" アイテム名 "),e("span",{class:"text-red-500"},"*")],-1)),c(e("input",{id:"name","onUpdate:modelValue":t[1]||(t[1]=i=>o(s).name=i),type:"text",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:""},null,512),[[g,o(s).name]]),o(s).errors.name?(l(),a("div",F,u(o(s).errors.name),1)):n("",!0)]),e("div",null,[t[11]||(t[11]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700"}," 説明 ",-1)),c(e("textarea",{id:"description","onUpdate:modelValue":t[2]||(t[2]=i=>o(s).description=i),rows:"3",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[g,o(s).description]]),o(s).errors.description?(l(),a("div",I,u(o(s).errors.description),1)):n("",!0)]),e("div",null,[t[12]||(t[12]=e("label",{for:"image",class:"block text-sm font-medium text-gray-700"}," アイテム画像 ",-1)),e("div",z,[f.value||b.item.image?(l(),a("img",{key:0,src:f.value||b.item.image,class:"inline-block mt-4 h-52"},null,8,H)):n("",!0)]),e("input",{id:"image",type:"file",onChange:U,ref_key:"image",ref:L,accept:"image/*",class:"mt-1 block w-full border-gray-300"},null,544),o(s).errors.image?(l(),a("div",X,u(o(s).errors.image),1)):n("",!0)]),o(s).type==="point_lottery"?(l(),a("div",$,[t[14]||(t[14]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"ポイント抽選設定",-1)),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[p(" 抽選ポイント (複数設定可能) "),e("span",{class:"text-red-500"},"*")],-1)),w(o(C),{modelValue:d.value,"onUpdate:modelValue":t[3]||(t[3]=i=>d.value=i),"tag-placeholder":"",placeholder:"ポイント数を入力",showNoOptions:!1,options:[],multiple:!0,taggable:!0,label:"label","track-by":"value",onTag:T},null,8,["modelValue"]),o(s).errors["meta.points"]?(l(),a("div",G,u(o(s).errors["meta.points"]),1)):n("",!0)])])):n("",!0),o(s).type==="point_discount"||o(s).type==="purchase_discount"?(l(),a("div",J,[t[16]||(t[16]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"割引設定",-1)),e("div",null,[t[15]||(t[15]=e("label",{for:"discount_percentage",class:"block text-sm font-medium text-gray-700"},[p(" 割引率 (%) "),e("span",{class:"text-red-500"},"*")],-1)),c(e("input",{id:"discount_percentage","onUpdate:modelValue":t[4]||(t[4]=i=>o(s).meta.discount_percentage=i),type:"number",min:"1",max:"100",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:""},null,512),[[g,o(s).meta.discount_percentage]]),o(s).errors["meta.discount_percentage"]?(l(),a("div",Q,u(o(s).errors["meta.discount_percentage"]),1)):n("",!0)])])):n("",!0),o(s).type==="chip_card"?(l(),a("div",W,[t[18]||(t[18]=e("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"チップカード設定",-1)),e("div",null,[t[17]||(t[17]=e("label",{for:"point_amount",class:"block text-sm font-medium text-gray-700"},[p(" ポイント数 "),e("span",{class:"text-red-500"},"*")],-1)),c(e("input",{id:"point_amount","onUpdate:modelValue":t[5]||(t[5]=i=>o(s).meta.point_amount=i),type:"number",min:"1",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:""},null,512),[[g,o(s).meta.point_amount]]),o(s).errors["meta.point_amount"]?(l(),a("div",Y,u(o(s).errors["meta.point_amount"]),1)):n("",!0)])])):n("",!0),e("div",null,[t[20]||(t[20]=e("label",{for:"status",class:"block text-sm font-medium text-gray-700"},[p(" ステータス "),e("span",{class:"text-red-500"},"*")],-1)),c(e("select",{id:"status","onUpdate:modelValue":t[6]||(t[6]=i=>o(s).status=i),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:""},[...t[19]||(t[19]=[e("option",{value:1},"有効",-1),e("option",{value:0},"無効",-1)])],512),[[h,o(s).status]]),o(s).errors.status?(l(),a("div",Z,u(o(s).errors.status),1)):n("",!0)]),e("div",tt,[w(o(k.Link),{href:r.route("admin.items.index"),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:_(()=>[...t[21]||(t[21]=[p(" キャンセル ",-1)])]),_:1},8,["href"]),e("button",{type:"submit",disabled:o(s).processing,class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50"},u(o(s).processing?"更新中...":"更新"),9,et)])],32)])])])])]),_:1}))}};export{at as default};
