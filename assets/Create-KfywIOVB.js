import{a7 as w,d as p,r as f,c as o,o as l,a as c,w as g,b as t,h as V,j as u,i as d,k as S,t as a,e as y,v as b,x,F as h,f as L,m as A,g as C}from"./app-DdrYHWxP.js";import{A as M}from"./Admin-DhdnQado.js";import{B as R}from"./main-DoyJjRNf.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useConfirm-DXT_ooXi.js";import"./isNativeReflectConstruct-zdezgZUv.js";const Q={components:{Head:p.Head,AdminLayout:M,Link:p.Link,VueDatePicker:R},props:{tags:Array,ranks:Array,plans:Array},data(){return{userSearchQuery:"",searchResults:[],selectedUser:null}},methods:{submit(){if(this.form.target_type!=="all"&&!this.form.target_id){this.form.setError("target_id","ターゲットを選択してください");return}this.form.post(route("admin.notifications.store"))},searchUsers:w.debounce(function(){if(this.userSearchQuery.length<2){this.searchResults=[];return}C.get(route("admin.notifications.search-users"),{params:{q:this.userSearchQuery}}).then(i=>{this.searchResults=i.data}).catch(i=>{console.error("User search error:",i)})},300),selectUser(i){this.selectedUser=i,this.form.target_id=i.id,this.searchResults=[],this.userSearchQuery=""},clearUserSelection(){this.selectedUser=null,this.form.target_id=null}},setup(i){return{form:p.useForm({type:"お知らせ",message:"",target_type:"all",target_id:null,is_published:!1,published_at:null})}}},B={class:"py-2"},D={class:"max-w-7xl mx-auto sm:px-0 lg:px-2"},E={class:"bg-white"},N={class:"p-6 text-gray-900"},F={key:0,class:"text-red-500 text-sm mt-1"},P={key:0,class:"text-red-500 text-sm mt-1"},j={class:"space-y-2"},q={class:"flex items-center"},T={class:"flex items-center"},I={key:0,class:"ml-6 mt-2"},z={key:0,class:"mt-2 border border-gray-200 rounded-md max-h-40 overflow-y-auto"},G=["onClick"],J={key:1,class:"mt-2 p-2 bg-blue-50 rounded-md"},K={class:"text-sm"},O={key:0,class:"text-red-500 text-sm mt-1"},W={key:1,class:"text-red-500 text-sm mt-1"},X={for:"is_published",class:"flex items-center"},Y={class:"w-full max-w-xs"},Z={key:0,class:"text-red-500 text-sm mt-1"},$={class:"flex items-center justify-end space-x-4"},ee=["disabled"];function te(i,e,se,s,n,m){const _=f("Head"),v=f("VueDatePicker"),k=f("Link"),U=f("AdminLayout");return l(),o(h,null,[c(_,{title:"お知らせ作成"}),c(U,null,{default:g(()=>[t("div",B,[t("div",D,[t("div",E,[t("div",N,[t("form",{onSubmit:e[9]||(e[9]=V((...r)=>m.submit&&m.submit(...r),["prevent"])),class:"space-y-6"},[t("div",null,[e[11]||(e[11]=t("label",{for:"type",class:"block text-sm font-medium text-gray-700"}," タイプ ",-1)),u(t("select",{id:"type","onUpdate:modelValue":e[0]||(e[0]=r=>s.form.type=r),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},[...e[10]||(e[10]=[t("option",{value:"お知らせ"},"お知らせ",-1),t("option",{value:"メンテナンス"},"メンテナンス",-1),t("option",{value:"イベント"},"イベント",-1),t("option",{value:"キャンペーン"},"キャンペーン",-1),t("option",{value:"重要"},"重要",-1)])],512),[[S,s.form.type]]),s.form.errors.type?(l(),o("div",F,a(s.form.errors.type),1)):d("",!0)]),t("div",null,[e[12]||(e[12]=t("label",{for:"message",class:"block text-sm font-medium text-gray-700"},[y(" メッセージ "),t("span",{class:"text-red-500"},"*")],-1)),u(t("textarea",{id:"message","onUpdate:modelValue":e[1]||(e[1]=r=>s.form.message=r),rows:"4",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:""},null,512),[[b,s.form.message]]),s.form.errors.message?(l(),o("div",P,a(s.form.errors.message),1)):d("",!0)]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[y(" 配信対象 "),t("span",{class:"text-red-500"},"*")],-1)),t("div",j,[t("label",q,[u(t("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=r=>s.form.target_type=r),value:"all",class:"mr-2"},null,512),[[x,s.form.target_type]]),e[13]||(e[13]=t("span",null,"全ユーザー",-1))]),t("label",T,[u(t("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=r=>s.form.target_type=r),value:"user",class:"mr-2"},null,512),[[x,s.form.target_type]]),e[14]||(e[14]=t("span",null,"特定のユーザー",-1))]),s.form.target_type==="user"?(l(),o("div",I,[u(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=r=>n.userSearchQuery=r),onInput:e[5]||(e[5]=(...r)=>m.searchUsers&&m.searchUsers(...r)),placeholder:"ユーザーを検索...",class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,544),[[b,n.userSearchQuery]]),n.searchResults.length>0?(l(),o("div",z,[(l(!0),o(h,null,L(n.searchResults,r=>(l(),o("div",{key:r.id,onClick:re=>m.selectUser(r),class:"p-2 hover:bg-gray-100 cursor-pointer"},a(r.name)+" ("+a(r.email)+") ",9,G))),128))])):d("",!0),n.selectedUser?(l(),o("div",J,[t("span",K,"選択中: "+a(n.selectedUser.name)+" ("+a(n.selectedUser.email)+")",1),t("button",{type:"button",onClick:e[6]||(e[6]=(...r)=>m.clearUserSelection&&m.clearUserSelection(...r)),class:"ml-2 text-red-600 text-sm"},"削除")])):d("",!0)])):d("",!0)]),s.form.errors.target_type?(l(),o("div",O,a(s.form.errors.target_type),1)):d("",!0),s.form.errors.target_id?(l(),o("div",W,a(s.form.errors.target_id),1)):d("",!0)]),t("div",null,[t("label",X,[u(t("input",{type:"checkbox",id:"is_published","onUpdate:modelValue":e[7]||(e[7]=r=>s.form.is_published=r),class:"mr-2"},null,512),[[A,s.form.is_published]]),e[16]||(e[16]=t("span",{class:"text-sm font-medium text-gray-700"},"公開する",-1))])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," 配信日時（任意） ",-1)),t("div",Y,[c(v,{modelValue:s.form.published_at,"onUpdate:modelValue":e[8]||(e[8]=r=>s.form.published_at=r),format:"yyyy-MM-dd HH:mm",class:"flex-1"},null,8,["modelValue"])]),e[18]||(e[18]=t("p",{class:"mt-1 text-xs text-gray-500"},"未指定の場合は「公開する」にチェックを入れた時点で即時公開されます。指定するとその日時以降にユーザーに表示されます。",-1)),s.form.errors.published_at?(l(),o("div",Z,a(s.form.errors.published_at),1)):d("",!0)]),t("div",$,[c(k,{href:i.route("admin.notifications.index"),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:g(()=>[...e[19]||(e[19]=[y(" キャンセル ",-1)])]),_:1},8,["href"]),t("button",{type:"submit",disabled:s.form.processing,class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50"},a(s.form.processing?"作成中...":"作成"),9,ee)])],32)])])])])]),_:1})],64)}const me=H(Q,[["render",te]]);export{me as default};
