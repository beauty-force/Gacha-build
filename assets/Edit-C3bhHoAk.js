import{a7 as S,d as g,r as f,c as a,o as l,a as y,w as b,b as t,t as i,h as L,j as c,i as n,k as A,e as p,v as x,x as h,F as _,f as M,m as C,g as v}from"./app-DqbpHCH1.js";import{A as R}from"./Admin-sCihLsPb.js";import{B as H}from"./main-CHbU8ESh.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useConfirm-DFPtZnQT.js";import"./isNativeReflectConstruct-zdezgZUv.js";const B={components:{Head:g.Head,AdminLayout:R,Link:g.Link,VueDatePicker:H},props:{notification:Object,tags:Array,ranks:Array,plans:Array},data(){return{userSearchQuery:"",searchResults:[],selectedUser:null}},mounted(){this.notification.target_type==="user"&&this.notification.target_id&&v.get(route("admin.notifications.search-users"),{params:{q:"",user_id:this.notification.target_id}}).then(r=>{const e=r.data.find(u=>u.id==this.notification.target_id);e&&(this.selectedUser=e)}).catch(()=>{})},methods:{submit(){if(this.form.target_type!=="all"&&!this.form.target_id){this.form.setError("target_id","ターゲットを選択してください");return}this.form.post(route("admin.notifications.update",this.notification.id))},searchUsers:S.debounce(function(){if(this.userSearchQuery.length<2){this.searchResults=[];return}v.get(route("admin.notifications.search-users"),{params:{q:this.userSearchQuery}}).then(r=>{this.searchResults=r.data}).catch(r=>{console.error("User search error:",r)})},300),selectUser(r){this.selectedUser=r,this.form.target_id=r.id,this.searchResults=[],this.userSearchQuery=""},clearUserSelection(){this.selectedUser=null,this.form.target_id=null}},setup(r){const e={announcement:"お知らせ",maintenance:"メンテナンス",event:"イベント",campaign:"キャンペーン",important:"重要"};return{form:g.useForm({type:e[r.notification.type]||r.notification.type||"お知らせ",message:r.notification.message,target_type:r.notification.target_type,target_id:r.notification.target_id,is_published:r.notification.is_published,published_at:r.notification.published_at||null})}}},D={class:"py-2"},E={class:"max-w-7xl mx-auto sm:px-0 lg:px-2"},N={class:"bg-white"},j={class:"p-6 text-gray-900"},q={class:"mb-6"},F={class:"text-sm text-gray-600 space-y-1"},P={key:0,class:"text-red-500 text-sm mt-1"},T={key:0,class:"text-red-500 text-sm mt-1"},I={class:"space-y-2"},O={class:"flex items-center"},z={class:"flex items-center"},G={key:0,class:"ml-6 mt-2"},J={key:0,class:"mt-2 border border-gray-200 rounded-md max-h-40 overflow-y-auto"},K=["onClick"],W={key:1,class:"mt-2 p-2 bg-blue-50 rounded-md"},X={class:"text-sm"},Y={key:0,class:"text-red-500 text-sm mt-1"},Z={key:1,class:"text-red-500 text-sm mt-1"},$={for:"is_published",class:"flex items-center"},ee={class:"w-full max-w-xs"},te={key:0,class:"text-red-500 text-sm mt-1"},se={class:"flex items-center justify-end space-x-4"},oe=["disabled"];function re(r,e,u,s,d,m){const k=f("Head"),U=f("VueDatePicker"),w=f("Link"),V=f("AdminLayout");return l(),a(_,null,[y(k,{title:"お知らせ編集"}),y(V,null,{default:b(()=>[t("div",D,[t("div",E,[t("div",N,[t("div",j,[t("div",q,[e[10]||(e[10]=t("h3",{class:"text-lg font-semibold mb-2"},"お知らせ情報",-1)),t("div",F,[t("p",null,"配信対象: "+i(u.notification.target_name),1),t("p",null,"読了数: "+i(u.notification.read_count)+" / 配信ユーザー数: "+i(u.notification.user_count),1)])]),t("form",{onSubmit:e[9]||(e[9]=L((...o)=>m.submit&&m.submit(...o),["prevent"])),class:"space-y-6"},[t("div",null,[e[12]||(e[12]=t("label",{for:"type",class:"block text-sm font-medium text-gray-700"}," タイプ ",-1)),c(t("select",{id:"type","onUpdate:modelValue":e[0]||(e[0]=o=>s.form.type=o),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},[...e[11]||(e[11]=[t("option",{value:"お知らせ"},"お知らせ",-1),t("option",{value:"メンテナンス"},"メンテナンス",-1),t("option",{value:"イベント"},"イベント",-1),t("option",{value:"キャンペーン"},"キャンペーン",-1),t("option",{value:"重要"},"重要",-1)])],512),[[A,s.form.type]]),s.form.errors.type?(l(),a("div",P,i(s.form.errors.type),1)):n("",!0)]),t("div",null,[e[13]||(e[13]=t("label",{for:"message",class:"block text-sm font-medium text-gray-700"},[p(" メッセージ "),t("span",{class:"text-red-500"},"*")],-1)),c(t("textarea",{id:"message","onUpdate:modelValue":e[1]||(e[1]=o=>s.form.message=o),rows:"4",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:""},null,512),[[x,s.form.message]]),s.form.errors.message?(l(),a("div",T,i(s.form.errors.message),1)):n("",!0)]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[p(" 配信対象 "),t("span",{class:"text-red-500"},"*")],-1)),t("div",I,[t("label",O,[c(t("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=o=>s.form.target_type=o),value:"all",class:"mr-2"},null,512),[[h,s.form.target_type]]),e[14]||(e[14]=t("span",null,"全ユーザー",-1))]),t("label",z,[c(t("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=o=>s.form.target_type=o),value:"user",class:"mr-2"},null,512),[[h,s.form.target_type]]),e[15]||(e[15]=t("span",null,"特定のユーザー",-1))]),s.form.target_type==="user"?(l(),a("div",G,[c(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=o=>d.userSearchQuery=o),onInput:e[5]||(e[5]=(...o)=>m.searchUsers&&m.searchUsers(...o)),placeholder:"ユーザーを検索...",class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,544),[[x,d.userSearchQuery]]),d.searchResults.length>0?(l(),a("div",J,[(l(!0),a(_,null,M(d.searchResults,o=>(l(),a("div",{key:o.id,onClick:ie=>m.selectUser(o),class:"p-2 hover:bg-gray-100 cursor-pointer"},i(o.name)+" ("+i(o.email)+") ",9,K))),128))])):n("",!0),d.selectedUser?(l(),a("div",W,[t("span",X,"選択中: "+i(d.selectedUser.name)+" ("+i(d.selectedUser.email)+")",1),t("button",{type:"button",onClick:e[6]||(e[6]=(...o)=>m.clearUserSelection&&m.clearUserSelection(...o)),class:"ml-2 text-red-600 text-sm"},"削除")])):n("",!0)])):n("",!0)]),s.form.errors.target_type?(l(),a("div",Y,i(s.form.errors.target_type),1)):n("",!0),s.form.errors.target_id?(l(),a("div",Z,i(s.form.errors.target_id),1)):n("",!0)]),t("div",null,[t("label",$,[c(t("input",{type:"checkbox",id:"is_published","onUpdate:modelValue":e[7]||(e[7]=o=>s.form.is_published=o),class:"mr-2"},null,512),[[C,s.form.is_published]]),e[17]||(e[17]=t("span",{class:"text-sm font-medium text-gray-700"},"公開する",-1))])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," 配信日時（任意） ",-1)),t("div",ee,[y(U,{modelValue:s.form.published_at,"onUpdate:modelValue":e[8]||(e[8]=o=>s.form.published_at=o),format:"yyyy-MM-dd HH:mm",class:"flex-1"},null,8,["modelValue"])]),e[19]||(e[19]=t("p",{class:"mt-1 text-xs text-gray-500"},"未指定の場合は「公開する」にチェックを入れた時点で即時公開されます。指定するとその日時以降にユーザーに表示されます。",-1)),s.form.errors.published_at?(l(),a("div",te,i(s.form.errors.published_at),1)):n("",!0)]),t("div",se,[y(w,{href:r.route("admin.notifications.index"),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:b(()=>[...e[20]||(e[20]=[p(" キャンセル ",-1)])]),_:1},8,["href"]),t("button",{type:"submit",disabled:s.form.processing,class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50"},i(s.form.processing?"更新中...":"更新"),9,oe)])],32)])])])])]),_:1})],64)}const ce=Q(B,[["render",re]]);export{ce as default};
