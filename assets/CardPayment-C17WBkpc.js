import{d as m,r as p,c as a,o as d,a as h,w as _,b as t,i as l,F as f,f as x,n as y,t as c,h as v,g as n}from"./app-0wH1KzxS.js";import{A as k}from"./UserLayout-EBlolaXa.js";import{u as N}from"./useConfirm-DiRK4iAb.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DZjxj9Tr.js";const{confirm:P}=N(),A={components:{Head:m.Head,AdminLayout:k},props:{registeredCards:Array,point:Object,coupon_id:Number},data(){return{selectedCard:null,isNewCard:!1,loading:!1,cardPaymentUrl:"user.point.card_payment_post",registerCardUrl:"user.point.card_register",paymentRegisterUrl:"user.point.paymentRegister",deleteCardUrl:"user.point.deleteCard",purchaseSuccessUrl:"purchase_success",cards:this.registeredCards}},methods:{selectRegisteredCard(e){this.selectedCard=e.id,this.isNewCard=!1},newCardPayment(){this.selectedCard=null,this.isNewCard=!0},registerNewCard(){this.loading=!0,this.selectedCard=null,this.isNewCard=!1,n.get(route(this.registerCardUrl,{type:"purchase"})).then(e=>{e.data.status==1&&(window.location.href=e.data.link_url)})},proceedToPayment(){this.loading=!0,this.selectedCard?n.post(route(this.cardPaymentUrl),{card_id:this.selectedCard,id:this.point.id,coupon_id:this.coupon_id}).then(e=>{e.data.status=="CAPTURED"?window.location.href=this.purchaseSuccessUrl:e.data.status=="AUTHENTICATED"&&(window.location.href=e.data.acs_url)}).finally(()=>{this.loading=!1}):this.isNewCard&&n.post(route(this.paymentRegisterUrl),{id:this.point.id,pay_type:"Card",coupon_id:this.coupon_id}).then(e=>{e.data.status==0?alert(e.data.message):window.location.href=e.data.link_url})},deleteCard(e){P("このカードを削除してもよろしいですか？","","error").then(s=>{s&&(this.loading=!0,n.post(route(this.deleteCardUrl),{card_id:e}).then(u=>{u.data.status==1&&(this.cards=this.cards.filter(g=>g.id!=e))}).finally(()=>{this.loading=!1}))})},getCardBrandIcon(e){return`/images/credit_cards/${e.toLowerCase()}.svg`},formatCardNumber(e){return e.replace(/(.{4})/g,"$1 ").trim()},formatExpireDate(e){return`${e.slice(0,2)}/${e.slice(2)}`}},mounted(){m.usePage().props.value.auth.user?.type==1&&(this.cardPaymentUrl="test.user.point.card_payment_post",this.registerCardUrl="test.user.point.card_register",this.paymentRegisterUrl="test.user.point.paymentRegister",this.deleteCardUrl="test.user.point.deleteCard",this.purchaseSuccessUrl="test.purchase_success")}},R={class:"flex justify-center items-center flex-1 bg-white py-2"},E={class:"p-6 w-full max-w-md"},T={key:0,class:"fixed inset-0 flex justify-center items-center bg-gray-800 bg-opacity-75 z-[20]"},B={key:1,class:"mb-6"},H=["onClick"],L={class:"flex items-center gap-4"},j=["src","alt"],D={class:"text-sm font-semibold text-gray-800"},S={class:"text-xs text-gray-500"},z={class:"text-xs text-gray-500"},V=["onClick"],F={key:2,class:"mb-6"},I=["disabled"],M={key:3,class:"mt-6"};function O(e,s,u,g,i,o){const C=p("Head"),b=p("AdminLayout");return d(),a(f,null,[h(C,{title:"カード決済"}),h(b,null,{default:_(()=>[t("div",R,[t("div",E,[s[7]||(s[7]=t("h2",{class:"text-center text-xl font-semibold text-gray-800 mb-7"}," カード決済 ",-1)),i.loading?(d(),a("div",T,[...s[3]||(s[3]=[t("div",{class:"w-16 h-16 bg-white p-4 rounded-full shadow-lg"},[t("svg",{class:"animate-spin h-8 w-8 text-yellow-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})])],-1)])])):l("",!0),!i.loading&&i.cards.length?(d(),a("div",B,[s[4]||(s[4]=t("h3",{class:"text-lg font-bold mb-3"},"登録済みカード",-1)),(d(!0),a(f,null,x(i.cards,(r,q)=>(d(),a("div",{key:r.id,class:"mb-4"},[t("div",{onClick:w=>o.selectRegisteredCard(r),class:y([{"border-yellow-500 bg-yellow-100 font-bold":i.selectedCard===r.id,"hover:bg-gray-100 hover:border-gray-300":i.selectedCard!==r.id},"w-full p-4 bg-white border-2 border-gray-200 rounded-lg flex justify-between items-center transition duration-200 cursor-pointer"])},[t("div",L,[t("img",{src:o.getCardBrandIcon(r.brand),alt:r.brand,class:"w-16"},null,8,j),t("div",null,[t("p",D,c(o.formatCardNumber(r.card_no)),1),t("p",S," 有効期限: "+c(o.formatExpireDate(r.expire)),1),t("p",z," 名義人: "+c(r.holder_name),1)])]),t("button",{onClick:v(w=>o.deleteCard(r.id),["stop"]),class:"text-red-500 hover:text-red-700 text-sm font-semibold"}," 削除 ",8,V)],10,H)]))),128))])):l("",!0),i.loading?l("",!0):(d(),a("div",F,[s[5]||(s[5]=t("h3",{class:"text-lg font-bold mb-3"},"他のカードでお支払い",-1)),t("button",{onClick:s[0]||(s[0]=(...r)=>o.newCardPayment&&o.newCardPayment(...r)),class:y([{"border-yellow-500 bg-yellow-100 font-bold":i.isNewCard,"hover:bg-gray-100 hover:border-gray-300":!i.isNewCard},"w-full p-4 bg-white border-2 border-gray-200 rounded-lg flex justify-center items-center transition duration-200"])}," カード情報を入力 ",2)])),t("button",{type:"submit",disabled:!i.selectedCard&&!i.isNewCard||i.loading,onClick:s[1]||(s[1]=(...r)=>o.proceedToPayment&&o.proceedToPayment(...r)),class:"w-full p-4 bg-yellow-500 text-white rounded-lg text-lg font-semibold transition duration-200 hover:bg-yellow-600 my-4 disabled:opacity-50 disabled:cursor-not-allowed"}," 支払いを続ける ",8,I),i.loading?l("",!0):(d(),a("div",M,[s[6]||(s[6]=t("h3",{class:"text-lg font-bold mb-3"},"新しいカードを登録する",-1)),t("button",{onClick:s[2]||(s[2]=(...r)=>o.registerNewCard&&o.registerNewCard(...r)),class:"w-full p-4 bg-orange-500 text-white rounded-lg text-lg font-semibold transition duration-200 hover:bg-orange-600 my-4 disabled:opacity-50 disabled:cursor-not-allowed"}," 新しいカードを登録 ")]))])])]),_:1})],64)}const X=U(A,[["render",O]]);export{X as default};
