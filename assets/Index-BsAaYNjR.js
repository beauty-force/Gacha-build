import{c as s,o as a,b as u,d as C,r as g,a as x,w as p,i as m,n as v,e as y,t as _,F as w,f as k,h as A,l as b,g as I}from"./app-B-1GpCXn.js";import{A as S}from"./UserLayout-sTaTtLBR.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as R,r as B,b as E,a as j}from"./ChevronRightIcon-C9lmTfXm.js";import"./useConfirm-D6HGndBC.js";import"./index-DGdllI6x.js";function H(e,n){return a(),s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[u("path",{"fill-rule":"evenodd",d:"M12.53 16.28a.75.75 0 0 1-1.06 0l-7.5-7.5a.75.75 0 0 1 1.06-1.06L12 14.69l6.97-6.97a.75.75 0 1 1 1.06 1.06l-7.5 7.5Z","clip-rule":"evenodd"})])}function V(e,n){return a(),s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[u("path",{"fill-rule":"evenodd",d:"M11.47 7.72a.75.75 0 0 1 1.06 0l7.5 7.5a.75.75 0 1 1-1.06 1.06L12 9.31l-6.97 6.97a.75.75 0 0 1-1.06-1.06l7.5-7.5Z","clip-rule":"evenodd"})])}const F={components:{Head:C.Head,Link:C.Link,UserLayout:S,ChevronLeftIcon:j,ChevronRightIcon:E,ChevronDoubleLeftIcon:B,ChevronDoubleRightIcon:R,ChevronDownIcon:H,ChevronUpIcon:V},props:{notifications:[Array,Object],unreadCount:Number,personalUnreadCount:{type:Number,default:0},announcementUnreadCount:{type:Number,default:0},activeTab:{type:String,default:"personal"}},data(){return{expandedMessages:{},localPersonalUnreadCount:0,localAnnouncementUnreadCount:0,localUnreadCount:0}},mounted(){this.localPersonalUnreadCount=this.personalUnreadCount||0,this.localAnnouncementUnreadCount=this.announcementUnreadCount||0,this.localUnreadCount=this.unreadCount||0,window.addEventListener("pageshow",this.handlePageShow)},beforeUnmount(){window.removeEventListener("pageshow",this.handlePageShow)},computed:{filteredNotifications(){return this.notifications&&this.notifications.data?this.notifications.data:Array.isArray(this.notifications)?this.notifications:[]},hasUnread(){return this.filteredNotifications.some(e=>!e.is_read)},paginationLinks(){if(!this.notifications||!this.notifications.links)return[];const e=this.notifications.links.filter((c,l)=>l>0&&l<this.notifications.links.length-1),n=this.notifications.current_page||1,t=this.notifications.last_page||1,h=5;if(t<=h)return e;const d=2;let o=Math.max(1,n-d),f=Math.min(t,n+d);n<=d+1?(o=1,f=Math.min(h,t)):n>=t-d&&(o=Math.max(1,t-h+1),f=t);const i=[];return o>1&&i.push({url:null,label:"...",active:!1}),e.forEach(c=>{const l=parseInt(c.label);!isNaN(l)&&l>=o&&l<=f&&i.push(c)}),f<t&&i.push({url:null,label:"...",active:!1}),i},pageUnreadNotificationCount(){return C.usePage().props.value.unreadNotificationCount||0}},watch:{pageUnreadNotificationCount:function(e){},personalUnreadCount:function(e){this.localPersonalUnreadCount=e||0},announcementUnreadCount:function(e){this.localAnnouncementUnreadCount=e||0},unreadCount:function(e){this.localUnreadCount=e||0}},methods:{formatDate(e){const n=new Date(e),t=n.getFullYear(),h=String(n.getMonth()+1).padStart(2,"0"),d=String(n.getDate()).padStart(2,"0"),o=String(n.getHours()).padStart(2,"0"),f=String(n.getMinutes()).padStart(2,"0");return`${t}/${h}/${d} ${o}:${f}`},getTruncatedMessage(e,n){if(!e)return"";const t=100;return this.expandedMessages[n]||e.length<=t?e:e.replace(/\n/g," ").substring(0,t)+"..."},toggleExpand(e){this.expandedMessages[e]=!this.expandedMessages[e],this.expandedMessages[e]&&this.markAsRead(e)},markAsRead(e){const n=this.filteredNotifications.find(c=>c.id===e);if(!n||n.is_read)return;const t=C.usePage().props.value,h=t.unreadNotificationCount||0,d=this.localPersonalUnreadCount,o=this.localAnnouncementUnreadCount,f=this.localUnreadCount;n.is_read=!0;const i=Math.max(0,h-1);h>0&&(t.unreadNotificationCount=i),this.activeTab==="personal"?this.localPersonalUnreadCount=Math.max(0,this.localPersonalUnreadCount-1):this.localAnnouncementUnreadCount=Math.max(0,this.localAnnouncementUnreadCount-1),this.localUnreadCount=Math.max(0,this.localUnreadCount-1),I.post(route("user.notifications.read",e)).then(c=>{if(c.data.success){const l=c.data;t.unreadNotificationCount=l.unreadNotificationCount||0,this.localPersonalUnreadCount=l.personalUnreadCount||0,this.localAnnouncementUnreadCount=l.announcementUnreadCount||0,this.localUnreadCount=(l.personalUnreadCount||0)+(l.announcementUnreadCount||0)}}).catch(c=>{n.is_read=!1,t.unreadNotificationCount=h,this.localPersonalUnreadCount=d,this.localAnnouncementUnreadCount=o,this.localUnreadCount=f,console.error("Error marking notification as read:",c)})},shouldShowReadMore(e){return e?e.length>100:!1},addTabToUrl(e){if(!e||!this.activeTab)return e;try{const n=new URL(e,window.location.origin);return n.searchParams.set("tab",this.activeTab),n.pathname+n.search}catch{const t=e.includes("?")?"&":"?";return e+t+"tab="+this.activeTab}},goBack(){window.history.back()},handlePageShow(e){e.persisted}}},O={class:"py-4 md:px-6 px-4 text-neutral-700"},W={class:"flex border-b border-neutral-200 mb-4 font-semibold font-[mplus2]"},Z={key:0,class:"bg-red-500 text-white text-xs font-bold rounded-full px-2 py-0.5 min-w-[20px] text-center"},z={key:0,class:"bg-red-500 text-white text-xs font-bold rounded-full px-2 py-0.5 min-w-[20px] text-center"},Y={key:0,class:"space-y-4"},q=["onClick"],G={class:"flex justify-between items-start"},J={class:"flex-1"},K={class:"text-xs text-neutral-500 mb-1"},Q={class:"text-sm text-neutral-700",style:{"white-space":"pre-line"}},X=["onClick","title"],$={key:0,class:"ml-2 w-2 h-2 bg-yellow-500 rounded-full flex-shrink-0"},ee={key:1,class:"text-center py-12"},te={key:2,class:"mt-4 flex flex-col sm:flex-row justify-between items-center gap-3 px-3 lg:px-4"},ne={class:"text-sm text-gray-600 font-medium"},oe={class:"font-bold text-gray-900"},ae={class:"flex items-center gap-0.5 md:gap-1"},re={key:1,class:"px-1 md:px-2 text-gray-400 text-xs md:text-sm"},se={key:3,class:"mt-6 text-center"};function ie(e,n,t,h,d,o){const f=g("Head"),i=g("Link"),c=g("ChevronDownIcon"),l=g("ChevronUpIcon"),L=g("ChevronDoubleLeftIcon"),N=g("ChevronLeftIcon"),M=g("ChevronRightIcon"),T=g("ChevronDoubleRightIcon"),P=g("UserLayout");return a(),s(w,null,[x(f,{title:"通知"}),x(P,null,{default:p(()=>[u("div",O,[u("div",W,[x(i,{href:e.route("user.notifications",{tab:"personal"}),class:v(["px-4 py-2 border-b-2 transition-colors flex items-center gap-2",t.activeTab==="personal"?"border-yellow-500 text-yellow-600":"border-transparent text-neutral-500 hover:text-neutral-700"])},{default:p(()=>[n[0]||(n[0]=y(" あなたへの通知 ",-1)),t.personalUnreadCount>0?(a(),s("span",Z,_(t.personalUnreadCount),1)):m("",!0)]),_:1},8,["href","class"]),x(i,{href:e.route("user.notifications",{tab:"announcement"}),class:v(["px-4 py-2 border-b-2 transition-colors flex items-center gap-2",t.activeTab==="announcement"?"border-yellow-500 text-yellow-600":"border-transparent text-neutral-500 hover:text-neutral-700"])},{default:p(()=>[n[1]||(n[1]=y(" お知らせ ",-1)),d.localAnnouncementUnreadCount>0?(a(),s("span",z,_(d.localAnnouncementUnreadCount),1)):m("",!0)]),_:1},8,["href","class"])]),o.filteredNotifications.length>0?(a(),s("div",Y,[(a(!0),s(w,null,k(o.filteredNotifications,r=>(a(),s("div",{key:r.id,onClick:U=>o.markAsRead(r.id),class:v(["block p-4 rounded-lg border transition-colors cursor-pointer hover:shadow-md",r.is_read?"bg-white border-neutral-200":"bg-yellow-50 border-yellow-200"])},[u("div",G,[u("div",J,[u("p",K,_(o.formatDate(r.created_at)),1),u("p",Q,_(o.getTruncatedMessage(r.message,r.id)),1),o.shouldShowReadMore(r.message)?(a(),s("button",{key:0,onClick:A(U=>o.toggleExpand(r.id),["stop","prevent"]),class:"inline-flex items-center justify-center mt-2 p-1.5 rounded-full text-yellow-600 hover:text-yellow-700 hover:bg-yellow-100 transition-colors",title:d.expandedMessages[r.id]?"折りたたむ":"続きを読む"},[d.expandedMessages[r.id]?(a(),b(l,{key:1,class:"w-5 h-5"})):(a(),b(c,{key:0,class:"w-5 h-5"}))],8,X)):m("",!0)]),r.is_read?m("",!0):(a(),s("div",$))])],10,q))),128))])):(a(),s("div",ee,[...n[2]||(n[2]=[u("p",{class:"text-neutral-500"},"通知はありません",-1)])])),t.notifications&&o.filteredNotifications.length>0?(a(),s("div",te,[u("div",ne,[y(_(t.notifications.from)+" - "+_(t.notifications.to)+" / ",1),u("span",oe,_(t.notifications.total),1),n[3]||(n[3]=y("件 ",-1))]),u("div",ae,[t.notifications.current_page>1?(a(),b(i,{key:0,href:o.addTabToUrl(t.notifications.first_page_url),class:"px-1 py-1 md:px-2 md:py-1.5 rounded text-xs md:text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors font-medium",title:"最初"},{default:p(()=>[x(L,{class:"w-3 h-3 md:w-4 md:h-4"})]),_:1},8,["href"])):m("",!0),t.notifications.prev_page_url?(a(),b(i,{key:1,href:o.addTabToUrl(t.notifications.prev_page_url),class:"px-1 py-1 md:px-2 md:py-1.5 rounded text-xs md:text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors font-medium"},{default:p(()=>[x(N,{class:"w-3 h-3 md:w-4 md:h-4"})]),_:1},8,["href"])):m("",!0),(a(!0),s(w,null,k(o.paginationLinks,(r,U)=>(a(),s(w,{key:U},[r.url?(a(),b(i,{key:0,href:o.addTabToUrl(r.url),class:v({"px-2 py-0.5 md:px-3 md:py-1 rounded text-xs md:text-sm font-semibold transition-colors":!0,"bg-yellow-500 text-white shadow-md":r.active,"bg-gray-200 text-gray-700 hover:bg-gray-300":!r.active})},{default:p(()=>[y(_(r.label),1)]),_:2},1032,["href","class"])):(a(),s("span",re,"..."))],64))),128)),t.notifications.next_page_url?(a(),b(i,{key:2,href:o.addTabToUrl(t.notifications.next_page_url),class:"px-1 py-1 md:px-2 md:py-1.5 rounded text-xs md:text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors font-medium"},{default:p(()=>[x(M,{class:"w-3 h-3 md:w-4 md:h-4"})]),_:1},8,["href"])):m("",!0),t.notifications.current_page<t.notifications.last_page?(a(),b(i,{key:3,href:o.addTabToUrl(t.notifications.last_page_url),class:"px-1 py-1 md:px-2 md:py-1.5 rounded text-xs md:text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors font-medium",title:"最後"},{default:p(()=>[x(T,{class:"w-3 h-3 md:w-4 md:h-4"})]),_:1},8,["href"])):m("",!0)])])):m("",!0),o.filteredNotifications.length>0&&o.hasUnread?(a(),s("div",se,[x(i,{href:e.route("user.notifications.read-all"),method:"post",data:{tab:t.activeTab},as:"button",class:"inline-block px-6 py-2 bg-neutral-200 text-neutral-700 rounded-md text-sm font-medium hover:bg-neutral-300 transition-colors"},{default:p(()=>[...n[4]||(n[4]=[y(" すべて既読にする ",-1)])]),_:1},8,["href","data"])])):m("",!0)])]),_:1})],64)}const me=D(F,[["render",ie]]);export{me as default};
