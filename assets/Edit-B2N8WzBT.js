import{a7 as S,d as f,r as g,c as n,o as a,a as y,w as b,b as t,t as i,h as V,j as c,i as m,k as L,e as p,v as h,x,F as _,f as A,m as C,g as v}from"./app-DxukTCoY.js";import{A as R}from"./Admin-DQO6dtfb.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useConfirm-B_K6hPBe.js";const Q={components:{Head:f.Head,AdminLayout:R,Link:f.Link},props:{notification:Object,tags:Array,ranks:Array,plans:Array},data(){return{userSearchQuery:"",searchResults:[],selectedUser:null}},mounted(){this.notification.target_type==="user"&&this.notification.target_id&&v.get(route("admin.notifications.search-users"),{params:{q:"",user_id:this.notification.target_id}}).then(r=>{const e=r.data.find(u=>u.id==this.notification.target_id);e&&(this.selectedUser=e)}).catch(()=>{})},methods:{submit(){if(this.form.target_type!=="all"&&!this.form.target_id){this.form.setError("target_id","ターゲットを選択してください");return}this.form.post(route("admin.notifications.update",this.notification.id))},searchUsers:S.debounce(function(){if(this.userSearchQuery.length<2){this.searchResults=[];return}v.get(route("admin.notifications.search-users"),{params:{q:this.userSearchQuery}}).then(r=>{this.searchResults=r.data}).catch(r=>{console.error("User search error:",r)})},300),selectUser(r){this.selectedUser=r,this.form.target_id=r.id,this.searchResults=[],this.userSearchQuery=""},clearUserSelection(){this.selectedUser=null,this.form.target_id=null}},setup(r){const e={announcement:"お知らせ",maintenance:"メンテナンス",event:"イベント",campaign:"キャンペーン",important:"重要"};return{form:f.useForm({type:e[r.notification.type]||r.notification.type||"お知らせ",message:r.notification.message,target_type:r.notification.target_type,target_id:r.notification.target_id,is_published:r.notification.is_published})}}},E={class:"py-2"},H={class:"max-w-7xl mx-auto sm:px-0 lg:px-2"},N={class:"bg-white"},j={class:"p-6 text-gray-900"},q={class:"mb-6"},B={class:"text-sm text-gray-600 space-y-1"},F={key:0,class:"text-red-500 text-sm mt-1"},D={key:0,class:"text-red-500 text-sm mt-1"},T={class:"space-y-2"},I={class:"flex items-center"},O={class:"flex items-center"},z={key:0,class:"ml-6 mt-2"},G={key:0,class:"mt-2 border border-gray-200 rounded-md max-h-40 overflow-y-auto"},J=["onClick"],K={key:1,class:"mt-2 p-2 bg-blue-50 rounded-md"},P={class:"text-sm"},W={key:0,class:"text-red-500 text-sm mt-1"},X={key:1,class:"text-red-500 text-sm mt-1"},Y={for:"is_published",class:"flex items-center"},Z={class:"flex items-center justify-end space-x-4"},$=["disabled"];function ee(r,e,u,o,l,d){const k=g("Head"),U=g("Link"),w=g("AdminLayout");return a(),n(_,null,[y(k,{title:"お知らせ編集"}),y(w,null,{default:b(()=>[t("div",E,[t("div",H,[t("div",N,[t("div",j,[t("div",q,[e[9]||(e[9]=t("h3",{class:"text-lg font-semibold mb-2"},"お知らせ情報",-1)),t("div",B,[t("p",null,"配信対象: "+i(u.notification.target_name),1),t("p",null,"読了数: "+i(u.notification.read_count)+" / 配信ユーザー数: "+i(u.notification.user_count),1)])]),t("form",{onSubmit:e[8]||(e[8]=V((...s)=>d.submit&&d.submit(...s),["prevent"])),class:"space-y-6"},[t("div",null,[e[11]||(e[11]=t("label",{for:"type",class:"block text-sm font-medium text-gray-700"}," タイプ ",-1)),c(t("select",{id:"type","onUpdate:modelValue":e[0]||(e[0]=s=>o.form.type=s),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},[...e[10]||(e[10]=[t("option",{value:"お知らせ"},"お知らせ",-1),t("option",{value:"メンテナンス"},"メンテナンス",-1),t("option",{value:"イベント"},"イベント",-1),t("option",{value:"キャンペーン"},"キャンペーン",-1),t("option",{value:"重要"},"重要",-1)])],512),[[L,o.form.type]]),o.form.errors.type?(a(),n("div",F,i(o.form.errors.type),1)):m("",!0)]),t("div",null,[e[12]||(e[12]=t("label",{for:"message",class:"block text-sm font-medium text-gray-700"},[p(" メッセージ "),t("span",{class:"text-red-500"},"*")],-1)),c(t("textarea",{id:"message","onUpdate:modelValue":e[1]||(e[1]=s=>o.form.message=s),rows:"4",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:""},null,512),[[h,o.form.message]]),o.form.errors.message?(a(),n("div",D,i(o.form.errors.message),1)):m("",!0)]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[p(" 配信対象 "),t("span",{class:"text-red-500"},"*")],-1)),t("div",T,[t("label",I,[c(t("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=s=>o.form.target_type=s),value:"all",class:"mr-2"},null,512),[[x,o.form.target_type]]),e[13]||(e[13]=t("span",null,"全ユーザー",-1))]),t("label",O,[c(t("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=s=>o.form.target_type=s),value:"user",class:"mr-2"},null,512),[[x,o.form.target_type]]),e[14]||(e[14]=t("span",null,"特定のユーザー",-1))]),o.form.target_type==="user"?(a(),n("div",z,[c(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>l.userSearchQuery=s),onInput:e[5]||(e[5]=(...s)=>d.searchUsers&&d.searchUsers(...s)),placeholder:"ユーザーを検索...",class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,544),[[h,l.userSearchQuery]]),l.searchResults.length>0?(a(),n("div",G,[(a(!0),n(_,null,A(l.searchResults,s=>(a(),n("div",{key:s.id,onClick:te=>d.selectUser(s),class:"p-2 hover:bg-gray-100 cursor-pointer"},i(s.name)+" ("+i(s.email)+") ",9,J))),128))])):m("",!0),l.selectedUser?(a(),n("div",K,[t("span",P,"選択中: "+i(l.selectedUser.name)+" ("+i(l.selectedUser.email)+")",1),t("button",{type:"button",onClick:e[6]||(e[6]=(...s)=>d.clearUserSelection&&d.clearUserSelection(...s)),class:"ml-2 text-red-600 text-sm"},"削除")])):m("",!0)])):m("",!0)]),o.form.errors.target_type?(a(),n("div",W,i(o.form.errors.target_type),1)):m("",!0),o.form.errors.target_id?(a(),n("div",X,i(o.form.errors.target_id),1)):m("",!0)]),t("div",null,[t("label",Y,[c(t("input",{type:"checkbox",id:"is_published","onUpdate:modelValue":e[7]||(e[7]=s=>o.form.is_published=s),class:"mr-2"},null,512),[[C,o.form.is_published]]),e[16]||(e[16]=t("span",{class:"text-sm font-medium text-gray-700"},"公開する",-1))])]),t("div",Z,[y(U,{href:r.route("admin.notifications.index"),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:b(()=>[...e[17]||(e[17]=[p(" キャンセル ",-1)])]),_:1},8,["href"]),t("button",{type:"submit",disabled:o.form.processing,class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50"},i(o.form.processing?"更新中...":"更新"),9,$)])],32)])])])])]),_:1})],64)}const ne=M(Q,[["render",ee]]);export{ne as default};
