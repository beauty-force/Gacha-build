import{r as f,l as I,o as i,w as d,a as _,b as e,c as r,t as c,e as g,F as v,f as w,i as C,n as p,d as m}from"./app-DFfLvpWw.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as P,h as S,G as B,Y as T}from"./useConfirm-DdSEq25l.js";import{r as q}from"./PlayIcon-Ddy9joA0.js";const G={name:"GachaConfirmDialog",components:{Dialog:T,DialogPanel:B,TransitionChild:S,TransitionRoot:P},props:{isOpen:{type:Boolean,default:!1},gachaTitle:{type:String,required:!0},number:{type:Number,required:!0},pointCost:{type:Number,required:!0},currentPoints:{type:Number,required:!0},isDpGacha:{type:Boolean,default:!1},thumbnail:{type:String,required:!0},gachaItems:{type:Array,default:()=>[]},currentUserItems:{type:Array,default:()=>[]},hasSufficientBalance:{type:Boolean,default:!0}},computed:{remainingPoints(){return this.currentPoints-this.pointCost},pointType(){return this.isDpGacha?"EP":"ポイント"}},methods:{formatNumber(s){return String(s).replace(/(.)(?=(\d{3})+$)/g,"$1,")},closeDialog(){this.$emit("close")},confirmAction(){this.$emit("confirm"),this.closeDialog()}}},N={class:"fixed inset-0 overflow-y-auto"},L={class:"flex min-h-full items-center justify-center p-4"},j=["src"],A={class:"text-center my-4"},U={class:"text-lg font-bold text-gray-900 mb-2"},E={class:"text-sm text-gray-600 font-medium"},F={key:0},Q={class:"font-bold text-red-500 text-base pr-0.5"},V={key:1},O={class:"font-bold text-red-500 text-base pr-0.5"},R={class:"font-bold"},z={key:0,class:"mb-3 p-2 bg-red-50 border border-red-200 rounded-lg"},Y={class:"space-y-1.5"},H={class:"flex items-center gap-2"},J=["src"],K={class:"text-xs font-medium"},M={class:"flex flex-col items-end text-right space-y-0.5"},W={class:"text-xs text-red-600 font-bold"},X={class:"text-xs text-red-700"},Z={key:1,class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg"},$={class:"text-sm text-red-800 font-semibold mb-2"},tt={key:0},et={key:1},st={class:"text-xs text-red-700"},at={key:2,class:"mb-4 space-y-2"},nt={class:"flex items-center gap-2"},ot=["src"],it={class:"text-xs font-medium"},rt={class:"flex flex-col items-end text-right space-y-0.5"},ct={class:"text-xs text-red-600 font-bold"},lt={class:"flex items-center gap-1.5"},ut={class:"text-sm font-bold text-gray-900"},ht={key:3,class:"flex items-center justify-center mb-6 bg-gray-50 rounded-lg p-4"},dt={class:"flex items-center space-x-2"},gt={class:"text-lg font-bold text-gray-900"},mt={class:"w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center"},ft={key:0,src:"/images/icon_cash.png",class:"w-8 h-8"},_t={key:1,class:"text-sm text-white"},yt={class:"flex items-center space-x-2"},pt={class:"w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center"},xt={key:0,src:"/images/icon_cash.png",class:"w-8 h-8"},bt={key:1,class:"text-sm text-white"},vt={class:"flex flex-col space-y-3"},wt=["disabled"];function Ct(s,t,a,h,l,o){const y=f("TransitionChild"),u=f("DialogPanel"),x=f("Dialog"),k=f("TransitionRoot");return i(),I(k,{appear:"",show:a.isOpen,as:"template"},{default:d(()=>[_(x,{as:"div",onClose:o.closeDialog,class:"relative z-50"},{default:d(()=>[_(y,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:d(()=>[...t[2]||(t[2]=[e("div",{class:"fixed inset-0 bg-black/50"},null,-1)])]),_:1}),e("div",N,[e("div",L,[_(y,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:d(()=>[_(u,{class:"w-full max-w-md transform overflow-hidden rounded-lg bg-white p-6 text-left align-middle shadow-xl transition-all font-sans"},{default:d(()=>[e("img",{src:a.thumbnail,class:"w-full h-auto"},null,8,j),e("div",A,[e("h3",U," 「"+c(a.gachaTitle)+"」 ",1),t[6]||(t[6]=e("p",{class:"text-base text-gray-700 mb-1 font-medium"}," ガチャを引きますか？ ",-1)),e("p",E,[a.gachaItems&&a.gachaItems.length>0?(i(),r("span",F,[e("span",Q,c(a.number),1),t[3]||(t[3]=g("回分の以下のアイテムを消費します: ",-1))])):(i(),r("span",V,[e("span",O,c(a.number),1),t[4]||(t[4]=g("回分の",-1)),e("span",R,c(o.pointType),1),t[5]||(t[5]=g("を消費します。 ",-1))]))])]),!a.hasSufficientBalance&&a.gachaItems&&a.gachaItems.length>0?(i(),r("div",z,[t[7]||(t[7]=e("p",{class:"text-xs text-red-800 font-semibold mb-1.5"}," ⚠️ アイテムが足りません ",-1)),e("div",Y,[(i(!0),r(v,null,w(a.currentUserItems,(n,b)=>(i(),r("div",{key:b,class:"bg-white rounded p-1.5 flex items-center justify-between gap-3"},[e("div",H,[n.image?(i(),r("img",{key:0,src:n.image,class:"w-10 h-10 object-contain rounded"},null,8,J)):C("",!0),e("span",K,c(n.name),1)]),e("div",M,[e("span",W," 消費: × "+c((n.quantity*a.number).toLocaleString()),1),e("span",X," 所持: "+c((n.userItem?n.userItem.quantity:0).toLocaleString())+"個 ",1)])]))),128))])])):a.hasSufficientBalance?a.gachaItems&&a.gachaItems.length>0?(i(),r("div",at,[(i(!0),r(v,null,w(a.currentUserItems,(n,b)=>(i(),r("div",{key:b,class:"bg-gray-50 rounded-lg p-2 flex items-center justify-between gap-3"},[e("div",nt,[n.image?(i(),r("img",{key:0,src:n.image,class:"w-10 h-10 object-contain rounded"},null,8,ot)):C("",!0),e("span",it,c(n.name),1)]),e("div",rt,[e("span",ct," 消費: × "+c((n.quantity*a.number).toLocaleString()),1),e("div",lt,[e("span",ut,c((n.userItem?n.userItem.quantity:0).toLocaleString()),1),t[10]||(t[10]=e("span",{class:"text-sm text-gray-400"},">",-1)),e("span",{class:p(["text-sm font-bold",(n.userItem?n.userItem.quantity:0)-n.requiredQuantity<0?"text-red-600":"text-red-500"])},c(((n.userItem?n.userItem.quantity:0)-n.requiredQuantity).toLocaleString()),3)])])]))),128))])):(i(),r("div",ht,[e("div",dt,[e("span",gt,c(a.currentPoints.toLocaleString()),1),e("div",mt,[a.isDpGacha?(i(),r("span",_t,"EP")):(i(),r("img",ft))])]),t[11]||(t[11]=e("div",{class:"mx-4 text-2xl text-gray-400"},">",-1)),e("div",yt,[e("span",{class:p(["text-lg font-bold",o.remainingPoints<0?"text-red-600":"text-red-500"])},c(o.remainingPoints.toLocaleString()),3),e("div",pt,[a.isDpGacha?(i(),r("span",bt,"EP")):(i(),r("img",xt))])])])):(i(),r("div",Z,[e("p",$,[t[8]||(t[8]=g(" ⚠️ ",-1)),a.isDpGacha?(i(),r("span",tt,"EPが")):(i(),r("span",et,"ポイントが")),t[9]||(t[9]=g("足りません ",-1))]),e("p",st," 必要"+c(o.pointType)+": "+c(a.pointCost.toLocaleString())+" / 所持"+c(o.pointType)+": "+c(a.currentPoints.toLocaleString()),1)])),e("div",vt,[e("button",{onClick:t[0]||(t[0]=(...n)=>o.confirmAction&&o.confirmAction(...n)),disabled:!a.hasSufficientBalance,class:p(["w-full font-bold py-3 px-4 rounded-md transition-colors duration-200",a.hasSufficientBalance?"bg-yellow-400 hover:bg-yellow-500 text-black cursor-pointer":"bg-gray-300 text-gray-500 cursor-not-allowed opacity-60"])}," オリパを引く ",10,wt),e("button",{onClick:t[1]||(t[1]=(...n)=>o.closeDialog&&o.closeDialog(...n)),class:"w-full bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-3 px-4 rounded-md transition-colors duration-200"}," キャンセル ")])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])}const kt=D(G,[["render",Ct]]),Dt={components:{Link:m.Link,PlayIcon:q,GachaConfirmDialog:kt},props:{gacha:Object},data(){return{category_share:m.usePage().props.value.category_share,processing:!1,buttons:[],showConfirmDialog:!1,selectedNumber:0,selectedPointCost:0,colorThemes:["from-neutral-500 to-neutral-700 hover:from-neutral-600 hover:to-neutral-800","from-yellow-400 to-yellow-600 hover:from-yellow-500 hover:to-yellow-700","from-red-500 to-red-700 hover:from-red-600 hover:to-red-800","from-blue-500 to-blue-700 hover:from-blue-600 hover:to-blue-800","from-green-500 to-green-700 hover:from-green-600 hover:to-green-800"]}},computed:{displayButtons(){if(!this.buttons||this.buttons.length===0)return this.getDefaultButtons();let s=this.buttons;if(this.gacha.count_rest!==void 0){if(s=this.buttons.filter(t=>t<=this.gacha.count_rest),s.length===0)return[];s[s.length-1]<this.gacha.count_rest&&this.buttons.length>s.length&&s.push(this.gacha.count_rest)}return s.map((t,a)=>{const h=t*this.gacha.point,l=this.gacha.count_rest!==void 0&&t>=this.gacha.count_rest?"全て":t==1?"1回":`${t}連`,o=a%this.colorThemes.length;return{number:t,point:h,text:l,classes:this.gacha.count_rest!==void 0&&t>=this.gacha.count_rest||t>=100?"all_button":this.colorThemes[o]}})},currentUserPoints(){const s=m.usePage().props.value.auth.user;return s?this.gacha.dp_gacha?s.dp:s.point:0},currentUserItems(){if(!this.gacha.items||!Array.isArray(this.gacha.items)||this.gacha.items.length===0)return[];const s=m.usePage().props.value.auth.user;return!s||!s.items?[]:this.gacha.items.map(t=>{const a=s.items.find(h=>h.item_id===t.id)||null;return{...t,userItem:a,requiredQuantity:t.quantity*this.selectedNumber}})},hasSufficientBalance(){return this.gacha.items&&Array.isArray(this.gacha.items)&&this.gacha.items.length>0?this.currentUserItems.every(s=>s.userItem&&s.userItem.quantity>=s.requiredQuantity):this.currentUserPoints>=this.selectedPointCost}},methods:{format_number(s){return String(s).replace(/(.)(?=(\d{3})+$)/g,"$1,")},getDefaultButtons(){const s=[];if(s.push({number:1,point:this.gacha.point,text:"1回",classes:this.colorThemes[0]}),(this.gacha.count_rest===void 0||this.gacha.count_rest>1)&&(this.gacha.gacha_limit==0||this.gacha.gacha_limit>1)){const t=this.gacha.count_rest!==void 0&&this.gacha.count_rest<=10?this.gacha.count_rest:10;s.push({number:t,point:t*this.gacha.point,text:this.gacha.count_rest!==void 0&&this.gacha.count_rest<=10?"全て":"10連",classes:this.colorThemes[1]})}if((this.gacha.count_rest===void 0||this.gacha.count_rest>10)&&(this.gacha.gacha_limit==0||this.gacha.gacha_limit>10)){const t=this.gacha.count_rest!==void 0&&this.gacha.count_rest<=100?this.gacha.count_rest:100;s.push({number:t,point:t*this.gacha.point,text:this.gacha.count_rest!==void 0&&this.gacha.count_rest<=100?"全て":"100連",classes:"all_button"})}return s},clickgacha(s){this.selectedNumber=s,this.selectedPointCost=this.gacha.point*s,this.showConfirmDialog=!0},closeConfirmDialog(){this.showConfirmDialog=!1},confirmGacha(){this.hasSufficientBalance&&this.start_gacha(this.selectedNumber)},start_gacha(s){this.processing=!0,!this.url_edit&&m.useForm({id:this.gacha.id,number:s,code:this.gacha.code}).post(route("user.gacha.start_post"),{onFinish:()=>{this.processing=!1}})}},mounted(){this.url_edit||(this.url_card=route("user.gacha",this.gacha.id)+this.category_share.cat_route_appendix),this.buttons=this.gacha.buttons?this.gacha.buttons.split(",").map(s=>parseInt(s)).sort((s,t)=>s-t):[]}},It={key:0,class:"w-full mx-auto flex flex-col justify-center py-1 px-1 gap-2 md:max-w-md"},Pt={class:"grid grid-cols-2 gap-2 font-[mplus2]"},St=["onClick","disabled"],Bt={class:"text-nowrap flex items-center justify-center min-w-36"},Tt={class:"font-extrabold text-[15px]"};function qt(s,t,a,h,l,o){const y=f("GachaConfirmDialog");return a.gacha.is_sold_out?C("",!0):(i(),r("div",It,[e("div",Pt,[(i(!0),r(v,null,w(o.displayButtons,(u,x)=>(i(),r("button",{key:u.number,onClick:k=>o.clickgacha(u.number),class:p([[u.classes,{"opacity-50":l.processing},{"col-span-2":x===o.displayButtons.length-1&&o.displayButtons.length%2===1}],"cursor-pointer rounded-md bg-gradient-to-br border border-yellow-400/50 text-white text-center space-y-1 pt-1.5 pb-2"]),disabled:l.processing},[e("div",Bt,[e("span",Tt,c(u.text),1),t[0]||(t[0]=e("span",{class:"font-semibold text-[11px]"},"ガチャ",-1))])],10,St))),128))]),_(y,{"is-open":l.showConfirmDialog,"gacha-title":a.gacha.title,number:l.selectedNumber,"point-cost":l.selectedPointCost,thumbnail:a.gacha.thumbnail??a.gacha.image,"current-points":o.currentUserPoints,"is-dp-gacha":a.gacha.dp_gacha==1,"gacha-items":a.gacha.items,"current-user-items":o.currentUserItems,"has-sufficient-balance":o.hasSufficientBalance,onClose:o.closeConfirmDialog,onConfirm:o.confirmGacha},null,8,["is-open","gacha-title","number","point-cost","thumbnail","current-points","is-dp-gacha","gacha-items","current-user-items","has-sufficient-balance","onClose","onConfirm"])]))}const At=D(Dt,[["render",qt]]);export{At as G};
