import{p as h,c as r,o as n,a as x,u as z,d as D,w as _,b as e,e as b,i as g,t as u,n as M,F as f,f as p,h as y,Z as S,j as O,v as Z,g as G}from"./app-CUpOazTT.js";import{d as K}from"./index-BWNG55Pa.js";import{A as Q}from"./UserLayout-BGijKUfb.js";import{k as L}from"./useConfirm-DNxwfvJr.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-C7J3DJlI.js";const X={class:"py-3 md:py-4"},Y={class:"max-w-4xl mx-auto px-4 lg:px-8"},ee={class:"mb-4"},te={class:"bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden mb-4"},se={class:"p-4 bg-gradient-to-r from-yellow-50 to-amber-50 border-b border-gray-200"},oe={class:"flex items-start justify-between mb-2"},le={class:"font-bold text-gray-900 text-lg flex-1"},re={class:"text-xs text-gray-500"},ne={class:"p-4 bg-gray-50 border-b border-gray-200"},ie={class:"text-sm text-gray-700 whitespace-pre-line"},ae={key:0,class:"mt-3"},de={class:"grid grid-cols-3 gap-2"},ue=["onClick"],ce=["src","alt"],ge={key:0,class:"p-4"},me={class:"text-sm font-bold text-gray-900 mb-4 flex items-center"},ve={class:"space-y-4"},he={key:0,class:"flex justify-end"},fe={class:"max-w-[85%] bg-blue-50 border border-blue-200 rounded-lg p-3"},xe={class:"flex items-center gap-1.5 mb-1.5"},be={class:"text-xs text-gray-500"},pe={class:"text-sm text-gray-800 whitespace-pre-line"},ye={key:0,class:"mt-2 grid grid-cols-3 gap-1.5"},we=["src","onClick"],ke={key:1,class:"flex justify-start"},_e={class:"max-w-[85%] bg-white border border-gray-300 rounded-lg p-3"},Ce={class:"flex items-center gap-1.5 mb-1.5"},je={class:"text-xs text-gray-500"},Me={class:"text-sm text-gray-800 whitespace-pre-line"},qe={key:0,class:"mt-2 grid grid-cols-3 gap-1.5"},Ie=["src","onClick"],Be={key:1,class:"p-4"},$e={class:"flex flex-col items-center justify-center h-screen p-4 gap-2"},ze={class:"relative z-10 flex items-center justify-center gap-4 w-full max-w-6xl flex-shrink-0"},De={class:"px-4 py-2 bg-white rounded-full text-gray-900 text-sm font-bold shadow-xl"},Se={class:"flex-1 flex justify-end"},Le={class:"relative z-10 flex flex-col items-center w-full max-w-6xl flex-1 min-h-0 gap-2"},Re={class:"flex-1 flex items-center justify-center min-h-0 w-full"},Ee=["src"],Ae={key:0,class:"flex items-center justify-center gap-3 flex-shrink-0"},Fe=["disabled"],Te=["disabled"],Ve={key:0,class:"fixed inset-0 z-[9999]"},Ne={class:"flex items-center justify-center min-h-screen px-4 py-4"},Je={class:"relative bg-white rounded-xl shadow-2xl max-w-lg w-full p-6 z-10"},Pe={class:"mb-4"},Ue={class:"mb-4"},He={key:0,class:"mt-2 grid grid-cols-3 gap-2"},Oe=["src"],Ze=["onClick"],Ge={class:"flex gap-3 justify-end"},Ke=["disabled"],Qe={__name:"Show",props:{question:Object},setup(l){const R=l,c=h(null),a=h(0),C=h(!1),v=h(""),m=h([]),E=h(null),w=h(!1),j=(o,t)=>{c.value=o,a.value=t},q=()=>{c.value=null,a.value=0},A=()=>{a.value<c.value.length-1&&a.value++},F=()=>{a.value>0&&a.value--},I=o=>{let t=[...o.images||[]];return o.replies&&o.replies.forEach(s=>{t=t.concat(s.images||[])}),t},B=(o,t,s)=>{let i=(o.images||[]).length;for(let d of o.replies){if(d.id===t.id)return i+s;i+=(d.images||[]).length}return 0},T=()=>{v.value="",m.value=[],C.value=!0},k=()=>{C.value=!1,v.value="",m.value=[]},V=o=>{const t=Array.from(o.target.files);if(m.value.length+t.length>3){alert("画像は最大3枚までです");return}t.forEach(s=>{const i=new FileReader;i.onload=d=>{m.value.push({file:s,preview:d.target.result})},i.readAsDataURL(s)}),o.target.value=""},N=o=>{m.value.splice(o,1)},J=async()=>{if(!v.value.trim())return;w.value=!0;const o=new FormData;o.append("message",v.value),m.value.forEach((t,s)=>{o.append(`images[${s}]`,t.file)});try{const t=await G.post(route("user.support-question.reply",R.question.id),o,{headers:{"Content-Type":"multipart/form-data"}});k(),await L.fire({icon:"success",title:"送信完了",text:t.data.message,confirmButtonColor:"#3b82f6"}),K.Inertia.reload()}catch{k(),await L.fire({icon:"error",title:"エラー",text:"送信に失敗しました"})}finally{w.value=!1}},$=o=>new Date(o).toLocaleDateString("ja-JP",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),P=o=>({pending:"対応中",answered:"完了",closed:"クローズ"})[o]||o,U=o=>new Date(o).toLocaleDateString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return(o,t)=>(n(),r(f,null,[x(z(D.Head),{title:"お問い合わせ詳細"}),x(Q,null,{default:_(()=>[e("div",X,[e("div",Y,[e("div",ee,[x(z(D.Link),{href:o.route("user.support-question.index"),class:"inline-flex items-center text-gray-600 hover:text-yellow-600 font-semibold text-sm"},{default:_(()=>[...t[3]||(t[3]=[e("svg",{class:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),b(" お問い合わせ一覧に戻る ",-1)])]),_:1},8,["href"])]),e("div",te,[e("div",se,[e("div",oe,[e("h1",le,u(l.question.subject),1),e("span",{class:M({"px-3 py-1 text-xs font-semibold rounded-full ml-2 whitespace-nowrap":!0,"bg-yellow-100 text-yellow-700":l.question.status==="pending","bg-green-100 text-green-700":l.question.status==="answered","bg-gray-100 text-gray-700":l.question.status==="closed"})},u(P(l.question.status)),3)]),e("div",re,u(U(l.question.created_at)),1)]),e("div",ne,[t[4]||(t[4]=e("h4",{class:"text-xs font-semibold text-gray-700 mb-2 flex items-center"},[e("svg",{class:"w-4 h-4 mr-1 text-orange-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),b(" あなたの質問 ")],-1)),e("p",ie,u(l.question.question),1),l.question.images&&l.question.images.length>0?(n(),r("div",ae,[e("div",de,[(n(!0),r(f,null,p(l.question.images,(s,i)=>(n(),r("div",{key:i,class:"relative bg-white rounded-lg overflow-hidden border border-gray-200 cursor-pointer hover:border-yellow-400 transition-all",onClick:d=>j(l.question.images,i)},[e("img",{src:`/images/support_questions/${s}`,alt:`添付画像 ${i+1}`,class:"w-full h-full object-contain"},null,8,ce)],8,ue))),128))])])):g("",!0)]),l.question.replies&&l.question.replies.length>0?(n(),r("div",ge,[e("h3",me,[t[5]||(t[5]=e("svg",{class:"w-5 h-5 mr-2 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1)),b(" 会話履歴 ("+u(l.question.replies.length)+") ",1)]),e("div",ve,[(n(!0),r(f,null,p(l.question.replies,s=>(n(),r("div",{key:s.id},[s.is_admin?(n(),r("div",he,[e("div",fe,[e("div",xe,[t[6]||(t[6]=e("svg",{class:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"})],-1)),t[7]||(t[7]=e("span",{class:"text-xs font-bold text-blue-700"},"サポート",-1)),e("span",be,u($(s.created_at)),1)]),e("p",pe,u(s.message),1),s.images&&s.images.length>0?(n(),r("div",ye,[(n(!0),r(f,null,p(s.images,(i,d)=>(n(),r("img",{key:d,src:`/images/support_questions/${i}`,class:"w-full h-16 object-cover rounded cursor-pointer border border-blue-100",onClick:H=>j(I(l.question),B(l.question,s,d))},null,8,we))),128))])):g("",!0)])])):(n(),r("div",ke,[e("div",_e,[e("div",Ce,[t[8]||(t[8]=e("svg",{class:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),t[9]||(t[9]=e("span",{class:"text-xs font-bold text-gray-700"},"あなた",-1)),e("span",je,u($(s.created_at)),1)]),e("p",Me,u(s.message),1),s.images&&s.images.length>0?(n(),r("div",qe,[(n(!0),r(f,null,p(s.images,(i,d)=>(n(),r("img",{key:d,src:`/images/support_questions/${i}`,class:"w-full h-16 object-cover rounded cursor-pointer border border-gray-200",onClick:H=>j(I(l.question),B(l.question,s,d))},null,8,Ie))),128))])):g("",!0)])]))]))),128))]),e("div",{class:"mt-4 pt-4 border-t border-gray-200"},[e("button",{onClick:T,class:"w-full px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold text-sm rounded-lg transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2"},[...t[10]||(t[10]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})],-1),b(" 返信する ",-1)])])])])):g("",!0),!l.question.replies||l.question.replies.length===0?(n(),r("div",Be,[...t[11]||(t[11]=[e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex items-start"},[e("svg",{class:"w-6 h-6 text-yellow-600 mr-3 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("div",null,[e("p",{class:"text-sm font-semibold text-yellow-800 mb-1"},"回答をお待ちください"),e("p",{class:"text-xs text-yellow-700"},"通常1-2営業日以内にご回答いたします")])],-1)])])):g("",!0)])])])]),_:1}),x(S,{name:"modal"},{default:_(()=>[c.value?(n(),r("div",{key:0,class:"fixed inset-0 z-[9999]",onClick:q},[e("div",$e,[t[16]||(t[16]=e("div",{class:"fixed inset-0 bg-gray-900 bg-opacity-90 transition-opacity"},null,-1)),e("div",ze,[t[13]||(t[13]=e("div",{class:"flex-1"},null,-1)),e("div",De,u(a.value+1)+" / "+u(c.value.length),1),e("div",Se,[e("button",{onClick:y(q,["stop"]),class:"p-3 bg-white rounded-full hover:bg-gray-100 transition-colors shadow-xl",type:"button",title:"閉じる"},[...t[12]||(t[12]=[e("svg",{class:"w-6 h-6 text-gray-800",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",Le,[e("div",Re,[e("img",{src:`/images/support_questions/${c.value[a.value]}`,alt:"拡大画像",class:"max-w-full max-h-full w-auto h-auto object-contain rounded-lg shadow-2xl border-4 border-white",onClick:t[0]||(t[0]=y(()=>{},["stop"]))},null,8,Ee)]),c.value.length>1?(n(),r("div",Ae,[e("button",{onClick:y(F,["stop"]),disabled:a.value===0,class:M({"p-3 rounded-full transition-all shadow-xl group":!0,"bg-white hover:bg-gray-100":a.value>0,"bg-gray-300 cursor-not-allowed opacity-50":a.value===0}),type:"button",title:"前へ"},[...t[14]||(t[14]=[e("svg",{class:"w-6 h-6 text-gray-800 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",d:"M15 19l-7-7 7-7"})],-1)])],10,Fe),e("button",{onClick:y(A,["stop"]),disabled:a.value>=c.value.length-1,class:M({"p-3 rounded-full transition-all shadow-xl group":!0,"bg-white hover:bg-gray-100":a.value<c.value.length-1,"bg-gray-300 cursor-not-allowed opacity-50":a.value>=c.value.length-1}),type:"button",title:"次へ"},[...t[15]||(t[15]=[e("svg",{class:"w-6 h-6 text-gray-800 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",d:"M9 5l7 7-7 7"})],-1)])],10,Te)])):g("",!0)])])])):g("",!0)]),_:1}),x(S,{name:"modal"},{default:_(()=>[C.value?(n(),r("div",Ve,[e("div",Ne,[t[21]||(t[21]=e("div",{class:"fixed inset-0 bg-gray-900 bg-opacity-75"},null,-1)),e("div",Je,[e("div",{class:"flex items-center justify-between mb-4"},[t[18]||(t[18]=e("h3",{class:"text-lg font-bold text-gray-900"},"返信を送信",-1)),e("button",{onClick:k,class:"text-gray-400 hover:text-gray-600"},[...t[17]||(t[17]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:y(J,["prevent"])},[e("div",Pe,[O(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>v.value=s),rows:"5",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400",placeholder:"返信メッセージを入力してください...",required:""},null,512),[[Z,v.value]])]),e("div",Ue,[t[20]||(t[20]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[b(" 画像を添付 "),e("span",{class:"text-gray-500 text-xs font-normal"},"(任意、最大3枚)")],-1)),e("input",{type:"file",ref_key:"replyImageInput",ref:E,accept:"image/*",multiple:"",onChange:V,class:"hidden"},null,544),e("button",{type:"button",onClick:t[2]||(t[2]=s=>o.$refs.replyImageInput.click()),class:"px-4 py-2 border border-gray-300 rounded-lg text-sm text-gray-700 hover:bg-gray-50"}," 画像を選択 "),m.value.length>0?(n(),r("div",He,[(n(!0),r(f,null,p(m.value,(s,i)=>(n(),r("div",{key:i,class:"relative"},[e("img",{src:s.preview,class:"w-full h-20 object-cover rounded"},null,8,Oe),e("button",{type:"button",onClick:d=>N(i),class:"absolute top-0 right-0 bg-red-500 text-white rounded-full p-1"},[...t[19]||(t[19]=[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Ze)]))),128))])):g("",!0)]),e("div",Ge,[e("button",{type:"button",onClick:k,class:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold rounded-lg"}," キャンセル "),e("button",{type:"submit",disabled:w.value||!v.value.trim(),class:"px-6 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold rounded-lg shadow-md hover:shadow-lg disabled:opacity-50"},u(w.value?"送信中...":"送信"),9,Ke)])],32)])])])):g("",!0)]),_:1})],64))}},ot=W(Qe,[["__scopeId","data-v-ae6494be"]]);export{ot as default};
