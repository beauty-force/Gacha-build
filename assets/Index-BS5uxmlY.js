import{d as v,r as f,c as d,o as u,a as n,w as c,b as t,t as m,j as p,v as _,F as x,f as y,k as V,h as D,e as g,i as O,n as T}from"./app-UZ-s_Caj.js";import{A as P}from"./Admin-CA1FXUOb.js";import{d as L}from"./index-CNhQzD2u.js";import{P as M}from"./Pagination-xR8RDHGT.js";import{S as z,h as A,V as N,G as R,Y as E,u as H}from"./useConfirm-BGb97mNx.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const{confirm:B}=H(),G={components:{Head:v.Head,AppLayout:P,Dialog:E,DialogPanel:R,DialogTitle:N,TransitionChild:A,TransitionRoot:z,Pagination:M},props:{errors:Object,category_share:Object,products:Object,products_status:Object,search_cond:Object,total:Number,lost_types:Object},data(){return{url2:null,open:!1,csvDialogOpen:!1,csvFile:null,imageFiles:[],csvUploading:!1,point_value:0}},methods:{get_product_status(){let o=this.products_status.map(l=>parseInt(l.products_lost_count)<parseInt(l.gacha_products_count)?` ${l.point.toLocaleString()} ポイントのカードが ${l.gacha_products_count} つ必要です。   現在の在庫数は ${l.products_lost_count}つです。
`:""),e="";return o.forEach(l=>{e=e+l}),e!=""&&(e+=`
`),e},destroy_product_last(o){B("削除してもいいですか？","","error").then(e=>{e&&L.Inertia.delete(route("admin.gacha.product_last.destroy",{id:o}))})},modalProductOpen(o){o?(this.form_last.last_id=o.id,this.form_last.last_name=o.name,this.form_last.last_point=o.point,this.form_last.last_rare=o.rare,this.form_last.last_marks=o.marks,this.form_last.last_lost_type=o.lost_type,this.form_last.last_image="",this.form_last.is_update=1,this.url2=o.image):(this.form_last.last_id="",this.form_last.last_name="",this.form_last.last_point="",this.form_last.last_rare="",this.form_last.last_marks="",this.form_last.last_lost_type="",this.form_last.last_image="",this.form_last.is_update=0,this.url2=""),this.open=!0},submit_last(){this.$refs.photo2.files[0]&&(this.form_last.last_image=this.$refs.photo2.files[0]),this.form_last.post(route("admin.lost_product.create"),{onFinish:()=>{}})},closeModal(){this.open=!1},previewImage2(o){const e=o.target.files[0];this.url2=URL.createObjectURL(e)},search(){this.form_search.get(route("admin.lost_product"))},clear(){this.form_search.rare="",this.form_search.name="",this.form_search.min="",this.form_search.max="",this.search()},onCsvFileChange(o){this.csvFile=o.target.files[0]},onImageFilesChange(o){this.imageFiles=Array.from(o.target.files)},removeImageFile(o){this.imageFiles.splice(o,1)},submitCsv(){if(!this.csvFile){alert("CSVファイルを選択してください");return}this.csvUploading=!0;try{v.useForm({csv:this.csvFile,category_id:this.category_share.cat_id,images:this.imageFiles}).post(route("admin.lost_product.upload_csv"),{preserveScroll:!0,onFinish:()=>{this.csvUploading=!1,this.csvDialogOpen=!1,this.csvFile=null,this.imageFiles=[]}})}catch{alert("アップロードに失敗しました"),this.csvUploading=!1}}},setup(o){let e={last_id:"",last_name:"",last_point:"",last_rare:"",last_marks:"",last_lost_type:"",last_image:"",is_update:0,category_id:o.category_share.cat_id};const l=v.useForm(e),a=v.useForm(o.search_cond);return{form_last:l,form_search:a}},mounted(){}},Y={class:"mt-3 px-5"},J={class:"text-red-600",style:{"white-space":"break-spaces"}},K={class:"flex justify-between items-center mb-2"},Q={class:"text-center flex gap-2"},W={class:"flex items-center gap-2 w-full flex-wrap mb-2 justify-between border p-2 text-sm"},X={class:"flex flex-col gap-2 flex-1"},Z={class:"flex flex-wrap gap-y-2"},$={class:"flex-1 flex items-center gap-2 min-w-[16rem]"},ee={class:"flex-1 flex items-center gap-2 min-w-[16rem]"},te=["value"],se={class:"flex items-center gap-2"},oe={class:"flex flex-col gap-2"},le={class:"border-neutral-200 border-b flex flex-wrap justify-between items-center gap-2"},ae={class:"flex border-neutral-200 items-center"},re=["src"],ne={class:"flex-1 inline-block text-sm py-1 px-2"},ie={class:"text-red-500"},de={class:"text-center flex flex-wrap gap-2"},ue=["onClick"],me=["onClick"],ce={class:"fixed inset-0 z-20 overflow-y-auto"},fe={class:"flex min-h-full items-center justify-center p-4 text-center sm:items-center sm:p-0"},pe={class:"mb-4"},_e={class:"text-red-500 text-sm mt-1"},ge={class:"mb-4"},be={class:"text-red-500 text-sm mt-1"},xe={class:"mb-4"},he=["value"],ve={class:"text-red-500 text-sm mt-1"},ye={class:"mb-4"},we={class:"text-red-500 text-sm mt-1"},ke={class:"mb-4"},Ce={class:"text-center w-full"},Fe=["src"],Ve={class:"text-red-500 text-sm mt-1"},De={class:"mb-6 text-center"},Oe=["disabled"],Se={class:"fixed inset-0 z-40 overflow-y-auto"},Ue={class:"flex min-h-full items-center justify-center p-4 text-center sm:items-center sm:p-0"},je={class:"mb-4"},Ie={class:"mb-4"},Te={key:0,class:"mt-2"},Pe={class:"mt-1 text-sm text-gray-500"},Le=["onClick"],Me={class:"flex gap-2 justify-end"},ze=["disabled"],Ae={key:0},Ne={key:1};function Re(o,e,l,a,i,r){const S=f("Head"),U=f("Pagination"),h=f("TransitionChild"),w=f("DialogPanel"),k=f("Dialog"),C=f("TransitionRoot"),j=f("DialogTitle"),I=f("AppLayout");return u(),d(x,null,[n(S,{title:"カード設定"}),n(I,{closeModal:r.closeModal},{default:c(()=>[t("div",Y,[t("div",J,m(r.get_product_status()),1),t("div",K,[e[21]||(e[21]=t("h1",{class:"text-lg font-bold"},"カード設定",-1)),t("div",Q,[t("button",{type:"button",onClick:e[0]||(e[0]=s=>i.csvDialogOpen=!0),class:"inline-block px-4 py-2 bg-emerald-600 text-white text-xs rounded hover:bg-emerald-700 transition-colors"}," CSVで登録 "),t("button",{type:"button",onClick:e[1]||(e[1]=s=>r.modalProductOpen(0)),class:"inline-block items-center px-10 py-2.5 bg-cyan-500 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-cyan-700 active:bg-cyan-700 focus:outline-none focus:border-cyan-700 focus:shadow-outline-cyan transition ease-in-out duration-150"}," 追加 ")])]),e[27]||(e[27]=t("hr",{class:"mb-2"},null,-1)),t("div",W,[t("div",X,[t("div",Z,[t("div",$,[e[22]||(e[22]=t("label",{class:"w-16 text-right"},"名前",-1)),p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>a.form_search.name=s),type:"text",class:"h-9 flex-1 w-0 border-neutral-300 focus:border-neutral-300 focus:ring focus:ring-neutral-200 focus:ring-opacity-50 rounded-md shadow-sm placeholder-neutral-300"},null,512),[[_,a.form_search.name]])]),t("div",ee,[e[24]||(e[24]=t("label",{class:"w-16 text-right"},"レア度",-1)),p(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.form_search.rare=s),id:"last_rare",class:"h-9 flex-1 w-0 border-neutral-300 focus:border-neutral-300 focus:ring focus:ring-neutral-200 focus:ring-opacity-50 rounded-md shadow-sm py-0 text-sm"},[e[23]||(e[23]=t("option",{value:""},"全て",-1)),(u(!0),d(x,null,y(l.lost_types,(s,b)=>(u(),d("option",{value:s},m(s),9,te))),256))],512),[[V,a.form_search.rare]])])]),t("div",se,[e[25]||(e[25]=t("label",{class:"w-16 text-right"},"ポイント",-1)),p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.form_search.min=s),type:"number",class:"h-9 flex-1 w-16 border-neutral-300 focus:border-neutral-300 focus:ring focus:ring-neutral-200 focus:ring-opacity-50 rounded-md shadow-sm placeholder-neutral-300"},null,512),[[_,a.form_search.min]]),e[26]||(e[26]=t("span",null,"~",-1)),p(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>a.form_search.max=s),type:"number",class:"h-9 flex-1 w-16 border-neutral-300 focus:border-neutral-300 focus:ring focus:ring-neutral-200 focus:ring-opacity-50 rounded-md shadow-sm placeholder-neutral-300"},null,512),[[_,a.form_search.max]])])]),t("div",oe,[t("button",{type:"button",onClick:e[6]||(e[6]=(...s)=>r.clear&&r.clear(...s)),class:"rounded-md border bg-neutral-600 text-white px-4 py-2"},"初期化"),t("button",{type:"button",onClick:e[7]||(e[7]=(...s)=>r.search&&r.search(...s)),class:"rounded-md border bg-neutral-600 text-white px-4 py-2"},"検索")])]),n(U,{search_cond:l.search_cond,route_name:"admin.lost_product",total:l.total},null,8,["search_cond","total"]),(u(!0),d(x,null,y(l.products.data,(s,b)=>(u(),d("div",le,[t("div",ae,[t("img",{src:s.image,class:"w-16 h-16 inline-block object-contain"},null,8,re),t("div",ne,[t("div",null,m(s.name),1),t("div",null,m(s.rare),1),t("div",null,m(s.marks.toLocaleString()),1),t("div",ie,m(s.point.toLocaleString())+"pt",1)])]),t("div",de,[t("button",{type:"button",onClick:F=>r.modalProductOpen(s),class:"inline-block items-center px-8 py-2 bg-green-500 rounded-md text-xs text-white uppercase tracking-widest hover:bg-green-700 active:bg-green-700 focus:outline-none focus:border-green-700 focus:shadow-outline-green transition ease-in-out duration-150"}," 編集 ",8,ue),t("button",{type:"button",onClick:F=>r.destroy_product_last(s.id),class:"inline-block items-center px-8 py-2 bg-red-500 rounded-md text-xs text-white uppercase tracking-widest hover:bg-red-700 active:bg-red-700 focus:outline-none focus:border-red-700 focus:shadow-outline-red transition ease-in-out duration-150"}," 削除 ",8,me)])]))),256))]),t("template",null,[n(C,{as:"template",show:i.open},{default:c(()=>[n(k,{as:"div",class:"relative z-20",onClose:e[15]||(e[15]=s=>i.open=!1)},{default:c(()=>[n(h,{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>[...e[28]||(e[28]=[t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)])]),_:1}),t("div",ce,[t("div",fe,[n(h,{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:c(()=>[n(w,{class:"p-3 relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg"},{default:c(()=>[t("form",{onSubmit:e[14]||(e[14]=D(s=>r.submit_last(),["prevent"]))},[t("div",pe,[e[29]||(e[29]=t("label",{for:"text1-1",class:"block font-medium text-sm text-neutral-700 mb-1"},[g("名前"),t("span",{class:"text-red-500"},"*")],-1)),p(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>a.form_last.last_name=s),id:"text1-1",type:"text",class:"w-full border-neutral-300 focus:border-neutral-300 focus:ring focus:ring-neutral-200 focus:ring-opacity-50 rounded-md shadow-sm placeholder-neutral-300",placeholder:"入力してください",required:""},null,512),[[_,a.form_last.last_name]]),t("div",_e,m(l.errors.last_name),1)]),t("div",ge,[e[30]||(e[30]=t("label",{for:"text1-2",class:"block font-medium text-sm text-neutral-700 mb-1"},[g("変換ポイント（半角数字）"),t("span",{class:"text-red-500"},"*")],-1)),p(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>a.form_last.last_point=s),id:"text1-2",type:"number",class:"w-full border-neutral-300 focus:border-neutral-300 focus:ring focus:ring-neutral-200 focus:ring-opacity-50 rounded-md shadow-sm placeholder-neutral-300",placeholder:"入力してください",required:""},null,512),[[_,a.form_last.last_point]]),t("div",be,m(l.errors.last_point),1)]),t("div",xe,[e[31]||(e[31]=t("label",{for:"text1-3",class:"block font-medium text-sm text-neutral-700 mb-1"},[g("レア度"),t("span",{class:"text-red-500"},"*")],-1)),p(t("select",{"onUpdate:modelValue":e[10]||(e[10]=s=>a.form_last.last_rare=s),id:"last_rare",class:"w-full border-neutral-300 focus:border-neutral-300 focus:ring focus:ring-neutral-200 focus:ring-opacity-50 rounded-md shadow-sm"},[(u(!0),d(x,null,y(l.lost_types,(s,b)=>(u(),d("option",{value:s},m(s),9,he))),256))],512),[[V,a.form_last.last_rare]]),t("div",ve,m(l.errors.last_rare),1)]),t("div",ye,[e[32]||(e[32]=t("label",{for:"text1-3",class:"block font-medium text-sm text-neutral-700 mb-1"},[g("点数（半角数字）"),t("span",{class:"text-red-500"},"*")],-1)),p(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>a.form_last.last_marks=s),id:"text1-3",type:"number",class:"w-full border-neutral-300 focus:border-neutral-300 focus:ring focus:ring-neutral-200 focus:ring-opacity-50 rounded-md shadow-sm placeholder-neutral-300",placeholder:"入力してください",required:""},null,512),[[_,a.form_last.last_marks]]),t("div",we,m(l.errors.last_marks),1)]),t("div",ke,[e[33]||(e[33]=t("label",{for:"file1-1",class:"block font-medium text-sm text-neutral-700 mb-1"},[g("画像アップロード "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Ce,[i.url2?(u(),d("img",{key:0,src:i.url2,class:"inline-block mt-4 h-24"},null,8,Fe)):O("",!0)]),t("input",{onChange:e[12]||(e[12]=(...s)=>r.previewImage2&&r.previewImage2(...s)),ref:"photo2",id:"file1-1",type:"file",class:"w-full"},null,544),t("div",Ve,m(l.errors.last_image),1)]),t("div",De,[t("button",{type:"submit",class:T([{"opacity-25":a.form_last.processing},"inline-block items-center px-8 py-2.5 bg-green-500 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-green-700 active:bg-green-700 focus:outline-none focus:border-green-700 focus:shadow-outline-green transition ease-in-out duration-150 mr-2"]),disabled:a.form_last.processing}," 保存 ",10,Oe),t("button",{type:"button",onClick:e[13]||(e[13]=s=>i.open=!1),class:"inline-block items-center px-8 py-2.5 bg-red-500 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-red-700 active:bg-red-700 focus:outline-none focus:border-red-700 focus:shadow-outline-red transition ease-in-out duration-150"}," キャンセル ")])],32)]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])]),t("template",null,[n(C,{as:"template",show:i.csvDialogOpen},{default:c(()=>[n(k,{as:"div",class:"relative z-30",onClose:e[20]||(e[20]=s=>i.csvDialogOpen=!1)},{default:c(()=>[n(h,{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>[...e[34]||(e[34]=[t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)])]),_:1}),t("div",Se,[t("div",Ue,[n(h,{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:c(()=>[n(w,{class:"p-4 relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-md"},{default:c(()=>[n(j,{class:"text-lg font-bold mb-2"},{default:c(()=>[...e[35]||(e[35]=[g("CSVでカード登録",-1)])]),_:1}),e[40]||(e[40]=t("div",{class:"mb-4"},[t("a",{href:"/gacha_csv/lost_product.csv",download:"",class:"text-blue-600 underline"},"CSVテンプレートをダウンロード")],-1)),t("form",{onSubmit:e[19]||(e[19]=D((...s)=>r.submitCsv&&r.submitCsv(...s),["prevent"]))},[t("div",je,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"CSVファイル",-1)),t("input",{type:"file",accept:".csv",onChange:e[16]||(e[16]=(...s)=>r.onCsvFileChange&&r.onCsvFileChange(...s)),class:"w-full"},null,32)]),t("div",Ie,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"画像ファイル",-1)),t("input",{type:"file",multiple:"",accept:"image/*",onChange:e[17]||(e[17]=(...s)=>r.onImageFilesChange&&r.onImageFilesChange(...s)),class:"w-full"},null,32),e[39]||(e[39]=t("p",{class:"text-sm text-gray-500 mt-1"}," 画像ファイルは任意です。CSVに記載された画像名と一致するファイルを選択してください。",-1)),i.imageFiles.length>0?(u(),d("div",Te,[e[37]||(e[37]=t("p",{class:"text-sm font-medium text-gray-700"},"選択された画像:",-1)),t("ul",Pe,[(u(!0),d(x,null,y(i.imageFiles,(s,b)=>(u(),d("li",{key:b,class:"flex items-center gap-2"},[t("span",null,m(s.name),1),t("button",{type:"button",onClick:F=>r.removeImageFile(b),class:"text-red-500 hover:text-red-700"}," × ",8,Le)]))),128))])])):O("",!0)]),t("div",Me,[t("button",{type:"button",onClick:e[18]||(e[18]=s=>i.csvDialogOpen=!1),class:"px-4 py-2 bg-neutral-300 text-neutral-700 rounded hover:bg-neutral-400"},"キャンセル"),t("button",{type:"submit",disabled:i.csvUploading,class:"px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed"},[i.csvUploading?(u(),d("span",Ae,"アップロード中...")):(u(),d("span",Ne,"登録"))],8,ze)])],32)]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])]),_:1},8,["closeModal"])],64)}const Je=q(G,[["render",Re]]);export{Je as default};
