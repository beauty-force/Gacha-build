import{d as p,r as a,c as d,o as m,a as n,w as r,b as t,j as x,v as b,F as v,f as _,e as w,t as f,n as T,h as I,i as U}from"./app-BTr9j_VE.js";import{A as L}from"./Admin-DY1IuaRu.js";import{d as E}from"./index-D2BEfFbA.js";import{P as A}from"./Pagination-DLHyBsbi.js";import{b as M,S as N,h as H,V as z,G as B,Y as R,u as X}from"./useConfirm-Z-qtAhiy.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const{confirm:Y}=X(),q={components:{Head:p.Head,AppLayout:L,Link:p.Link,Pagination:A,useForm:p.useForm,Dialog:R,DialogPanel:B,DialogTitle:z,TransitionChild:H,TransitionRoot:N,XMarkIcon:M},props:{errors:Object,auth:Object,category_share:Object,products:Object,search_cond:Object,total:Number},data(){return{csvDialogOpen:!1,csvFile:null,imageFiles:[],csvUploading:!1}},methods:{format_number(o){return String(o).replace(/(.)(?=(\d{3})+$)/g,"$1,")},destroyDp(o){Y("削除してもいいですか？","","error").then(e=>{e&&E.Inertia.delete(route("admin.dp.destroy",{id:o}),{preserveScroll:!0})})},search(){this.form_search.get(route("admin.dp"))},clear(){this.form_search.name="",this.form_search.min="",this.form_search.max="",this.search()},onCsvFileChange(o){this.csvFile=o.target.files[0]},onImageFilesChange(o){this.imageFiles=Array.from(o.target.files)},removeImageFile(o){this.imageFiles.splice(o,1)},submitCsv(){if(!this.csvFile){alert("CSVファイルを選択してください");return}this.csvUploading=!0;try{p.useForm({csv:this.csvFile,category_id:this.category_share.cat_id,images:this.imageFiles}).post(route("admin.dp.upload_csv"),{preserveScroll:!0,onFinish:()=>{this.csvUploading=!1,this.csvDialogOpen=!1,this.csvFile=null,this.imageFiles=[]}})}catch{alert("アップロードに失敗しました"),this.csvUploading=!1}}},setup(o){return{form_search:p.useForm(o.search_cond)}}},J={class:"py-4 md:px-6 px-4"},K={class:"flex justify-between items-center mb-3 gap-2"},Q={class:"flex items-center gap-2 w-full flex-wrap mb-2 justify-between border p-2 text-sm"},W={class:"flex flex-col gap-2 flex-1"},Z={class:"flex items-center gap-2"},$={class:"flex items-center gap-2"},ee={class:"flex flex-col gap-2"},te={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2"},se={class:"bg-white text-center relative rounded-lg shadow-md"},oe={class:"flex justify-between p-1"},le=["onClick"],ne={class:"text-center pt-2 px-4 flex justify-center"},ae=["src"],re={class:"text-sm pt-1 px-3 flex items-center justify-center font-bold"},ie={class:"p-1"},de={class:"rounded-full py-0.5 bg-neutral-800 text-neutral-100 w-[100px] text-sm"},me={class:"flex bg-white justify-center"},ce={class:"fixed inset-0 z-40 overflow-y-auto"},ue={class:"flex min-h-full items-center justify-center p-4 text-center sm:items-center sm:p-0"},pe={class:"mb-4"},fe={class:"mb-4"},ge={key:0,class:"mt-2"},xe={class:"mt-1 text-sm text-gray-500"},be=["onClick"],ve={class:"flex gap-2 justify-end"},he=["disabled"],ye={key:0},_e={key:1};function we(o,e,u,c,i,l){const C=a("Head"),k=a("Pagination"),h=a("Link"),y=a("TransitionChild"),F=a("DialogTitle"),D=a("XMarkIcon"),j=a("DialogPanel"),V=a("Dialog"),S=a("TransitionRoot"),O=a("AppLayout");return m(),d(v,null,[n(C,{title:"EP 設定"}),n(O,null,{default:r(()=>[t("div",J,[t("div",K,[e[11]||(e[11]=t("h1",{class:"text-lg font-bold"},"EP 設定",-1)),t("button",{type:"button",onClick:e[0]||(e[0]=s=>i.csvDialogOpen=!0),class:"inline-block px-4 py-2 bg-emerald-600 text-white text-xs rounded hover:bg-emerald-700 transition-colors"}," CSVで登録 ")]),t("div",Q,[t("div",W,[t("div",Z,[e[12]||(e[12]=t("label",{class:"w-16 text-right"},"名前",-1)),x(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>c.form_search.name=s),type:"text",class:"h-9 flex-1 w-0 border-neutral-300 focus:border-neutral-300 focus:ring focus:ring-neutral-200 focus:ring-opacity-50 rounded-md shadow-sm placeholder-neutral-300"},null,512),[[b,c.form_search.name]])]),t("div",$,[e[13]||(e[13]=t("label",{class:"w-16 text-right"},"EP",-1)),x(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>c.form_search.min=s),type:"number",class:"h-9 flex-1 w-16 border-neutral-300 focus:border-neutral-300 focus:ring focus:ring-neutral-200 focus:ring-opacity-50 rounded-md shadow-sm placeholder-neutral-300"},null,512),[[b,c.form_search.min]]),e[14]||(e[14]=t("span",null,"~",-1)),x(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>c.form_search.max=s),type:"number",class:"h-9 flex-1 w-16 border-neutral-300 focus:border-neutral-300 focus:ring focus:ring-neutral-200 focus:ring-opacity-50 rounded-md shadow-sm placeholder-neutral-300"},null,512),[[b,c.form_search.max]])])]),t("div",ee,[t("button",{type:"button",onClick:e[4]||(e[4]=(...s)=>l.clear&&l.clear(...s)),class:"rounded-md border bg-neutral-600 text-white px-4 py-2"},"初期化"),t("button",{type:"button",onClick:e[5]||(e[5]=(...s)=>l.search&&l.search(...s)),class:"rounded-md border bg-neutral-600 text-white px-4 py-2"},"検索")])]),n(k,{search_cond:u.search_cond,route_name:"admin.dp",total:u.total},null,8,["search_cond","total"]),e[19]||(e[19]=t("hr",{class:"my-4"},null,-1)),t("div",te,[n(h,{href:o.route("admin.dp.create")+u.category_share.cat_route_appendix,class:"bg-white text-center relative rounded-lg shadow-md flex justify-center items-center"},{default:r(()=>[...e[15]||(e[15]=[t("div",{class:"rounded-full bg-green-500 text-3xl text-neutral-100 h-10 w-10"}," + ",-1)])]),_:1},8,["href"]),(m(!0),d(v,null,_(u.products.data,(s,g)=>(m(),d("div",se,[t("div",oe,[n(h,{href:o.route("admin.dp.edit",{id:s.id})+u.category_share.cat_route_appendix,class:"rounded px-4 py-2 bg-green-500 text-xs text-neutral-50"},{default:r(()=>[...e[16]||(e[16]=[w(" 編集する ",-1)])]),_:1},8,["href"]),t("button",{onClick:P=>l.destroyDp(s.id),class:"rounded px-4 py-2 bg-red-500 text-xs text-neutral-50"}," 削除 ",8,le)]),t("div",ne,[t("img",{class:"inline-block object-contain",src:s.image},null,8,ae)]),t("div",re,f(s.name),1),t("div",ie,[t("button",de,f(l.format_number(s.dp))+"EP ",1)]),t("div",me,[e[17]||(e[17]=t("span",{class:"text-sm leading-relaxed"},"残り ",-1)),t("span",{class:T(["font-semibold text-base",{"text-rose-500":s.marks<=5}])},f(s.marks),3),e[18]||(e[18]=t("span",{class:"text-sm leading-relaxed"}," 枚",-1))])]))),256))])]),t("template",null,[n(S,{as:"template",show:i.csvDialogOpen},{default:r(()=>[n(V,{as:"div",class:"relative z-30",onClose:e[10]||(e[10]=s=>i.csvDialogOpen=!1)},{default:r(()=>[n(y,{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:r(()=>[...e[20]||(e[20]=[t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)])]),_:1}),t("div",ce,[t("div",ue,[n(y,{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:r(()=>[n(j,{class:"p-4 relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-md"},{default:r(()=>[n(F,{class:"text-lg font-bold mb-2"},{default:r(()=>[...e[21]||(e[21]=[w("CSVでカード登録",-1)])]),_:1}),e[26]||(e[26]=t("div",{class:"mb-4"},[t("a",{href:"/gacha_csv/ep.csv",download:"",class:"text-blue-600 underline"},"CSVテンプレートをダウンロード")],-1)),t("form",{onSubmit:e[9]||(e[9]=I((...s)=>l.submitCsv&&l.submitCsv(...s),["prevent"]))},[t("div",pe,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"CSVファイル",-1)),t("input",{type:"file",accept:".csv",onChange:e[6]||(e[6]=(...s)=>l.onCsvFileChange&&l.onCsvFileChange(...s)),class:"w-full"},null,32)]),t("div",fe,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"画像ファイル",-1)),t("input",{type:"file",multiple:"",accept:"image/*",onChange:e[7]||(e[7]=(...s)=>l.onImageFilesChange&&l.onImageFilesChange(...s)),class:"w-full"},null,32),e[25]||(e[25]=t("p",{class:"text-sm text-gray-500 mt-1"}," 画像ファイルは任意です。CSVに記載された画像名と一致するファイルを選択してください。",-1)),i.imageFiles.length>0?(m(),d("div",ge,[e[23]||(e[23]=t("p",{class:"text-sm font-medium text-gray-700"},"選択された画像:",-1)),t("ul",xe,[(m(!0),d(v,null,_(i.imageFiles,(s,g)=>(m(),d("li",{key:g,class:"flex items-center gap-2"},[t("span",null,f(s.name),1),t("button",{type:"button",onClick:P=>l.removeImageFile(g),class:"text-red-500 hover:text-red-700"},[n(D,{class:"h-4 w-4"})],8,be)]))),128))])])):U("",!0)]),t("div",ve,[t("button",{type:"button",onClick:e[8]||(e[8]=s=>i.csvDialogOpen=!1),class:"px-4 py-2 bg-neutral-300 text-neutral-700 rounded hover:bg-neutral-400"},"キャンセル"),t("button",{type:"submit",disabled:i.csvUploading,class:"px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed"},[i.csvUploading?(m(),d("span",ye,"アップロード中...")):(m(),d("span",_e,"登録"))],8,he)])],32)]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])]),_:1})],64)}const Se=G(q,[["render",we]]);export{Se as default};
