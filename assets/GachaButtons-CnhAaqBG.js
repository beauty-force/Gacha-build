import{r as _,l as D,o as n,w as g,a as y,b as s,c as i,i as p,t as c,e as m,F as b,f as v,n as w,d as f}from"./app--y6khcIC.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as P,h as S,G as B,Y as T}from"./useConfirm-BC6buQP1.js";import{r as q}from"./PlayIcon-Cne2A0fL.js";const G={name:"GachaConfirmDialog",components:{Dialog:T,DialogPanel:B,TransitionChild:S,TransitionRoot:P},props:{isOpen:{type:Boolean,default:!1},gachaTitle:{type:String,required:!0},number:{type:Number,required:!0},pointCost:{type:Number,required:!0},currentPoints:{type:Number,required:!0},isDpGacha:{type:Boolean,default:!1},thumbnail:{type:String,required:!0},gachaItems:{type:Array,default:()=>[]},currentUserItems:{type:Array,default:()=>[]},hasSufficientBalance:{type:Boolean,default:!0}},computed:{remainingPoints(){return this.currentPoints-this.pointCost},remainingItemQuantity(){return!this.gachaItem||!this.currentUserItem?0:this.currentUserItem.quantity-this.number},pointType(){return this.isDpGacha?"EP":"ポイント"}},methods:{formatNumber(a){return String(a).replace(/(.)(?=(\d{3})+$)/g,"$1,")},closeDialog(){this.$emit("close")},confirmAction(){this.$emit("confirm"),this.closeDialog()}}},j={class:"fixed inset-0 overflow-y-auto"},N={class:"flex min-h-full items-center justify-center p-4"},L=["src"],U={class:"text-center my-4"},A={class:"text-lg font-bold text-gray-900 mb-2"},E={class:"text-sm text-gray-600 font-medium"},Q={key:0},F={class:"font-bold text-red-500 text-base pr-0.5"},V={key:1},O={class:"font-bold text-red-500 text-base pr-0.5"},R={class:"font-bold"},z={key:0,class:"mt-3 space-y-2"},Y={class:"flex items-center gap-2"},H=["src"],J={class:"text-sm font-medium"},K={class:"text-sm text-red-600 font-bold"},M={key:0,class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg"},W={class:"text-sm text-red-800 font-semibold mb-2"},X={key:0},Z={key:1},$={key:2},tt={key:0,class:"space-y-1"},et={key:1,class:"text-xs text-red-700"},st={key:1,class:"mb-6 space-y-3"},at={class:"flex items-center justify-between"},nt={class:"flex items-center gap-2"},it=["src"],ot={class:"text-sm font-medium"},rt={class:"flex items-center justify-center"},ct={class:"flex items-center space-x-2"},lt={class:"text-lg font-bold text-gray-900"},ht={class:"flex items-center space-x-2"},ut={key:2,class:"flex items-center justify-center mb-6 bg-gray-50 rounded-lg p-4"},dt={class:"flex items-center space-x-2"},gt={class:"text-lg font-bold text-gray-900"},mt={class:"w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center"},ft={key:0,src:"/images/icon_cash.png",class:"w-8 h-8"},_t={key:1,class:"text-sm text-white"},yt={class:"flex items-center space-x-2"},xt={class:"w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center"},pt={key:0,src:"/images/icon_cash.png",class:"w-8 h-8"},bt={key:1,class:"text-sm text-white"},vt={class:"flex flex-col space-y-3"},wt=["disabled"];function kt(a,t,e,u,l,r){const x=_("TransitionChild"),h=_("DialogPanel"),k=_("Dialog"),C=_("TransitionRoot");return n(),D(C,{appear:"",show:e.isOpen,as:"template"},{default:g(()=>[y(k,{as:"div",onClose:r.closeDialog,class:"relative z-50"},{default:g(()=>[y(x,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:g(()=>[...t[2]||(t[2]=[s("div",{class:"fixed inset-0 bg-black/50"},null,-1)])]),_:1}),s("div",j,[s("div",N,[y(x,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:g(()=>[y(h,{class:"w-full max-w-md transform overflow-hidden rounded-lg bg-white p-6 text-left align-middle shadow-xl transition-all font-sans"},{default:g(()=>[s("img",{src:e.thumbnail,class:"w-full h-auto"},null,8,L),s("div",U,[s("h3",A," 「"+c(e.gachaTitle)+"」 ",1),t[6]||(t[6]=s("p",{class:"text-base text-gray-700 mb-1 font-medium"}," ガチャを引きますか？ ",-1)),s("p",E,[e.gachaItems&&e.gachaItems.length>0?(n(),i("span",Q,[s("span",F,c(e.number),1),t[3]||(t[3]=m("回分の以下のアイテムを消費します: ",-1))])):(n(),i("span",V,[s("span",O,c(e.number),1),t[4]||(t[4]=m("回分の",-1)),s("span",R,c(r.pointType),1),t[5]||(t[5]=m("を消費します。 ",-1))]))]),e.gachaItems&&e.gachaItems.length>0?(n(),i("div",z,[(n(!0),i(b,null,v(e.gachaItems,(o,d)=>(n(),i("div",{key:d,class:"flex items-center justify-between p-2 bg-gray-50 rounded"},[s("div",Y,[o.image?(n(),i("img",{key:0,src:o.image,class:"w-8 h-8 object-contain rounded"},null,8,H)):p("",!0),s("span",J,c(o.name),1)]),s("span",K," × "+c((o.quantity*e.number).toLocaleString()),1)]))),128))])):p("",!0)]),e.hasSufficientBalance?e.gachaItems&&e.gachaItems.length>0?(n(),i("div",st,[(n(!0),i(b,null,v(e.currentUserItems,(o,d)=>(n(),i("div",{key:d,class:"bg-gray-50 rounded-lg p-3 flex items-center justify-between gap-3"},[s("div",at,[s("div",nt,[o.image?(n(),i("img",{key:0,src:o.image,class:"w-10 h-10 object-cover rounded"},null,8,it)):p("",!0),s("span",ot,c(o.name),1)])]),s("div",rt,[s("div",ct,[s("span",lt,c((o.userItem?o.userItem.quantity:0).toLocaleString()),1)]),t[9]||(t[9]=s("div",{class:"mx-4 text-2xl text-gray-400"},">",-1)),s("div",ht,[s("span",{class:w(["text-lg font-bold",(o.userItem?o.userItem.quantity:0)-o.requiredQuantity<0?"text-red-600":"text-red-500"])},c(((o.userItem?o.userItem.quantity:0)-o.requiredQuantity).toLocaleString()),3)])])]))),128))])):(n(),i("div",ut,[s("div",dt,[s("span",gt,c(e.currentPoints.toLocaleString()),1),s("div",mt,[e.isDpGacha?(n(),i("span",_t,"EP")):(n(),i("img",ft))])]),t[10]||(t[10]=s("div",{class:"mx-4 text-2xl text-gray-400"},">",-1)),s("div",yt,[s("span",{class:w(["text-lg font-bold",r.remainingPoints<0?"text-red-600":"text-red-500"])},c(r.remainingPoints.toLocaleString()),3),s("div",xt,[e.isDpGacha?(n(),i("span",bt,"EP")):(n(),i("img",pt))])])])):(n(),i("div",M,[s("p",W,[t[7]||(t[7]=m(" ⚠️ ",-1)),e.gachaItems&&e.gachaItems.length>0?(n(),i("span",X,"アイテムが")):e.isDpGacha?(n(),i("span",Z,"EPが")):(n(),i("span",$,"ポイントが")),t[8]||(t[8]=m("足りません ",-1))]),e.gachaItems&&e.gachaItems.length>0?(n(),i("div",tt,[(n(!0),i(b,null,v(e.currentUserItems,(o,d)=>(n(),i("div",{key:d,class:"text-xs text-red-700"},c(o.name)+": 必要 "+c(o.requiredQuantity.toLocaleString())+"個 / 所持 "+c((o.userItem?o.userItem.quantity:0).toLocaleString())+"個 ",1))),128))])):(n(),i("p",et," 必要"+c(r.pointType)+": "+c(e.pointCost.toLocaleString())+" / 所持"+c(r.pointType)+": "+c(e.currentPoints.toLocaleString()),1))])),s("div",vt,[s("button",{onClick:t[0]||(t[0]=(...o)=>r.confirmAction&&r.confirmAction(...o)),disabled:!e.hasSufficientBalance,class:w(["w-full font-bold py-3 px-4 rounded-md transition-colors duration-200",e.hasSufficientBalance?"bg-yellow-400 hover:bg-yellow-500 text-black cursor-pointer":"bg-gray-300 text-gray-500 cursor-not-allowed opacity-60"])}," オリパを引く ",10,wt),s("button",{onClick:t[1]||(t[1]=(...o)=>r.closeDialog&&r.closeDialog(...o)),class:"w-full bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-3 px-4 rounded-md transition-colors duration-200"}," キャンセル ")])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])}const Ct=I(G,[["render",kt]]),It={components:{Link:f.Link,PlayIcon:q,GachaConfirmDialog:Ct},props:{gacha:Object},data(){return{category_share:f.usePage().props.value.category_share,processing:!1,buttons:[],showConfirmDialog:!1,selectedNumber:0,selectedPointCost:0,colorThemes:["from-neutral-500 to-neutral-700 hover:from-neutral-600 hover:to-neutral-800","from-yellow-400 to-yellow-600 hover:from-yellow-500 hover:to-yellow-700","from-red-500 to-red-700 hover:from-red-600 hover:to-red-800","from-blue-500 to-blue-700 hover:from-blue-600 hover:to-blue-800","from-green-500 to-green-700 hover:from-green-600 hover:to-green-800"]}},computed:{displayButtons(){if(!this.buttons||this.buttons.length===0)return this.getDefaultButtons();let a=this.buttons;if(this.gacha.count_rest!==void 0){if(a=this.buttons.filter(t=>t<=this.gacha.count_rest),a.length===0)return[];a[a.length-1]<this.gacha.count_rest&&this.buttons.length>a.length&&a.push(this.gacha.count_rest)}return a.map((t,e)=>{const u=t*this.gacha.point,l=this.gacha.count_rest!==void 0&&t>=this.gacha.count_rest?"全て":t==1?"1回":`${t}連`,r=e%this.colorThemes.length;return{number:t,point:u,text:l,classes:this.gacha.count_rest!==void 0&&t>=this.gacha.count_rest||t>=100?"all_button":this.colorThemes[r]}})},currentUserPoints(){const a=f.usePage().props.value.auth.user;return a?this.gacha.dp_gacha?a.dp:a.point:0},currentUserItems(){if(!this.gacha.items||!Array.isArray(this.gacha.items)||this.gacha.items.length===0)return[];const a=f.usePage().props.value.auth.user;return!a||!a.items?[]:this.gacha.items.map(t=>{const e=a.items.find(u=>u.item_id===t.id)||null;return{...t,userItem:e,requiredQuantity:t.quantity*this.selectedNumber}})},hasSufficientBalance(){return this.gacha.items&&Array.isArray(this.gacha.items)&&this.gacha.items.length>0?!0:this.currentUserPoints>=this.selectedPointCost}},methods:{format_number(a){return String(a).replace(/(.)(?=(\d{3})+$)/g,"$1,")},getDefaultButtons(){const a=[];if(a.push({number:1,point:this.gacha.point,text:"1回",classes:this.colorThemes[0]}),(this.gacha.count_rest===void 0||this.gacha.count_rest>1)&&(this.gacha.gacha_limit==0||this.gacha.gacha_limit>1)){const t=this.gacha.count_rest!==void 0&&this.gacha.count_rest<=10?this.gacha.count_rest:10;a.push({number:t,point:t*this.gacha.point,text:this.gacha.count_rest!==void 0&&this.gacha.count_rest<=10?"全て":"10連",classes:this.colorThemes[1]})}if((this.gacha.count_rest===void 0||this.gacha.count_rest>10)&&(this.gacha.gacha_limit==0||this.gacha.gacha_limit>10)){const t=this.gacha.count_rest!==void 0&&this.gacha.count_rest<=100?this.gacha.count_rest:100;a.push({number:t,point:t*this.gacha.point,text:this.gacha.count_rest!==void 0&&this.gacha.count_rest<=100?"全て":"100連",classes:"all_button"})}return a},clickgacha(a){this.selectedNumber=a,this.selectedPointCost=this.gacha.point*a,this.showConfirmDialog=!0},closeConfirmDialog(){this.showConfirmDialog=!1},confirmGacha(){this.hasSufficientBalance&&this.start_gacha(this.selectedNumber)},start_gacha(a){this.processing=!0,!this.url_edit&&f.useForm({id:this.gacha.id,number:a,code:this.gacha.code}).post(route("user.gacha.start_post"),{onFinish:()=>{this.processing=!1},preserveScroll:!0})}},mounted(){this.url_edit||(this.url_card=route("user.gacha",this.gacha.id)+this.category_share.cat_route_appendix),this.buttons=this.gacha.buttons?this.gacha.buttons.split(",").map(a=>parseInt(a)).sort((a,t)=>a-t):[]}},Dt={key:0,class:"w-full mx-auto flex flex-col justify-center py-1 px-1 gap-2 md:max-w-md"},Pt={class:"grid grid-cols-2 gap-2 font-[mplus2]"},St=["onClick","disabled"],Bt={class:"text-nowrap flex items-center justify-center min-w-36"},Tt={class:"font-extrabold text-[15px]"};function qt(a,t,e,u,l,r){const x=_("GachaConfirmDialog");return e.gacha.is_sold_out?p("",!0):(n(),i("div",Dt,[s("div",Pt,[(n(!0),i(b,null,v(r.displayButtons,(h,k)=>(n(),i("button",{key:h.number,onClick:C=>r.clickgacha(h.number),class:w([[h.classes,{"opacity-50":l.processing},{"col-span-2":k===r.displayButtons.length-1&&r.displayButtons.length%2===1}],"cursor-pointer rounded-md bg-gradient-to-br border border-yellow-400/50 text-white text-center space-y-1 pt-1.5 pb-2"]),disabled:l.processing},[s("div",Bt,[s("span",Tt,c(h.text),1),t[0]||(t[0]=s("span",{class:"font-semibold text-[11px]"},"ガチャ",-1))])],10,St))),128))]),y(x,{"is-open":l.showConfirmDialog,"gacha-title":e.gacha.title,number:l.selectedNumber,"point-cost":l.selectedPointCost,thumbnail:e.gacha.thumbnail??e.gacha.image,"current-points":r.currentUserPoints,"is-dp-gacha":e.gacha.dp_gacha==1,"gacha-items":e.gacha.items,"current-user-items":r.currentUserItems,"has-sufficient-balance":r.hasSufficientBalance,onClose:r.closeConfirmDialog,onConfirm:r.confirmGacha},null,8,["is-open","gacha-title","number","point-cost","thumbnail","current-points","is-dp-gacha","gacha-items","current-user-items","has-sufficient-balance","onClose","onConfirm"])]))}const Ut=I(It,[["render",qt]]);export{Ut as G};
