import{o,c as i,d as e,H as S,L as C,a as x,u as L,r as f,b as P,w as M,F as k,i as T,h as c,t as h,J as j,a2 as N,e as w,I as z,f as O,n as B}from"./app.e7c23f9c.js";import{A as E}from"./UserLayout.81c4e9f2.js";import{u as I}from"./useConfirm.801861ec.js";import{_ as R}from"./_plugin-vue_export-helper.cdc0426e.js";import"./Category.6fc7e8bd.js";import"./index.f81cb397.js";function V(t,s){return o(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})])}const D=3,J="merchant.com.eve-gacha",H="apple-pay-button",U=route("apple_pay_validate"),{confirm:Le,alert:p}=I(),K={components:{Head:S,AdminLayout:E,Link:C,ArrowLeftIcon:V},props:{errors:Object,auth:Object,point:Object,is_admin:Number,amount:Number,amount_str:String,testOrLive:String,supported_pay_type:Object,rank:Object,coupon_id:Number,no_applepay_support:String,no_applepay_setting:String},data(){return{selectedMethod:null,agreeTerms:!1,loading:!1,card_payment_uri:"user.point.card_payment",payment_stage:"register",pay_type_titles:{Card:"\u30AF\u30EC\u30B8\u30C3\u30C8\u30AB\u30FC\u30C9",Paypay:"PayPay",Konbini:"\u30B3\u30F3\u30D3\u30CB\u6255\u3044",Virtualaccount:"\u9280\u884C\u632F\u8FBC",Applepay:"Apple Pay",amazonpay:"Amazon Pay"}}},methods:{selectPaymentMethod(t){this.selectedMethod=t},handleSubmit(){if(!this.selectedMethod){p("\u652F\u6255\u3044\u65B9\u6CD5\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044");return}if(!this.agreeTerms){p("\u500B\u4EBA\u60C5\u5831\u306E\u53D6\u308A\u6271\u3044\u306B\u540C\u610F\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059");return}if(!this.supported_pay_type.includes(this.selectedMethod)){p("\u3053\u306E\u652F\u6255\u3044\u65B9\u6CD5\u306F\u8FD1\u3005\u5B9F\u88C5\u3055\u308C\u308B\u4E88\u5B9A\u3067\u3059\u3002");return}if(this.selectedMethod=="Applepay"&&!window.ApplePaySession){p(this.no_applepay_support,"","error");return}this.paymentRegister(this.selectedMethod)},submit(){},format_number(t){return String(t).replace(/(.)(?=(\d{3})+$)/g,"$1,")},paymentRegister(t){if(this.loading=!0,t=="Card"){window.location.href=route(this.card_payment_uri,{id:this.point.id,coupon_id:this.coupon_id});return}x.post(this.is_admin==1?route("test.user.point.paymentRegister"):route("user.point.paymentRegister"),{id:this.point.id,pay_type:t,coupon_id:this.coupon_id}).then(s=>{if(s.data.status==0)p(s.data.message);else if(t=="Card"||t=="Paypay"||t=="Konbini"||t=="Virtualaccount")s.data.status&&(window.location.href=s.data.link_url);else if(t=="Applepay")this.loading=!1,this.payment_stage="Applepay",this.$nextTick(()=>{const a=document.getElementById("applepay_container");a.innerHTML="",window.ApplePaySession?ApplePaySession.canMakePaymentsWithActiveCard(J).then(r=>{if(r){const l=document.createElement("button");l.setAttribute("id",H),l.setAttribute("lang","ja-JP");const _="buy",y="#d68d2f";l.setAttribute("style",`-webkit-appearance: -apple-pay-button;
                                                -apple-pay-button-type: ${_};
                                                -apple-pay-button-style: ${y};
                                                width: 220px;
                                                height: 48px;
                                                text-align: center;
                                                font-size: 18px;
                                                border-radius: 5px;
                                                `),a.appendChild(l),l.addEventListener("click",v=>{const n={countryCode:"JP",currencyCode:"JPY",supportedNetworks:["visa","masterCard","jcb","amex"],merchantCapabilities:["supports3DS"],total:{label:s.data.response.label,amount:s.data.response.amount}},d=new ApplePaySession(D,n);d.onvalidatemerchant=m=>{const g=m.validationURL;fetch(U,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({validationURL:g})}).then(u=>u.json()).then(u=>{d.completeMerchantValidation(u)})},d.oncancel=m=>{},d.onpaymentauthorized=m=>{const g=m.payment.token;d.completePayment(ApplePaySession.STATUS_SUCCESS);const u=btoa(JSON.stringify(g.paymentData));x.post(this.is_admin==1?route("test.user.point.paymentExecute"):route("user.point.paymentExecute"),{pay_type:t,order_id:s.data.response.id,access_id:s.data.response.access_id,token:u}).then(b=>{b.data.status==0?p(b.data.message):window.location.href=route(b.data.redirect_uri)})},d.begin()})}else a.innerHTML=this.no_applepay_setting}):a.innerHTML=this.no_applepay_support});else if(t=="amazonpay"){const a=document.createElement("script");a.src="https://static-fe.payments-amazon.com/checkout.js",a.onload=this.renderAmazonPayButton.bind(this,s.data.response),document.head.appendChild(a)}this.loading=!1})},renderAmazonPayButton(t){this.loading=!1,this.payment_stage="amazonpay",amazon.Pay.renderButton("#amazonpay_container",{merchantId:t.merchant_id,publicKeyId:t.public_key_id,ledgerCurrency:"JPY",checkoutLanguage:"ja_JP",productType:"PayOnly",placement:"Checkout",buttonColor:"Gold",createCheckoutSessionConfig:{payloadJSON:JSON.stringify(t.payload),signature:t.signature,algorithm:"AMZN-PAY-RSASSA-PSS-V2"}})}},mounted(){var t;((t=L().props.value.auth.user)==null?void 0:t.type)==1&&(this.card_payment_uri="test.user.point.card_payment")}},Y={class:"flex justify-center items-center flex-1 bg-white py-2"},F={class:"text-center"},q={class:"p-6 w-full max-w-md"},G={key:0},W={class:"text-center text-xl font-semibold text-gray-800 mb-7"},Z={key:0,class:"text-rose-500 leading-8 text-base"},Q={class:"bg-gray-100 p-4 text-xl text-center mb-4"},X={class:"text-center text-gray-600 mb-4 py-4"},$={class:"flex items-center justify-center leading-7 gap-2"},ee=["href"],te=["onClick"],ne={key:0,class:"grid grid-cols-3 grid-rows-2 gap-1 w-24 h-10"},se=e("img",{src:"/images/credit_cards/visa.svg",alt:"Visa"},null,-1),ae=e("img",{src:"/images/credit_cards/master.svg",alt:"Mastercard"},null,-1),oe=e("img",{src:"/images/credit_cards/jcb.svg",alt:"JCB"},null,-1),ie=e("img",{src:"/images/credit_cards/amex.svg",alt:"American Express"},null,-1),re=e("img",{src:"/images/credit_cards/diners.svg",alt:"Diners Club"},null,-1),ce=e("img",{src:"/images/credit_cards/discover.svg",alt:"Discover"},null,-1),le=[se,ae,oe,ie,re,ce],de={key:1,src:"/images/payments/amazon-pay.png",alt:"Amazon Pay",class:"w-24 h-10 object-contain"},pe={key:2,src:"/images/payments/apple-pay.png",alt:"Apple Pay",class:"w-24 h-10 object-contain"},ue={key:3,src:"/images/payments/paypay.png",alt:"PayPay",class:"w-24 h-10 object-contain"},me={key:4,src:"/images/payments/konbini.png",alt:"Konbini",class:"w-36 h-10 object-contain"},he={key:5,src:"/images/payments/bank.png",alt:"Bank Transfer",class:"w-24 h-10 object-contain"},_e=["disabled"],ye={key:2,class:"fixed inset-0 flex justify-center items-center bg-gray-800 bg-opacity-75 z-[20]"},ge=e("div",{class:"w-16 h-16 bg-white p-4 rounded-full shadow-lg"},[e("svg",{class:"animate-spin h-8 w-8 text-yellow-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})])],-1),be=[ge],fe={key:3,class:"text-center mt-3",id:"applepay_container"},we=e("div",{class:"text-center mt-3",id:"amazonpay_container"},null,-1);function ve(t,s,a,A,r,l){const _=f("Head"),y=f("ArrowLeftIcon"),v=f("AdminLayout");return o(),i(k,null,[P(_,{title:"\u6C7A\u6E08\u767B\u9332"}),P(v,null,{default:M(()=>[e("div",Y,[e("div",F,[r.payment_stage!="register"?(o(),T(y,{key:0,onClick:s[0]||(s[0]=n=>r.payment_stage="register"),class:"absolute left-2 top-10 text-neutral-600 w-8 p-1.5 hover:bg-yellow-500 hover:text-white rounded-full cursor-pointer"})):c("",!0)]),e("div",q,[r.payment_stage=="register"?(o(),i("div",G,[e("h2",W,[e("div",null,h(l.format_number(a.point.point))+" \u30DD\u30A4\u30F3\u30C8\u8CFC\u5165",1),a.rank&&a.rank.pt_rate>0?(o(),i("span",Z," ( + "+h(l.format_number(a.point.point*a.rank.pt_rate/100))+" \u30DC\u30FC\u30CA\u30B9 ) ",1)):c("",!0)]),e("div",Q," \xA5 "+h(a.amount_str),1),e("div",X,[e("label",$,[j(e("input",{type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=n=>r.agreeTerms=n),class:"focus:ring-0 rounded-sm"},null,512),[[N,r.agreeTerms]]),w(" \u500B\u4EBA\u60C5\u5831\u306E\u53D6\u308A\u6271\u3044\u306B\u540C\u610F\u3059\u308B ")]),w(" \uFF08 "),e("a",{href:t.route("main.privacy_police"),class:"text-yellow-500 hover:text-yellow-600"},"\u53D6\u308A\u6271\u3044\u306E\u8A73\u7D30\u3092\u78BA\u8A8D\u3059\u308B",8,ee),w(" \uFF09 ")])])):c("",!0),r.payment_stage=="register"?(o(),i("form",{key:1,onSubmit:s[2]||(s[2]=z((...n)=>l.handleSubmit&&l.handleSubmit(...n),["prevent"]))},[(o(!0),i(k,null,O(a.supported_pay_type,n=>(o(),i("div",{class:"mb-4",key:n},[e("button",{type:"button",onClick:d=>l.selectPaymentMethod(n),class:B([{"border-yellow-500 bg-yellow-100 font-bold text-yellow-500":r.selectedMethod===n,"hover:bg-gray-100 hover:border-gray-300":r.selectedMethod!==n},"w-full px-4 py-2.5 bg-white border-2 border-gray-200 rounded-lg flex justify-between items-center transition duration-200 hover:-translate-y-0.5"])},[e("span",null,h(r.pay_type_titles[n]),1),n==="Card"?(o(),i("div",ne,le)):c("",!0),n==="amazonpay"?(o(),i("img",de)):c("",!0),n==="Applepay"?(o(),i("img",pe)):c("",!0),n==="Paypay"?(o(),i("img",ue)):c("",!0),n==="Konbini"?(o(),i("img",me)):c("",!0),n==="Virtualaccount"?(o(),i("img",he)):c("",!0)],10,te)]))),128)),e("button",{type:"submit",disabled:r.selectedMethod==null,class:"w-full p-4 bg-yellow-500 text-white rounded-lg text-lg font-semibold transition duration-200 hover:bg-yellow-600 mt-4"}," \u652F\u6255\u3044 ",8,_e)],32)):c("",!0),r.loading?(o(),i("div",ye,be)):c("",!0),r.payment_stage=="Applepay"?(o(),i("div",fe)):c("",!0),we])])]),_:1})],64)}const Me=R(K,[["render",ve]]);export{Me as default};
