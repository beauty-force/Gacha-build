import{d as _,r as b,c,o as d,a as v,w,i as u,b as e,F as p,f as x,l as U,n as m,e as g,t as o,j as k,v as C,m as L}from"./app-Tm8A02D3.js";import{A as N}from"./Admin-0sb7FiMf.js";import{P as S,r as F}from"./Pagination-jqmeNJoG.js";import{r as T,a as O,u as B}from"./useConfirm-Coie2nyx.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as R}from"./ArrowLeftIcon-CSWnBbEE.js";const{confirm:y}=B(),D={components:{Head:_.Head,AppLayout:N,Link:_.Link,ChevronLeftIcon:O,ChevronRightIcon:T,EllipsisHorizontalIcon:F,ArrowLeftIcon:R,Pagination:S},props:{errors:Object,gacha:Object,category_share:Object,products:Object,search_cond:Object,totalProducts:Number,totalPoints:Number,searchProducts:Number,searchPoints:Number},data(){return{hasCheck:!1,main_tab:[{title:"発送依頼中",route_url:route("admin.delivery"),is_active:!0},{title:"発送済み",route_url:route("admin.delivery.completed"),is_active:!1},{title:"取得済み",route_url:route("admin.delivery.acquired"),is_active:!1}],page_step:0,is_busy:!1,profile:{},user_products:[],user:{},hasCheck:!1,isCheckAll:!1}},setup(l){const t=_.useForm(l.search_cond),r=_.useForm({user_id:0,checks:{},tracking_number:"",delete:!1,add_point:!1}),n=_.useForm({checks:{}});return{form:r,form_search:t,delivery_products:n}},methods:{changeCheck(){let l,t=!1;for(this.isCheckAll=this.user_products.length>0,l=0;l<this.user_products.length;l++)this.form.checks["id"+this.user_products[l].id]?t=!0:this.isCheckAll=!1;this.hasCheck=t},showProductDetail(l){this.is_busy=!0;const t={user_id:l};axios.post(route("admin.delivery.product_data"),t).then(r=>{if((r.status==201||r.status==200)&&r.data.status){this.profile=r.data.profile,this.user=r.data.user,this.user_products=r.data.products,this.page_step=1,this.form.user_id=this.user.id,this.form.checks={},this.form.tracking_number="",this.hasCheck=this.isCheckAll=!1;let n;for(n=0;n<this.user_products.length;n++)this.form.checks["id"+this.user_products[n].id]=!1}this.is_busy=!1}).catch(r=>{this.is_busy=!0})},changeUserCheck(l,t){let r=t.target.checked;this.delivery_products.checks["id"+l]=r},backToList(){this.page_step=0},submit(){this.hasCheck&&y("選択した商品を発送しますか?").then(l=>{l&&(this.form.delete=!1,this.form.add_point=!1,this.form.post(route("admin.delivery.post"),{onFinish:()=>{this.page_step=0}}))})},remove(){this.hasCheck&&y("選択した商品を削除しますか?").then(l=>{l&&(this.form.delete=!0,y(`選択した商品をポイントに変換します。
変換されたポイントを配布しますか？`).then(t=>{t!==0&&(this.form.add_point=t,this.form.post(route("admin.delivery.post"),{onFinish:()=>{this.page_step=0}}))}))})},search(){this.form_search.get(route("admin.delivery"))},checkall(){let l;for(this.hasCheck=!1,l=0;l<this.user_products.length;l++)this.form.checks["id"+this.user_products[l].id]=this.isCheckAll,this.hasCheck=this.isCheckAll},delivery_csv(){axios.post(route("admin.delivery.csv_post"),{checks:this.delivery_products.checks},{responseType:"blob"}).then(l=>{const t=new Blob([l.data],{type:"text/csv"}),r=document.createElement("a");r.href=window.URL.createObjectURL(t),r.download="発送依頼一覧.csv",r.click()})}}},E={key:0,class:"pt-2 md:px-6 px-4 mb-6"},z={class:"w-full text-neutral-400 mb-3"},M={class:"mb-2 flex justify-between items-center text-sm"},q={class:"flex items-center gap-2 w-full flex-wrap mb-2 py-2 justify-between text-sm"},G={class:"flex items-center gap-2 flex-1"},J={class:"mb-6 grid grid-cols-1 md:grid-cols-2"},K={key:0,class:"-mx-4 my-2 col-span-1 md:col-span-2"},Q={key:1,class:"flex border-neutral-600 border-l-8 border-b border items-center w-full px-2 my-1 -ml-1 hover:bg-slate-100 col-span-1 md:col-span-2 shadow"},W=["for"],X=["id","onChange"],Y={class:"flex-1"},Z=["onClick"],$={class:"flex border-neutral-200 items-center w-full hover:bg-slate-100 py-0.5 px-1 gap-1"},ee={class:"flex items-center"},te={class:"relative"},se=["src"],oe={key:0},re=["src"],le={class:"cursor-pointer min-h-24 flex items-center justify-between flex-1 text-xs py-1 px-2 my-0.5"},ne={class:"text-left"},ie={class:"text-red-500 font-bold text-base"},de={class:"text-red-500"},ce=["disabled"],ae={key:1,class:"pt-2 md:px-6 px-4 mb-6"},ue={class:"flex justify-between items-center sticky top-20 bg-white z-10 py-1.5"},he={class:"flex items-center gap-2"},pe=["disabled"],fe={class:"text-center"},_e={class:"cursor-pointer flex items-center"},be={class:"mb-6 grid grid-cols-1 md:grid-cols-2"},me={class:"flex items-center"},ge=["for"],ve={class:"relative"},ke=["src"],xe={key:0},ye=["src"],we={class:"cursor-pointer h-24 flex items-center justify-between flex-1 text-xs py-1 px-2 my-0.5"},Ce={class:"text-left"},Le={class:"text-red-500 font-bold text-base"},je={class:"text-red-500"},Ae=["id","onUpdate:modelValue"],Pe={class:"w-full mb-6"},Ve={class:"w-full text-sm"},Ie={class:"p-1 w-3/5"},Ue={class:"p-1 w-3/5"},Ne={class:"p-1 w-3/5"},Se={class:"p-1 w-3/5"},Fe={class:"p-1 w-3/5"},Te={class:"p-1 w-3/5"},Oe={class:"p-1 w-3/5"},Be={class:"p-1 w-3/5"},He={class:"mb-6 w-full text-center"},Re=["disabled"],De=["disabled"];function Ee(l,t,r,n,i,a){const j=b("Head"),A=b("Link"),P=b("ChevronRightIcon"),V=b("ArrowLeftIcon"),I=b("AppLayout");return d(),c(p,null,[v(j,{title:"配送商品"}),v(I,null,{default:w(()=>[i.page_step==0?(d(),c("div",E,[e("div",z,[(d(!0),c(p,null,x(i.main_tab,(s,h)=>(d(),U(A,{href:s.route_url,class:m(["inline-block px-4 py-1.5",{"border-b-2 border-red-600 text-red-600":s.is_active}])},{default:w(()=>[g(o(s.title),1)]),_:2},1032,["href","class"]))),256))]),e("div",M,[e("p",null,[g(" 総商品数: "+o(r.totalProducts.toLocaleString())+" 件",1),t[10]||(t[10]=e("br",null,null,-1)),g(" 総ポイント: "+o(r.totalPoints.toLocaleString())+" PT ",1)]),e("p",null,[g(" 検索商品数: "+o(r.searchProducts.toLocaleString())+" 件",1),t[11]||(t[11]=e("br",null,null,-1)),g(" 検索ポイント: "+o(r.searchPoints.toLocaleString())+" PT ",1)])]),e("div",q,[e("div",G,[k(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>n.form_search.name=s),type:"text",placeholder:"名前、メール、電話番号、商品名",class:"h-9 flex-1 w-0 border-neutral-300 focus:border-neutral-300 focus:ring focus:ring-neutral-200 focus:ring-opacity-50 rounded-md shadow-sm placeholder-neutral-300"},null,512),[[C,n.form_search.name]])]),e("button",{type:"button",onClick:t[1]||(t[1]=(...s)=>a.search&&a.search(...s)),class:"rounded-md border bg-neutral-600 text-white px-4 py-2"},"検索")]),e("div",J,[(d(!0),c(p,null,x(r.products.data,(s,h)=>(d(),c(p,null,[h>0&&r.products.data[h-1].user_id!=s.user_id?(d(),c("hr",K)):u("",!0),h==0||r.products.data[h-1].user_id!=s.user_id?(d(),c("div",Q,[e("label",{class:"flex-1 flex items-center gap-2 py-3 cursor-pointer",for:"user_checks["+s.user_id+"]"},[e("input",{type:"checkbox",id:"user_checks["+s.user_id+"]",onChange:f=>a.changeUserCheck(s.user_id,f),class:"h-4 w-4 rounded border-neutral-300 text-neutral-600 shadow-sm focus:ring-0"},null,40,X),e("span",Y,o(s.user_name)+" ( "+o(s.email)+" ) "+o(s.address),1)],8,W),e("button",{onClick:f=>a.showProductDetail(s.user_id),class:"text-sm"},[v(P,{class:"w-5"})],8,Z)])):u("",!0),e("div",$,[e("div",ee,[e("div",te,[e("img",{src:s.image,class:"w-20 h-24 inline-block object-contain"},null,8,se),s.black_case?(d(),c("div",oe,[e("img",{src:s.black_case,class:"w-6 h-6 inline-block object-contain absolute bottom-0 right-0"},null,8,re)])):u("",!0)]),e("div",le,[e("div",ne,[e("div",ie,o(s.rare),1),e("div",null,o(s.name),1),e("div",null,o(s.gacha_title),1),e("div",de,o(s.point.toLocaleString())+"pt",1),e("div",null,o(s.updated_at),1)])])])])],64))),256))]),e("button",{type:"button",onClick:t[2]||(t[2]=s=>a.delivery_csv()),class:m([{"opacity-25":n.delivery_products.processing},"sticky bottom-3 float-right inline-block items-center px-8 py-2.5 bg-neutral-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-neutral-700 active:bg-neutral-700 focus:outline-none focus:border-neutral-700 focus:shadow-outline-neutral transition ease-in-out duration-150 m-1"]),disabled:n.delivery_products.processing}," 発送CSV ",10,ce)])):u("",!0),i.page_step==1?(d(),c("div",ae,[e("div",ue,[e("div",he,[e("button",{type:"button",onClick:t[3]||(t[3]=s=>a.backToList()),class:m([{"opacity-25":n.form.processing},"p-1.5 rounded-full hover:bg-neutral-100"]),disabled:n.form.processing},[v(V,{class:"w-5"})],10,pe),t[12]||(t[12]=e("h2",{class:"text-lg font-bold"},"配送商品詳細",-1))]),e("div",fe,[e("label",_e,[k(e("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=s=>i.isCheckAll=s),onChange:t[5]||(t[5]=s=>a.checkall()),class:"h-5 w-5 rounded border-neutral-300 text-neutral-600 shadow-sm focus:ring-neutral-500"},null,544),[[L,i.isCheckAll]]),t[13]||(t[13]=e("span",{class:"ml-2"},"全てを選択する",-1))])])]),t[22]||(t[22]=e("hr",{class:"mb-3"},null,-1)),e("div",be,[(d(!0),c(p,null,x(i.user_products,(s,h)=>(d(),c("div",me,[e("label",{for:"checkbox"+s.id,class:"flex border-neutral-200 items-center w-full hover:bg-slate-100 py-0.5"},[e("div",ve,[e("img",{src:s.image,class:"w-20 h-24 inline-block object-contain"},null,8,ke),s.black_case?(d(),c("div",xe,[e("img",{src:s.black_case,class:"w-6 h-6 inline-block object-contain absolute bottom-0 right-0"},null,8,ye)])):u("",!0)]),e("div",we,[e("div",Ce,[e("div",Le,o(s.rare),1),e("div",null,o(s.name),1),e("div",null,o(s.gacha_title),1),e("div",je,o(s.point.toLocaleString())+"pt",1),e("div",null,o(s.updated_at),1),e("div",null,o(s.status),1)])]),k(e("input",{id:"checkbox"+s.id,"onUpdate:modelValue":f=>n.form.checks["id"+s.id]=f,type:"checkbox",onChange:t[6]||(t[6]=f=>a.changeCheck()),class:"cursor-pointer rounded border-neutral-300 text-neutral-600 shadow-sm focus:ring-neutral-500 m-1"},null,40,Ae),[[L,n.form.checks["id"+s.id]]])],8,ge)]))),256))]),t[23]||(t[23]=e("div",{class:"mb-1 text-base font-semibold"},"配送先情報",-1)),t[24]||(t[24]=e("hr",{class:"mb-3"},null,-1)),e("div",Pe,[e("table",Ve,[e("tr",null,[t[14]||(t[14]=e("td",{class:"p-1 w-2/5 font-bold"},"アドレス",-1)),e("td",Ie,o(i.user.email),1)]),i.profile?(d(),c(p,{key:0},[e("tr",null,[t[15]||(t[15]=e("td",{class:"p-1 w-2/5 font-bold"},"名前",-1)),e("td",Ue,o(i.profile.first_name)+" "+o(i.profile.last_name),1)]),e("tr",null,[t[16]||(t[16]=e("td",{class:"p-1 w-2/5 font-bold"},"名前(カナ)",-1)),e("td",Ne,o(i.profile.first_name_gana)+"　"+o(i.profile.last_name_gana),1)]),e("tr",null,[t[17]||(t[17]=e("td",{class:"p-1 w-2/5 font-bold"},"郵便番号",-1)),e("td",Se,o(i.profile.postal_code),1)]),e("tr",null,[t[18]||(t[18]=e("td",{class:"p-1 w-2/5 font-bold"},"都道府県",-1)),e("td",Fe,o(i.profile.prefecture),1)]),e("tr",null,[t[19]||(t[19]=e("td",{class:"p-1 w-2/5 font-bold"},"住所",-1)),e("td",Te,o(i.profile.city)+o(i.profile.street)+"　"+o(i.profile.building),1)]),e("tr",null,[t[20]||(t[20]=e("td",{class:"p-1 w-2/5 font-bold"},"電話番号",-1)),e("td",Oe,o(i.profile.phone),1)]),e("tr",null,[t[21]||(t[21]=e("td",{class:"p-1 w-2/5 font-bold"},"追跡番号",-1)),e("td",Be,[k(e("input",{type:"text",id:"tracking_number","onUpdate:modelValue":t[7]||(t[7]=s=>n.form.tracking_number=s),class:"h-10 rounded-sm w-full px-3 py-1 border border-yellow-300 focus:border-yellow-300 focus:ring focus:ring-yellow-200 focus:ring-opacity-50"},null,512),[[C,n.form.tracking_number]])])])],64)):u("",!0)])]),e("div",He,[e("button",{type:"button",onClick:t[8]||(t[8]=s=>a.submit()),class:m([{"opacity-25":n.form.processing},"inline-block items-center px-8 py-2.5 bg-red-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-red-700 active:bg-red-700 focus:outline-none focus:border-red-700 focus:shadow-outline-red transition ease-in-out duration-150 m-1"]),disabled:n.form.processing}," 配送済みにする ",10,Re),e("button",{type:"button",onClick:t[9]||(t[9]=s=>a.remove()),class:m([{"opacity-25":n.form.processing},"inline-block items-center px-8 py-2.5 bg-neutral-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-neutral-700 active:bg-neutral-700 focus:outline-none focus:border-neutral-700 focus:shadow-outline-neutral transition ease-in-out duration-150 m-1"]),disabled:n.form.processing}," 削除 ",10,De)])])):u("",!0)]),_:1})],64)}const Qe=H(D,[["render",Ee]]);export{Qe as default};
