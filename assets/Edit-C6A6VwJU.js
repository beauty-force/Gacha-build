import{a7 as S,d as f,r as g,c as n,o as a,a as y,w as b,b as e,t as i,h as V,j as u,i as m,k as L,e as p,v as h,x,F as _,f as A,m as C,g as v}from"./app-0AcmyHmW.js";import{A as R}from"./Admin-BAoE_gpR.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useConfirm-BDF-k9gd.js";const E={components:{Head:f.Head,AdminLayout:R,Link:f.Link},props:{notification:Object,tags:Array,ranks:Array,plans:Array},data(){return{userSearchQuery:"",searchResults:[],selectedUser:null}},mounted(){this.notification.target_type==="user"&&this.notification.target_id&&v.get(route("admin.notifications.search-users"),{params:{q:"",user_id:this.notification.target_id}}).then(o=>{const t=o.data.find(c=>c.id==this.notification.target_id);t&&(this.selectedUser=t)}).catch(()=>{})},methods:{submit(){if(this.form.target_type!=="all"&&!this.form.target_id){this.form.setError("target_id","ターゲットを選択してください");return}this.form.put(route("admin.notifications.update",this.notification.id))},searchUsers:S.debounce(function(){if(this.userSearchQuery.length<2){this.searchResults=[];return}v.get(route("admin.notifications.search-users"),{params:{q:this.userSearchQuery}}).then(o=>{this.searchResults=o.data}).catch(o=>{console.error("User search error:",o)})},300),selectUser(o){this.selectedUser=o,this.form.target_id=o.id,this.searchResults=[],this.userSearchQuery=""},clearUserSelection(){this.selectedUser=null,this.form.target_id=null}},setup(o){return{form:f.useForm({type:o.notification.type||"announcement",message:o.notification.message,target_type:o.notification.target_type,target_id:o.notification.target_id,is_published:o.notification.is_published})}}},M={class:"py-2"},H={class:"max-w-7xl mx-auto sm:px-0 lg:px-2"},N={class:"bg-white"},j={class:"p-6 text-gray-900"},q={class:"mb-6"},B={class:"text-sm text-gray-600 space-y-1"},F={key:0,class:"text-red-500 text-sm mt-1"},D={key:0,class:"text-red-500 text-sm mt-1"},T={class:"space-y-2"},I={class:"flex items-center"},O={class:"flex items-center"},z={key:0,class:"ml-6 mt-2"},G={key:0,class:"mt-2 border border-gray-200 rounded-md max-h-40 overflow-y-auto"},J=["onClick"],K={key:1,class:"mt-2 p-2 bg-blue-50 rounded-md"},P={class:"text-sm"},W={key:0,class:"text-red-500 text-sm mt-1"},X={key:1,class:"text-red-500 text-sm mt-1"},Y={for:"is_published",class:"flex items-center"},Z={class:"flex items-center justify-end space-x-4"},$=["disabled"];function ee(o,t,c,r,l,d){const k=g("Head"),U=g("Link"),w=g("AdminLayout");return a(),n(_,null,[y(k,{title:"お知らせ編集"}),y(w,null,{default:b(()=>[e("div",M,[e("div",H,[e("div",N,[e("div",j,[e("div",q,[t[9]||(t[9]=e("h3",{class:"text-lg font-semibold mb-2"},"お知らせ情報",-1)),e("div",B,[e("p",null,"配信対象: "+i(c.notification.target_name),1),e("p",null,"読了数: "+i(c.notification.read_count)+" / 配信ユーザー数: "+i(c.notification.user_count),1)])]),e("form",{onSubmit:t[8]||(t[8]=V((...s)=>d.submit&&d.submit(...s),["prevent"])),class:"space-y-6"},[e("div",null,[t[11]||(t[11]=e("label",{for:"type",class:"block text-sm font-medium text-gray-700"}," タイプ ",-1)),u(e("select",{id:"type","onUpdate:modelValue":t[0]||(t[0]=s=>r.form.type=s),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},[...t[10]||(t[10]=[e("option",{value:"announcement"},"お知らせ",-1),e("option",{value:"maintenance"},"メンテナンス",-1),e("option",{value:"event"},"イベント",-1),e("option",{value:"campaign"},"キャンペーン",-1),e("option",{value:"important"},"重要",-1)])],512),[[L,r.form.type]]),r.form.errors.type?(a(),n("div",F,i(r.form.errors.type),1)):m("",!0)]),e("div",null,[t[12]||(t[12]=e("label",{for:"message",class:"block text-sm font-medium text-gray-700"},[p(" メッセージ "),e("span",{class:"text-red-500"},"*")],-1)),u(e("textarea",{id:"message","onUpdate:modelValue":t[1]||(t[1]=s=>r.form.message=s),rows:"4",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:""},null,512),[[h,r.form.message]]),r.form.errors.message?(a(),n("div",D,i(r.form.errors.message),1)):m("",!0)]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[p(" 配信対象 "),e("span",{class:"text-red-500"},"*")],-1)),e("div",T,[e("label",I,[u(e("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=s=>r.form.target_type=s),value:"all",class:"mr-2"},null,512),[[x,r.form.target_type]]),t[13]||(t[13]=e("span",null,"全ユーザー",-1))]),e("label",O,[u(e("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=s=>r.form.target_type=s),value:"user",class:"mr-2"},null,512),[[x,r.form.target_type]]),t[14]||(t[14]=e("span",null,"特定のユーザー",-1))]),r.form.target_type==="user"?(a(),n("div",z,[u(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=s=>l.userSearchQuery=s),onInput:t[5]||(t[5]=(...s)=>d.searchUsers&&d.searchUsers(...s)),placeholder:"ユーザーを検索...",class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,544),[[h,l.userSearchQuery]]),l.searchResults.length>0?(a(),n("div",G,[(a(!0),n(_,null,A(l.searchResults,s=>(a(),n("div",{key:s.id,onClick:te=>d.selectUser(s),class:"p-2 hover:bg-gray-100 cursor-pointer"},i(s.name)+" ("+i(s.email)+") ",9,J))),128))])):m("",!0),l.selectedUser?(a(),n("div",K,[e("span",P,"選択中: "+i(l.selectedUser.name)+" ("+i(l.selectedUser.email)+")",1),e("button",{type:"button",onClick:t[6]||(t[6]=(...s)=>d.clearUserSelection&&d.clearUserSelection(...s)),class:"ml-2 text-red-600 text-sm"},"削除")])):m("",!0)])):m("",!0)]),r.form.errors.target_type?(a(),n("div",W,i(r.form.errors.target_type),1)):m("",!0),r.form.errors.target_id?(a(),n("div",X,i(r.form.errors.target_id),1)):m("",!0)]),e("div",null,[e("label",Y,[u(e("input",{type:"checkbox",id:"is_published","onUpdate:modelValue":t[7]||(t[7]=s=>r.form.is_published=s),class:"mr-2"},null,512),[[C,r.form.is_published]]),t[16]||(t[16]=e("span",{class:"text-sm font-medium text-gray-700"},"公開する",-1))])]),e("div",Z,[y(U,{href:o.route("admin.notifications.index"),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:b(()=>[...t[17]||(t[17]=[p(" キャンセル ",-1)])]),_:1},8,["href"]),e("button",{type:"submit",disabled:r.form.processing,class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50"},i(r.form.processing?"更新中...":"更新"),9,$)])],32)])])])])]),_:1})],64)}const ne=Q(E,[["render",ee]]);export{ne as default};
