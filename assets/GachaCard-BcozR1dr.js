import{y as V,z as H,d as S,r as M,c as i,o as a,b as s,a as m,i as r,w as _,e as g,t as c,n as x,h as j,F as h,f as E,$ as B,l as q}from"./app-eVUcwuVE.js";import{d as G}from"./index-D0DxAhHq.js";import{G as P}from"./GachaButtons-DvTlaFDd.js";import{u as F}from"./useConfirm-DuLyikpD.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as R}from"./PlayIcon-GVmMHhHk.js";const b=1e3,y=60*b,v=60*y,L=24*v,I="abort",z="end",N="progress",O="start",T="visibilitychange";var U=V({name:"VueCountdown",props:{autoStart:{type:Boolean,default:!0},emitEvents:{type:Boolean,default:!0},interval:{type:Number,default:1e3,validator:n=>n>=0},now:{type:Function,default:()=>Date.now()},tag:{type:String,default:"span"},time:{type:Number,default:0,validator:n=>n>=0},transform:{type:Function,default:n=>n}},emits:[I,z,N,O],data(){return{counting:!1,endTime:0,totalMilliseconds:0,requestId:0,autoPauseOnHide:!1}},computed:{days(){return Math.floor(this.totalMilliseconds/L)},hours(){return Math.floor(this.totalMilliseconds%L/v)},minutes(){return Math.floor(this.totalMilliseconds%v/y)},seconds(){return Math.floor(this.totalMilliseconds%y/b)},milliseconds(){return Math.floor(this.totalMilliseconds%b)},totalDays(){return this.days},totalHours(){return Math.floor(this.totalMilliseconds/v)},totalMinutes(){return Math.floor(this.totalMilliseconds/y)},totalSeconds(){return Math.floor(this.totalMilliseconds/b)}},watch:{$props:{deep:!0,immediate:!0,handler(){this.totalMilliseconds=this.time,this.endTime=this.now()+this.time,this.autoStart&&this.start()}}},mounted(){document.addEventListener(T,this.handleVisibilityChange)},beforeUnmount(){document.removeEventListener(T,this.handleVisibilityChange),this.pause()},methods:{start(){this.counting||(this.counting=!0,this.autoStart||(this.totalMilliseconds=this.time,this.endTime=this.now()+this.time),this.emitEvents&&this.$emit(O),document.visibilityState==="visible"&&this.continue())},continue(){if(!this.counting)return;const n=Math.min(this.totalMilliseconds,this.interval);if(n>0){let e,t;const f=d=>{e||(e=d),t||(t=d);const o=d-e;o>=n||o+(d-t)/2>=n?this.progress():this.requestId=requestAnimationFrame(f),t=d};this.requestId=requestAnimationFrame(f)}else this.end()},pause(){cancelAnimationFrame(this.requestId),this.requestId=0},progress(){this.counting&&(this.update(),this.emitEvents&&this.totalMilliseconds>0&&this.$emit(N,{days:this.days,hours:this.hours,minutes:this.minutes,seconds:this.seconds,milliseconds:this.milliseconds,totalDays:this.totalDays,totalHours:this.totalHours,totalMinutes:this.totalMinutes,totalSeconds:this.totalSeconds,totalMilliseconds:this.totalMilliseconds}),this.continue())},abort(){this.counting&&(this.pause(),this.counting=!1,this.emitEvents&&this.$emit(I))},end(){this.counting&&(this.pause(),this.totalMilliseconds=0,this.counting=!1,this.emitEvents&&this.$emit(z))},update(){this.counting&&(this.totalMilliseconds=Math.max(0,this.endTime-this.now()))},restart(){this.pause(),this.totalMilliseconds=this.time,this.endTime=this.now()+this.time,this.counting=!1,this.start()},handleVisibilityChange(){switch(document.visibilityState){case"visible":this.requestId===0&&this.autoPauseOnHide&&(this.update(),this.continue()),this.autoPauseOnHide=!1;break;case"hidden":this.requestId>0&&(this.autoPauseOnHide=!0,this.pause());break}}},render(){return H(this.tag,this.$slots.default?[this.$slots.default(this.transform({days:this.days,hours:this.hours,minutes:this.minutes,seconds:this.seconds,milliseconds:this.milliseconds,totalDays:this.totalDays,totalHours:this.totalHours,totalMinutes:this.totalMinutes,totalSeconds:this.totalSeconds,totalMilliseconds:this.totalMilliseconds}))]:void 0)}});const{confirm:Y}=F(),W={components:{Link:S.Link,PlayIcon:R,VueCountdown:U,GachaButtons:P},props:{gacha:Object,url_edit:String,openCopyModal:Function,reinitializeLazyLoading:Function,is_one_day:Boolean},data(){return{category_share:S.usePage().props.value.category_share,url_10gacha:"",url_1gacha:"",str_gacha10:"",point_10gacha:0,countdown:!0,user:S.usePage().props.value.auth.user}},computed:{progress_value(){return this.gacha.count_rest===void 0?"100%":Math.round(this.gacha.count_rest*100/this.gacha.count_card)+"%"},progress_background_width(){return this.gacha.count_rest===void 0||this.gacha.count_rest==0?"100%":Math.round(this.gacha.count_card*100/this.gacha.count_rest)+"%"},url_card(){return route("user.gacha",this.gacha.id)+this.category_share.cat_route_appendix}},methods:{format_number(n){return String(n).replace(/(.)(?=(\d{3})+$)/g,"$1,")},getImageClass(n){return"url('"+n+"')"},clickCard(){this.url_edit||(window.location.href=this.url_card)},destroyGacha(n){Y("削除してもいいですか？",`<div class="text-sm">
                <div class="text-base font-bold mb-4">${n.title}</div>
                <img src="${n.thumbnail}" class="w-full h-auto px-4" />
                </div>`,"error").then(e=>{e&&G.Inertia.delete(route("admin.gacha.destroy",n.id),{onSuccess:()=>{this.reinitializeLazyLoading&&this.reinitializeLazyLoading()}})})},transform(n){return Object.entries(n).forEach(([e,t])=>{const f=t<10&&e!="days"?`0${t}`:t;t<2&&e.replace(/s$/,""),n[e]=`${f}`}),n},saveScroll(){sessionStorage.setItem("eve-gacha-top-scroll",window.scrollY)},handleHorizontalScroll(n){const e=this.$refs.productScrollContainer;e&&(e.scrollLeft+=n.deltaY)}},mounted(){this.gacha.count_rest!==void 0&&this.gacha.count_rest<10?(this.str_gacha10="全て",this.point_10gacha=this.gacha.count_rest*this.gacha.point):(this.str_gacha10="10連",this.point_10gacha=10*this.gacha.point)}},J={class:"bg-neutral-700 h-full flex flex-col rounded-md overflow-hidden relative"},K=["data-src"],Q={key:0,class:"absolute inset-0 flex items-center"},X={class:"w-full bg-neutral-900/90 hover:bg-neutral-900 py-1"},Z={class:"py-2 border-y"},$={key:0},tt={key:1},et={class:"text-center"},st={class:"bg-gradient-to-r from-sky-400 to-purple-400 via-green-400 bg-clip-text text-transparent font-black text-3xl font-[mplus2]"},at={key:0,class:"mr-3"},it={class:"flex gap-2 items-center w-full"},nt=["data-src","alt"],ot={key:0,class:"absolute z-10 top-0 left-0 items-center px-2 py-1 bg-green-500 border border-transparent rounded-sm font-semibold text-sm text-white tracking-widest"},lt={key:1,class:"absolute z-10 top-0 left-0 items-center px-2 py-1 bg-neutral-500 border border-transparent rounded-sm font-semibold text-sm text-white tracking-widest"},rt={class:"absolute z-10 top-0 right-0 flex flex-col gap-1"},ct={key:2,class:"absolute w-full h-full z-10 flex flex-col justify-center items-center gap-8 pointer-events-none"},dt={class:"text-white text-5xl w-full bg-neutral-900/80 text-center font-black pb-2 font-[mplus2]"},ut={key:3,class:"absolute bottom-0 w-full h-full bg-opacity-70 z-[5] bg-neutral-900 flex items-center justify-center"},ht={class:"text-white text-xl text-center font-bold px-6 py-1 bg-yellow-500 rounded-lg flex flex-col gap-2"},gt={key:0},ft={key:1},mt={key:2},_t={key:4,class:"absolute bottom-0 w-full h-full bg-opacity-70 z-10 bg-neutral-900 flex flex-col justify-center items-center gap-4"},xt={class:"w-full flex flex-col justify-center flex-1 max-h-20"},bt={class:"text-white font-[mplus2]"},yt={class:"flex justify-between items-center pt-2 w-full"},vt={class:"flex items-end gap-1.5 w-[45%] px-3"},wt={key:0,class:"flex items-center justify-around gap-1.5 w-full"},kt=["src"],St={class:"text-white text-[10px] leading-3 bg-white/30 w-full text-center"},Mt={class:"text-white text-base md:text-xl font-bold"},pt={class:"text-white text-base md:text-xl font-bold"},Ct={class:"flex-1 flex flex-col items-end gap-1.5 pr-2"},Et={key:0,class:"text-white text-xs pr-1"},Lt={key:1,class:"flex items-center"},It={class:"w-full mb-2.5"},zt={class:"w-full h-2.5 rounded-full overflow-hidden flex bg-neutral-800"},Nt={key:5,class:"flex items-center"},Ot={key:0},Tt={key:1},Dt={class:"text-center"},Vt={class:"bg-rose-400 bg-clip-text text-transparent font-extrabold text-xl font-[mplus2]"},Ht={key:0,class:"mr-3"},jt={class:"px-1 py-1 flex items-end"};function Bt(n,e,t,f,d,o){const p=M("vue-countdown"),C=M("Link"),D=M("GachaButtons");return a(),i("div",{class:x(["cursor-pointer w-full overflow-hidden border rounded-md shadow-[0_4px_8px_0px_rgba(0,0,0,0.3)] p-1 bg-yellow-100",{"cursor-pointer hover:shadow-[0_4px_8px_3px_rgba(0,0,0,0.3)]":!t.url_edit&&!t.gacha.is_sold_out,"grayscale-[80%]":!t.url_edit&&t.gacha.is_sold_out}])},[s("div",J,[m(C,{href:o.url_card,onClick:o.saveScroll,class:x(["relative flex-1",{"grayscale-[80%]":t.url_edit&&t.gacha.is_sold_out}])},{default:_(()=>[s("img",{"data-src":t.gacha.thumbnail,src:"/images/logo.png",class:"lazy w-full aspect-[32/21] object-cover bg-neutral-700"},null,8,K),d.countdown&&t.gacha.remaining>0&&t.gacha.timeStatus==0?(a(),i("div",Q,[s("div",X,[s("div",Z,[m(p,{time:t.gacha.remaining*1e3,transform:o.transform,class:"text-gray-100 flex flex-wrap items-center justify-around px-2 py-0.5 w-full text-xl font-semibold",onEnd:e[0]||(e[0]=l=>d.countdown=!1)},{default:_(({days:l,hours:u,minutes:w,seconds:k})=>[t.gacha.timeStatus==0?(a(),i("span",$,"発売まで")):r("",!0),t.gacha.timeStatus==1?(a(),i("span",tt,"終了まで")):r("",!0),s("span",et,[s("span",st,[l>0?(a(),i("span",at,c(l)+"日",1)):r("",!0),g(c(u)+":"+c(w)+":"+c(k),1)])])]),_:1},8,["time","transform"])])])])):r("",!0)]),_:1},8,["href","onClick","class"]),t.gacha.products&&t.gacha.products.length>0?(a(),i("div",{key:0,class:x(["relative px-1.5 py-2 border-x border-neutral-700",{"bg-yellow-300/80":t.is_one_day}])},[s("div",{ref:"productScrollContainer",class:"overflow-x-auto no-scrollbar",onWheel:e[1]||(e[1]=j((...l)=>o.handleHorizontalScroll&&o.handleHorizontalScroll(...l),["prevent"]))},[s("div",it,[(a(!0),i(h,null,E(t.gacha.products,(l,u)=>(a(),i("div",{key:u,class:"flex-shrink-0"},[s("img",{"data-src":l.image,alt:l.name||`Product ${u+1}`,src:"/images/logo.png",class:"lazy object-cover w-[58px] h-20 rounded-sm border border-neutral-300"},null,8,nt)]))),128))])],544)],2)):r("",!0),t.url_edit?(a(),i(h,{key:1},[t.gacha.status==1?(a(),i("div",ot," 公開 ")):(a(),i("div",lt," 非公開 ")),s("div",rt,[m(C,{href:t.url_edit,onClick:o.saveScroll,class:"items-center px-8 py-2.5 bg-green-500 border border-transparent rounded-sm font-semibold text-sm text-white uppercase tracking-widest hover:bg-green-700 active:bg-green-700 focus:outline-none focus:border-green-700 focus:shadow-outline-green transition ease-in-out duration-150"},{default:_(()=>[...e[6]||(e[6]=[g(" 編集する ",-1)])]),_:1},8,["href","onClick"]),s("button",{onClick:e[2]||(e[2]=l=>{o.saveScroll,t.openCopyModal(t.gacha.id)}),class:"px-4 py-2 bg-sky-500 hover:bg-sky-600 text-sm text-neutral-50"}," コピー "),s("button",{onClick:e[3]||(e[3]=l=>{o.saveScroll,o.destroyGacha(t.gacha)}),class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-sm text-neutral-50"}," 削除 ")])],64)):r("",!0),t.gacha.is_sold_out&&!t.url_edit?(a(),i("div",ct,[s("div",dt,[e[7]||(e[7]=g(" SOLD OUT ",-1)),d.user&&d.user.type==1?(a(),i("button",{key:0,class:"text-base font-normal text-white border border-neutral-300 w-fit rounded-full min-w-[40%] px-5 py-1 hover:bg-white hover:text-black",onClick:e[4]||(e[4]=l=>o.clickCard())},"排出履歴")):r("",!0)])])):r("",!0),t.url_edit&&(t.gacha.count_rest!==void 0&&t.gacha.count_rest!=t.gacha.ableCount||t.gacha.is_sold_out||!t.gacha.has_video)?(a(),i("div",ut,[s("div",ht,[t.gacha.has_video?r("",!0):(a(),i("div",gt,"動画が設定されていません")),t.gacha.count_rest!==void 0&&t.gacha.count_rest!=t.gacha.ableCount?(a(),i("div",ft,"現在回せません")):r("",!0),t.gacha.is_sold_out?(a(),i("div",mt,"SOLD OUT")):r("",!0)])])):r("",!0),t.gacha.rank_limit>0&&t.gacha.rank_limit&1<<d.user?.current_rank&&!t.url_edit?(a(),i("div",_t,[...e[8]||(e[8]=[s("div",{class:"text-white text-xl w-full text-center font-black"},"ランク制限",-1),s("div",{class:"text-white text-sm w-full text-center font-black"},null,-1)])])):r("",!0),s("div",xt,[s("div",bt,[s("div",yt,[s("div",vt,[t.gacha.items&&t.gacha.items.length>0?(a(),i("div",wt,[(a(!0),i(h,null,E(t.gacha.items,(l,u)=>(a(),i("div",{key:u,class:"flex flex-col items-center gap-0.5 rounded-lg border-2 border-white/50 shadow-lg overflow-hidden"},[s("img",{src:l.image,class:"h-8 w-8 object-contain"},null,8,kt),s("span",St,"×"+c(l.quantity),1)]))),128))])):t.gacha.dp_gacha?(a(),i(h,{key:1},[s("span",Mt,c(o.format_number(t.gacha.point)),1),e[9]||(e[9]=s("span",{class:"text-white pb-0.5 text-sm font-semibold"},"EP",-1)),e[10]||(e[10]=s("span",{class:"text-gray-300 text-xs pb-0.5 text-nowrap"},"/1回",-1))],64)):(a(),i(h,{key:2},[e[11]||(e[11]=s("img",{src:"/images/icon_cash.png",class:"h-5 mb-1"},null,-1)),s("span",pt,c(o.format_number(t.gacha.point)),1),e[12]||(e[12]=s("span",{class:"text-gray-300 text-xs pb-0.5 text-nowrap"},"/1回",-1))],64))]),s("div",Ct,[t.gacha.count_card>0?(a(),i("span",Et,[t.gacha.show_count!==0?(a(),i(h,{key:0},[g(" のこり "+c(o.format_number(t.gacha.count_rest))+" / "+c(o.format_number(t.gacha.count_card)),1)],64)):(a(),i(h,{key:1},[g(" のこり ? / "+c(o.format_number(t.gacha.count_card)),1)],64))])):(a(),i("div",Lt,[...e[13]||(e[13]=[s("span",{class:"font-semibold pr-2"},"- / -",-1)])])),s("div",It,[s("div",zt,[s("div",{class:x(["h-full rounded-full border-neutral-800",{"bg-gradient-to-r from-[#dd422d] via-[#fae94e] to-[#02ec0e]":t.gacha.count_card>0,"bg-[#02ec0e] w-full":t.gacha.count_card==0}]),style:B(t.gacha.show_count===0?{width:"100%"}:t.gacha.count_card>0?{width:o.progress_value,backgroundSize:o.progress_background_width}:{})},null,6)])])])])])]),d.countdown&&t.gacha.remaining>0&&t.gacha.timeStatus==1&&!t.gacha.is_sold_out?(a(),i("div",Nt,[m(p,{time:t.gacha.remaining*1e3,transform:o.transform,class:"text-gray-100 flex items-center justify-around px-2 pb-1 w-full font-semibold",onEnd:e[5]||(e[5]=l=>d.countdown=!1)},{default:_(({days:l,hours:u,minutes:w,seconds:k})=>[t.gacha.timeStatus==0?(a(),i("span",Ot,"発売まで")):r("",!0),t.gacha.timeStatus==1?(a(),i("span",Tt,"終了まで")):r("",!0),s("span",Dt,[s("span",Vt,[l>0?(a(),i("span",Ht,c(l)+"日",1)):r("",!0),g(c(u)+":"+c(w)+":"+c(k),1)])])]),_:1},8,["time","transform"])])):r("",!0),s("div",jt,[t.url_edit?r("",!0):(a(),q(D,{key:0,gacha:t.gacha},null,8,["gacha"]))])])],2)}const Ut=A(W,[["render",Bt]]);export{Ut as G};
