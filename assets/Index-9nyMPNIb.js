import{d as p,r as h,c as i,o as r,a as m,w as f,b as s,i as y,F as b,f as v,n as g,e as x,t as u,y as U,g as w}from"./app-0AcmyHmW.js";import{A as V}from"./UserLayout-ijdn5NFa.js";import{S as R,h as j,V as D,G as N,Y as q,u as A}from"./useConfirm-BDF-k9gd.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CDcCEyuP.js";const{alert:_}=A(),z={components:{Head:p.Head,AppLayout:V,Link:p.Link,Dialog:q,DialogPanel:N,DialogTitle:D,TransitionChild:j,TransitionRoot:R},props:{items:Array},data(){return{activeTab:"all",isUsing:!1,showPointLotteryModal:!1,currentUserItem:null,cardCount:0,shuffledCards:[],cardValues:[],selectedCardIndex:null,selectingCard:!1,lotteryResult:null,revealedCardIndex:null}},computed:{tabs(){const l={};this.items.forEach(n=>{const e=n.item.type||"other";l[e]=(l[e]||0)+1});const t=[{type:"all",label:"ã™ã¹ã¦",count:this.items.length}],o={gacha_ticket:"ã‚¬ãƒãƒ£ãƒã‚±ãƒƒãƒˆ",point_lottery:"ãƒã‚¤ãƒ³ãƒˆæŠ½é¸"};return Object.keys(l).forEach(n=>{l[n]>0&&t.push({type:n,label:o[n]||n,count:l[n]})}),t},filteredItems(){return this.activeTab==="all"?this.items:this.items.filter(l=>l.item.type===this.activeTab)}},setup(){return{category_share:p.usePage().props.value.category_share||{}}},methods:{getTypeText(l){return{gacha_ticket:"ã‚¬ãƒãƒ£ãƒã‚±ãƒƒãƒˆ",point_lottery:"ãƒã‚¤ãƒ³ãƒˆæŠ½é¸"}[l]||l},getTabLabel(l){return{gacha_ticket:"ã‚¬ãƒãƒ£ãƒã‚±ãƒƒãƒˆ",point_lottery:"ãƒã‚¤ãƒ³ãƒˆæŠ½é¸"}[l]||l},openPointLotteryModal(l){this.isUsing||(this.isUsing=!0,w.post(route("user.items.use",l.id),{}).then(t=>{t.data.success&&t.data.card_count?(this.currentUserItem=l,this.cardCount=t.data.card_count,this.shuffledCards=Array(this.cardCount).fill(null).map((o,n)=>n),this.cardValues=[],this.selectedCardIndex=null,this.lotteryResult=null,this.revealedCardIndex=null,this.showPointLotteryModal=!0,this.isUsing=!1):(_(t.data.message||"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"),this.isUsing=!1)}).catch(t=>{const o=t.response?.data?.message||"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";_(o),this.isUsing=!1}))},selectCard(l){this.selectingCard||this.lotteryResult||!this.currentUserItem||(this.selectedCardIndex=l,this.selectingCard=!0,w.post(route("user.items.selectCard",this.currentUserItem.id),{card_index:l}).then(t=>{if(t.data.success){if(this.cardValues=t.data.points.map(o=>Number(o)),this.revealedCardIndex=t.data.selected_index,this.lotteryResult={points:t.data.points.map(o=>Number(o)),selected_point:Number(t.data.selected_point)},t.data.item_quantity!==void 0&&this.currentUserItem){const o=this.items.findIndex(n=>n.id===this.currentUserItem.id);o!==-1&&(this.items[o].quantity=t.data.item_quantity,t.data.item_quantity<=0&&this.items.splice(o,1))}if(t.data.user_point!==void 0){const o=p.usePage();o.props.value.auth&&o.props.value.auth.user&&(o.props.value.auth.user.point=t.data.user_point)}setTimeout(()=>{this.$inertia.reload({only:["items"]})},100)}else _(t.data.message||"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"),this.selectingCard=!1,this.selectedCardIndex=null}).catch(t=>{const o=t.response?.data?.message||"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";_(o),this.selectingCard=!1,this.selectedCardIndex=null}))},closePointLotteryModal(){(this.lotteryResult||!this.selectingCard)&&(this.showPointLotteryModal=!1,this.currentUserItem=null,this.cardCount=0,this.shuffledCards=[],this.cardValues=[],this.selectedCardIndex=null,this.lotteryResult=null,this.revealedCardIndex=null,this.selectingCard=!1)}}},B={class:"pt-4 pb-8 px-4"},E={key:0,class:"mb-4 border-b border-gray-200"},H={class:"-mb-px flex space-x-4 overflow-x-auto","aria-label":"Tabs"},F=["onClick"],G={key:0,class:"ml-1 text-xs bg-gray-100 px-2 py-0.5 rounded-full"},Y={key:1,class:"text-center py-12"},O={class:"text-gray-500 text-lg"},J={key:2,class:"grid grid-cols-2 md:grid-cols-3 gap-4"},K={class:"p-4"},Q={class:"w-full aspect-square flex items-center justify-center mb-3"},W=["src","alt"],X={key:1,class:"text-gray-400"},Z={class:"mb-3"},$={class:"text-base font-bold text-gray-900 mb-2 line-clamp-2"},tt={class:"flex items-center gap-2 flex-wrap justify-between"},et={class:"text-xs px-2 py-0.5 bg-blue-100 text-blue-800 rounded"},st={class:"text-xs font-semibold text-amber-600"},at={class:"text-base font-bold"},lt=["onClick","disabled"],ot={key:1,class:"text-xs text-gray-500 text-center"},it={class:"fixed inset-0 z-10 overflow-y-auto"},rt={class:"flex min-h-full items-center justify-center p-2 text-center sm:items-center sm:p-0"},nt={class:"p-4 sm:p-6"},dt={class:"flex justify-between items-center mb-4"},ct=["disabled"],ut=["onClick","disabled"],mt={key:1,class:"absolute inset-0 w-full h-full bg-gradient-to-br from-green-400 to-green-600 rounded-lg shadow-lg flex flex-col items-center justify-center text-white"},ht={class:"text-base sm:text-xl font-bold"},ft={key:2,class:"absolute inset-0 w-full h-full bg-gradient-to-br from-gray-300 to-gray-400 rounded-lg shadow-lg flex flex-col items-center justify-center text-gray-700 opacity-75"},yt={class:"text-base sm:text-xl font-bold"},gt={class:"text-center mt-6 h-14 flex items-center justify-center"},pt={key:1,class:"text-sm text-gray-400"};function bt(l,t,o,n,e,d){const k=h("Head"),C=h("TransitionChild"),L=h("DialogTitle"),T=h("DialogPanel"),I=h("Dialog"),P=h("TransitionRoot"),M=h("AppLayout");return r(),i(b,null,[m(k,{title:"ã‚¢ã‚¤ãƒ†ãƒ "}),m(M,{hide_cat_bar:!0},{default:f(()=>[s("div",B,[t[4]||(t[4]=s("h1",{class:"text-xl font-bold mb-4"},"ãƒã‚¤ã‚¢ã‚¤ãƒ†ãƒ ",-1)),o.items.length>0?(r(),i("div",E,[s("nav",H,[(r(!0),i(b,null,v(d.tabs,a=>(r(),i("button",{key:a.type,onClick:c=>e.activeTab=a.type,class:g([e.activeTab===a.type?"border-amber-500 text-amber-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"])},[x(u(a.label)+" ",1),a.count>0?(r(),i("span",G,u(a.count),1)):y("",!0)],10,F))),128))])])):y("",!0),d.filteredItems.length===0?(r(),i("div",Y,[s("p",O,u(e.activeTab==="all"?"æ‰€æŒã—ã¦ã„ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ãŒã‚ã‚Šã¾ã›ã‚“":`${d.getTabLabel(e.activeTab)}ã®ã‚¢ã‚¤ãƒ†ãƒ ãŒã‚ã‚Šã¾ã›ã‚“`),1)])):(r(),i("div",J,[(r(!0),i(b,null,v(d.filteredItems,a=>(r(),i("div",{key:a.id,class:"bg-white rounded-lg shadow-md border-2 border-gray-200 overflow-hidden hover:shadow-lg transition-shadow"},[s("div",K,[s("div",Q,[a.item.image?(r(),i("img",{key:0,src:a.item.image,alt:a.item.name,class:"max-h-full max-w-full object-contain"},null,8,W)):(r(),i("span",X,"ç”»åƒãªã—"))]),s("div",Z,[s("h3",$,u(a.item.name),1),s("div",tt,[s("span",et,u(d.getTypeText(a.item.type)),1),s("span",st,[t[2]||(t[2]=x(" æ‰€æŒæ•°: ",-1)),s("span",at,u(a.quantity),1),t[3]||(t[3]=x("å€‹ ",-1))])])]),a.item.type==="point_lottery"?(r(),i("button",{key:0,onClick:c=>d.openPointLotteryModal(a),disabled:e.isUsing,class:"w-full bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white font-bold py-2 px-4 rounded-lg transition-all disabled:opacity-50"}," ä½¿ç”¨ã™ã‚‹ ",8,lt)):y("",!0),a.item.description?(r(),i("div",ot,u(a.item.description),1)):y("",!0)])]))),128))]))]),m(P,{as:"template",show:e.showPointLotteryModal},{default:f(()=>[m(I,{as:"div",class:"relative z-50",onClose:d.closePointLotteryModal},{default:f(()=>[m(C,{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:f(()=>[...t[5]||(t[5]=[s("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)])]),_:1}),s("div",it,[s("div",rt,[m(C,{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:f(()=>[m(T,{class:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-al w-[496px] max-w-[90vw] sm:max-w-[75vw] my-4"},{default:f(()=>[s("div",nt,[s("div",dt,[m(L,{class:"text-xl font-bold"},{default:f(()=>[...t[6]||(t[6]=[x("ãƒã‚¤ãƒ³ãƒˆæŠ½é¸",-1)])]),_:1}),s("button",{onClick:t[0]||(t[0]=(...a)=>d.closePointLotteryModal&&d.closePointLotteryModal(...a)),disabled:e.selectingCard&&!e.lotteryResult,class:"text-gray-400 hover:text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all"},[...t[7]||(t[7]=[s("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,ct)]),s("div",null,[s("div",{class:g(e.cardCount>4?"grid grid-cols-3 md:grid-cols-4 gap-3 mb-6":"grid gap-2 mb-6"),style:U(e.cardCount<=4?{gridTemplateColumns:`repeat(${e.cardCount}, 1fr)`}:{})},[(r(!0),i(b,null,v(e.shuffledCards,(a,c)=>(r(),i("div",{key:c,class:g(["relative aspect-[2/3]",{"cursor-pointer":!e.selectingCard&&e.selectedCardIndex===null}])},[s("div",{class:g(["relative w-full h-full",{"flip-card":e.revealedCardIndex===c}])},[e.lotteryResult?y("",!0):(r(),i("button",{key:0,onClick:xt=>d.selectCard(c),disabled:e.selectingCard,class:g(["absolute inset-0 w-full h-full bg-gradient-to-br from-yellow-400 via-amber-500 to-orange-500 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",{"ring-4 ring-amber-400":e.selectedCardIndex===c}])},[...t[8]||(t[8]=[s("div",{class:"text-white text-center"},[s("div",{class:"text-4xl sm:text-6xl mb-2 font-bold"},"?")],-1)])],10,ut)),e.revealedCardIndex===c&&e.cardValues.length>0?(r(),i("div",mt,[t[9]||(t[9]=s("div",{class:"text-2xl sm:text-3xl mb-2"},"ğŸ‰",-1)),s("div",ht,u(Number(e.cardValues[c]).toLocaleString())+"pt ",1)])):y("",!0),e.lotteryResult&&e.revealedCardIndex!==c&&e.cardValues.length>0?(r(),i("div",ft,[s("div",yt,u(Number(e.cardValues[c]).toLocaleString())+"pt ",1)])):y("",!0)],2)],2))),128))],6),s("div",gt,[e.lotteryResult?(r(),i("button",{key:0,onClick:t[1]||(t[1]=(...a)=>d.closePointLotteryModal&&d.closePointLotteryModal(...a)),class:"bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white font-bold py-3 px-8 rounded-lg transition-all"}," é–‰ã˜ã‚‹ ")):(r(),i("span",pt,"ã‚«ãƒ¼ãƒ‰ã‚’1æšé¸ã‚“ã§ãã ã•ã„"))])])])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])]),_:1})],64)}const Lt=S(z,[["render",bt],["__scopeId","data-v-5b377963"]]);export{Lt as default};
