import{d as v,r as C,c as r,o as i,a as T,w as j,b as n,l as L,i as l,t as b,e as S,j as E,m as B,h as I,F as N,f as R,n as z,g as M}from"./app-eVUcwuVE.js";import{U as O}from"./UserLayout-Cp_jz6Pm.js";import{u as D}from"./useConfirm-DuLyikpD.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as G}from"./ArrowLeftIcon-pUjtkjpp.js";/* empty css            */import"./index-BvvB_mLw.js";const H=3,J="merchant.com.eve-gacha",U="apple-pay-button",Y=route("apple_pay_validate"),{alert:y}=D(),q={components:{Head:v.Head,AdminLayout:O,Link:v.Link,ArrowLeftIcon:G},props:{errors:Object,auth:Object,point:Object,is_admin:Number,amount:Number,amount_str:String,supported_pay_type:Object,rank:Object,coupon_id:Number,no_applepay_support:String,no_applepay_setting:String},data(){return{selectedMethod:null,agreeTerms:!1,loading:!1,card_payment_uri:"user.point.card_payment",payment_stage:"register",pay_type_titles:{Card:"クレジットカード",Paypay:"PayPay",Konbini:"コンビニ払い",Virtualaccount:"銀行振込",Applepay:"Apple Pay",amazonpay:"Amazon Pay",Googlepay:"Google Pay"}}},methods:{selectPaymentMethod(t){this.selectedMethod=t},handleSubmit(){if(!this.selectedMethod){y("支払い方法を選択してください");return}if(!this.agreeTerms){y("個人情報の取り扱いに同意する必要があります");return}if(!this.supported_pay_type.includes(this.selectedMethod)){y("この支払い方法は近々実装される予定です。");return}if(this.selectedMethod=="Applepay"&&!window.ApplePaySession){y(this.no_applepay_support,"","error");return}this.paymentRegister(this.selectedMethod)},submit(){},format_number(t){return String(t).replace(/(.)(?=(\d{3})+$)/g,"$1,")},paymentRegister(t){if(this.loading=!0,t=="Card"){window.location.href=route(this.card_payment_uri,{id:this.point.id,coupon_id:this.coupon_id});return}M.post(this.is_admin==1?route("test.user.point.paymentRegister"):route("user.point.paymentRegister"),{id:this.point.id,pay_type:t,coupon_id:this.coupon_id}).then(e=>{if(e.data.status==0)y(e.data.message);else if(t=="Card"||t=="Paypay"||t=="Konbini"||t=="Virtualaccount")e.data.status&&(window.location.href=e.data.link_url);else if(t=="Applepay")this.payment_stage="Applepay",this.$nextTick(()=>{const a=document.getElementById("applepay_container");a.innerHTML="",window.ApplePaySession?ApplePaySession.canMakePaymentsWithActiveCard(J).then(s=>{if(s){const c=document.createElement("button");c.setAttribute("id",U),c.setAttribute("lang","ja-JP"),c.setAttribute("style",`-webkit-appearance: -apple-pay-button;
                                                -apple-pay-button-type: buy;
                                                -apple-pay-button-style: #d68d2f;
                                                width: 220px;
                                                height: 48px;
                                                text-align: center;
                                                font-size: 18px;
                                                border-radius: 5px;
                                                `),a.appendChild(c),c.addEventListener("click",k=>{const o={countryCode:"JP",currencyCode:"JPY",supportedNetworks:["visa","masterCard","jcb","amex"],merchantCapabilities:["supports3DS"],total:{label:e.data.response.label,amount:e.data.response.amount}},p=new ApplePaySession(H,o);p.onvalidatemerchant=m=>{const _=m.validationURL;fetch(Y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({validationURL:_})}).then(u=>u.json()).then(u=>{p.completeMerchantValidation(u)})},p.oncancel=m=>{},p.onpaymentauthorized=m=>{const _=m.payment.token;p.completePayment(ApplePaySession.STATUS_SUCCESS);const u=btoa(JSON.stringify(_.paymentData));M.post(this.is_admin==1?route("test.user.point.paymentExecute"):route("user.point.paymentExecute"),{pay_type:t,order_id:e.data.response.id,access_id:e.data.response.access_id,token:u}).then(g=>{g.data.status==0?y(g.data.message):window.location.href=g.data.redirect_uri})},p.begin()})}else a.innerHTML=this.no_applepay_setting}):a.innerHTML=this.no_applepay_support});else if(t=="Googlepay"){const a=document.createElement("script");a.src="https://pay.google.com/gp/p/js/pay.js",a.onload=this.renderGooglePayButton.bind(this,e.data.response),document.head.appendChild(a)}else if(t=="amazonpay"){this.payment_stage="amazonpay";const a=document.createElement("script");a.src="https://static-fe.payments-amazon.com/checkout.js",a.onload=this.renderAmazonPayButton.bind(this,e.data.response),document.head.appendChild(a)}this.loading=!1})},renderAmazonPayButton(t){this.loading=!1,amazon.Pay.renderButton("#amazonpay_container",{merchantId:t.merchant_id,publicKeyId:t.public_key_id,ledgerCurrency:"JPY",checkoutLanguage:"ja_JP",productType:"PayOnly",placement:"Checkout",buttonColor:"Gold",buttonWidth:"300px",buttonHeight:"50px",createCheckoutSessionConfig:{payloadJSON:JSON.stringify(t.payload),signature:t.signature,algorithm:"AMZN-PAY-RSASSA-PSS-V2"}})},renderGooglePayButton(t){this.loading=!1,this.payment_stage="Googlepay";const e=new google.payments.api.PaymentsClient({environment:t.google_pay_environment}),a={apiVersion:2,apiVersionMinor:0},f={type:"PAYMENT_GATEWAY",parameters:{gateway:"fincode",gatewayMerchantId:t.shop_id}},s={merchantId:t.google_pay_merchant_id,merchantName:t.google_pay_merchant_name},c=d=>({currencyCode:"JPY",totalPrice:d,totalPriceStatus:"FINAL"}),o={type:"CARD",parameters:{allowedAuthMethods:["PAN_ONLY"],allowedCardNetworks:["VISA","MASTERCARD","JCB","AMEX","DISCOVER"],billingAddressParameters:{format:"FULL",phoneNumberRequired:!0}}},p=Object.assign({tokenizationSpecification:f},o),m=Object.assign({},a);m.allowedPaymentMethods=[p],m.transactionInfo=c(t.amount),m.merchantInfo=s;const _=(d,h)=>{const x=e.createButton({onClick:h,buttonColor:"default",buttonType:"long"});d.appendChild(x)},u=async()=>{try{const h=(await e.loadPaymentData(m)).paymentMethodData.tokenizationData.token,x=btoa(h);this.loading=!0,M.post(this.is_admin==1?route("test.user.point.paymentExecute"):route("user.point.paymentExecute"),{pay_type:"Googlepay",order_id:t.id,access_id:t.access_id,method:"1",token:x}).then(A=>{A.data.status==0?y(A.data.message):window.location.href=A.data.redirect_uri,this.loading=!1})}catch(d){console.error(d)}},g=Object.assign({},a);g.allowedPaymentMethods=[o],e.isReadyToPay(g).then(d=>{if(d.result){const h=document.getElementById("googlepay_container");h.innerHTML="",_(h,u)}}).catch(d=>{console.error(d)})}},mounted(){v.usePage().props.value.auth.user?.type==1&&(this.card_payment_uri="test.user.point.card_payment")}},F={class:"flex justify-center items-center flex-1 bg-white py-2 relative"},K={class:"text-center"},W={class:"p-6 w-full max-w-md"},X={key:0},Z={class:"text-center text-xl font-semibold text-gray-800 mb-7"},Q={key:0,class:"text-rose-500 leading-8 text-base"},$={class:"bg-gray-100 p-4 text-xl text-center mb-4"},ee={class:"text-center text-gray-600 mb-4 py-4"},te={class:"flex items-center justify-center leading-7 gap-2"},ae=["href"],ne=["onClick"],oe={key:0,class:"grid grid-cols-3 grid-rows-2 gap-1 w-24 h-10"},se={key:1,src:"/images/payments/amazon-pay.png",alt:"Amazon Pay",class:"w-24 h-10 object-contain"},ie={key:2,src:"/images/payments/apple-pay.png",alt:"Apple Pay",class:"w-24 h-10 object-contain"},re={key:3,src:"/images/payments/paypay.png",alt:"PayPay",class:"w-24 h-10 object-contain"},le={key:4,src:"/images/payments/konbini.png",alt:"Konbini",class:"w-36 h-10 object-contain"},ce={key:5,src:"/images/payments/bank.png",alt:"Bank Transfer",class:"w-24 h-10 object-contain"},de={key:6,src:"/images/payments/google-pay.svg",alt:"Google Pay",class:"w-24 h-10 object-contain"},pe=["disabled"],me={key:2,class:"fixed inset-0 flex justify-center items-center bg-gray-800 bg-opacity-75 z-[20]"},ue={key:3,class:"text-center",id:"applepay_container"},ye={key:4,class:"text-center",id:"amazonpay_container"},ge={key:5,class:"text-center",id:"googlepay_container"};function he(t,e,a,f,s,c){const w=C("Head"),P=C("ArrowLeftIcon"),k=C("AdminLayout");return i(),r(N,null,[T(w,{title:"決済登録"}),T(k,null,{default:j(()=>[n("div",F,[n("div",K,[s.payment_stage!="register"?(i(),L(P,{key:0,onClick:e[0]||(e[0]=o=>s.payment_stage="register"),class:"text-neutral-600 w-8 p-1.5 hover:bg-yellow-500 hover:text-white rounded-full cursor-pointer"})):l("",!0)]),n("div",W,[s.payment_stage=="register"?(i(),r("div",X,[n("h2",Z,[n("div",null,b(c.format_number(a.point.point))+" ポイント購入",1),a.rank&&a.rank.pt_rate>0?(i(),r("span",Q," ( + "+b(c.format_number(a.point.point*a.rank.pt_rate/100))+"pt ボーナス ) ",1)):l("",!0)]),n("div",$,b(a.amount_str)+"円 ",1),n("div",ee,[n("label",te,[E(n("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=o=>s.agreeTerms=o),class:"focus:ring-0 rounded-sm"},null,512),[[B,s.agreeTerms]]),e[3]||(e[3]=S(" 個人情報の取り扱いに同意する ",-1))]),e[4]||(e[4]=S(" （ ",-1)),n("a",{href:t.route("main.privacy_police"),class:"text-yellow-500 hover:text-yellow-600"},"取り扱いの詳細を確認する",8,ae),e[5]||(e[5]=S(" ） ",-1))])])):l("",!0),s.payment_stage=="register"?(i(),r("form",{key:1,onSubmit:e[2]||(e[2]=I((...o)=>c.handleSubmit&&c.handleSubmit(...o),["prevent"]))},[(i(!0),r(N,null,R(a.supported_pay_type,o=>(i(),r("div",{class:"mb-4",key:o},[n("button",{type:"button",onClick:p=>c.selectPaymentMethod(o),class:z([{"border-yellow-500 bg-yellow-100 font-bold text-yellow-500":s.selectedMethod===o,"hover:bg-gray-100 hover:border-gray-300":s.selectedMethod!==o},"w-full px-4 py-2.5 bg-white border-2 border-gray-200 rounded-lg flex justify-between items-center transition duration-200 hover:-translate-y-0.5"])},[n("span",null,b(s.pay_type_titles[o]),1),o==="Card"?(i(),r("div",oe,[...e[6]||(e[6]=[n("img",{src:"/images/credit_cards/visa.svg",alt:"Visa"},null,-1),n("img",{src:"/images/credit_cards/master.svg",alt:"Mastercard"},null,-1),n("img",{src:"/images/credit_cards/jcb.svg",alt:"JCB"},null,-1),n("img",{src:"/images/credit_cards/amex.svg",alt:"American Express"},null,-1),n("img",{src:"/images/credit_cards/diners.svg",alt:"Diners Club"},null,-1),n("img",{src:"/images/credit_cards/discover.svg",alt:"Discover"},null,-1)])])):l("",!0),o==="amazonpay"?(i(),r("img",se)):l("",!0),o==="Applepay"?(i(),r("img",ie)):l("",!0),o==="Paypay"?(i(),r("img",re)):l("",!0),o==="Konbini"?(i(),r("img",le)):l("",!0),o==="Virtualaccount"?(i(),r("img",ce)):l("",!0),o==="Googlepay"?(i(),r("img",de)):l("",!0)],10,ne)]))),128)),n("button",{type:"submit",disabled:s.selectedMethod==null,class:"w-full p-4 bg-yellow-500 text-white rounded-lg text-lg font-semibold transition duration-200 hover:bg-yellow-600 mt-4"}," 支払い ",8,pe)],32)):l("",!0),s.loading?(i(),r("div",me,[...e[7]||(e[7]=[n("div",{class:"w-16 h-16 bg-white p-4 rounded-full shadow-lg"},[n("svg",{class:"animate-spin h-8 w-8 text-yellow-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[n("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),n("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})])],-1)])])):l("",!0),s.payment_stage=="Applepay"?(i(),r("div",ue)):l("",!0),s.payment_stage=="amazonpay"?(i(),r("div",ye)):l("",!0),s.payment_stage=="Googlepay"?(i(),r("div",ge)):l("",!0)])])]),_:1})],64)}const Ae=V(q,[["render",he]]);export{Ae as default};
