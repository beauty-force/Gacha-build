import{p as x,B as O,q as j,l as A,o as i,w as D,c as u,i as p,b as e,e as m,h as I,j as _,v as B,t as d,n as M,F as V,f as G,Z as N,g as P}from"./app-BEiqhFTt.js";import{k as S}from"./useConfirm-23CFCG36.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},U={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0"},R={class:"inline-block align-bottom bg-white rounded-xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},H={key:0,class:"mt-1 text-sm text-red-600"},J={key:0,class:"mt-1 text-sm text-red-600"},W={class:"mt-1 text-xs text-gray-500"},Z={class:"mb-3"},Q=["disabled"],X={key:0,class:"grid grid-cols-3 gap-3"},Y=["src","alt"],ee=["onClick"],te={class:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs px-2 py-1 truncate"},oe={key:1,class:"mt-2 text-sm text-red-600"},se={class:"flex justify-end space-x-3 pt-2"},le=["disabled"],ae={key:0},re={key:1},q=3,g=10*1024*1024,C=5*1024*1024,ie={__name:"AskSupportModal",props:{isOpen:Boolean,defaultSubject:String},emits:["close"],setup(h,{emit:z}){const c=h,$=z,n=x({subject:c.defaultSubject||"",question:""}),a=x([]),s=x({}),v=x(!1),f=O(()=>a.value.reduce((o,t)=>o+t.file.size,0)),y=()=>{$("close"),w()},w=()=>{n.value={subject:"",question:""},a.value=[],s.value={}},F=o=>{const t=Array.from(o.target.files);if(s.value.images=null,a.value.length+t.length>q){s.value.images=`画像は最大${q}枚までアップロードできます`,o.target.value="";return}for(const l of t){if(!l.type.match(/^image\/(jpeg|jpg|png|gif|webp)$/)){s.value.images="対応している画像形式: JPEG, PNG, GIF, WebP";continue}if(l.size>C){s.value.images=`各画像は${b(C)}以下にしてください`;continue}const r=new FileReader;r.onload=k=>{a.value.push({file:l,preview:k.target.result}),f.value>g&&(s.value.images=`合計サイズが${b(g)}を超えています`)},r.readAsDataURL(l)}o.target.value=""},T=o=>{a.value.splice(o,1),s.value.images=null},b=o=>{if(o===0)return"0 B";const t=1024,l=["B","KB","MB","GB"],r=Math.floor(Math.log(o)/Math.log(t));return Math.round(o/Math.pow(t,r)*100)/100+" "+l[r]},L=async()=>{if(s.value={},f.value>g){s.value.images=`合計サイズが${b(g)}を超えています`;return}v.value=!0;try{const o=new FormData;o.append("subject",n.value.subject),o.append("question",n.value.question),a.value.forEach((l,r)=>{o.append(`images[${r}]`,l.file)});const t=await P.post(route("user.support-question.store"),o,{headers:{"Content-Type":"multipart/form-data"}});await S.fire({icon:"success",title:"送信完了",text:t.data.message,confirmButtonColor:"#f59e0b",confirmButtonText:"OK"}),y()}catch(o){o.response&&o.response.data.errors?s.value=o.response.data.errors:await S.fire({icon:"error",title:"エラー",text:"送信に失敗しました。もう一度お試しください。",confirmButtonColor:"#f59e0b",confirmButtonText:"OK"})}finally{v.value=!1}};return j(()=>c.isOpen,o=>{o?c.defaultSubject&&(n.value.subject=c.defaultSubject):w()}),j(()=>c.defaultSubject,o=>{o&&c.isOpen&&(n.value.subject=o)}),(o,t)=>(i(),A(N,{name:"modal"},{default:D(()=>[h.isOpen?(i(),u("div",K,[e("div",U,[t[10]||(t[10]=e("div",{class:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75"},null,-1)),e("div",R,[e("div",{class:"bg-gradient-to-r from-yellow-400 to-amber-500 px-6 py-4"},[e("div",{class:"flex items-center justify-between"},[t[3]||(t[3]=e("h3",{class:"text-xl font-bold text-white flex items-center"},[e("svg",{class:"w-6 h-6 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),m(" サポートへ質問 ")],-1)),e("button",{onClick:y,class:"text-white hover:text-yellow-100 transition-colors"},[...t[2]||(t[2]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("form",{onSubmit:I(L,["prevent"]),class:"px-6 py-5 space-y-4"},[e("div",null,[t[4]||(t[4]=e("label",{for:"subject",class:"block text-sm font-semibold text-gray-700 mb-1"},[m(" 件名 "),e("span",{class:"text-red-500"},"*")],-1)),_(e("input",{id:"subject","onUpdate:modelValue":t[0]||(t[0]=l=>n.value.subject=l),type:"text",placeholder:"質問の件名を入力してください",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400",required:""},null,512),[[B,n.value.subject]]),s.value.subject?(i(),u("p",H,d(s.value.subject),1)):p("",!0)]),e("div",null,[t[5]||(t[5]=e("label",{for:"question",class:"block text-sm font-semibold text-gray-700 mb-1"},[m(" 質問内容 "),e("span",{class:"text-red-500"},"*")],-1)),_(e("textarea",{id:"question","onUpdate:modelValue":t[1]||(t[1]=l=>n.value.question=l),rows:"6",placeholder:"お困りの内容を詳しくお書きください",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400 resize-none",required:""},null,512),[[B,n.value.question]]),s.value.question?(i(),u("p",J,d(s.value.question),1)):p("",!0),e("p",W,d(n.value.question.length)+"/2000文字",1)]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[m(" 画像を添付 "),e("span",{class:"text-gray-500 text-xs font-normal"},"(任意、最大3枚、合計10MB)")],-1)),e("div",Z,[e("label",{for:"image-upload",class:M([{"opacity-50 cursor-not-allowed":a.value.length>=3,"cursor-pointer hover:bg-gray-50":a.value.length<3},"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white transition-colors"])},[t[6]||(t[6]=e("svg",{class:"w-5 h-5 mr-2 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),m(" 画像を選択 ("+d(a.value.length)+"/3) ",1)],2),e("input",{id:"image-upload",type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp",multiple:"",onChange:F,disabled:a.value.length>=3,class:"hidden"},null,40,Q)]),a.value.length>0?(i(),u("div",X,[(i(!0),u(V,null,G(a.value,(l,r)=>(i(),u("div",{key:r,class:"relative group aspect-square bg-gray-100 rounded-lg overflow-hidden border-2 border-gray-200"},[e("img",{src:l.preview,alt:`Preview ${r+1}`,class:"w-full h-full object-cover"},null,8,Y),e("button",{type:"button",onClick:k=>T(r),class:"absolute top-1 right-1 p-1 bg-red-500 hover:bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-lg",title:"削除"},[...t[7]||(t[7]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,ee),e("div",te,d(l.file.name),1)]))),128))])):p("",!0),s.value.images?(i(),u("p",oe,d(s.value.images),1)):p("",!0),f.value>0?(i(),u("p",{key:2,class:M(["mt-2 text-xs",f.value>g?"text-red-600":"text-gray-500"])}," 合計サイズ: "+d(b(f.value))+" / "+d(b(g)),3)):p("",!0)]),t[9]||(t[9]=e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-3"},[e("p",{class:"text-sm text-gray-700"},[e("strong",null,"ご注意:"),m(" 通常、1-2営業日以内に回答いたします。 ")])],-1)),e("div",se,[e("button",{type:"button",onClick:y,class:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold rounded-lg transition-colors"}," キャンセル "),e("button",{type:"submit",disabled:v.value,class:"px-5 py-2 bg-gradient-to-r from-yellow-400 to-amber-500 hover:from-yellow-500 hover:to-amber-600 text-white font-semibold rounded-lg transition-all duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"},[v.value?(i(),u("span",ae,"送信中...")):(i(),u("span",re,"送信する"))],8,le)])],32)])])])):p("",!0)]),_:1}))}},ce=E(ie,[["__scopeId","data-v-135cfacd"]]);export{ce as A};
