import{o as n,c as l,d as t,t as i,h as b,G as C,q as y,i as E,w,b as p,D as m,H,F as v,f as $,I as j,n as D,e as z,J as q,ab as G,a as O}from"./app.aa6ed063.js";import{A as R}from"./UserLayout.5ac9cc72.js";import{u as T}from"./useConfirm.8d6332a6.js";import{o as V,f as U}from"./Category.0dc24397.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./index.e535cc43.js";const K={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Q={class:"flex flex-col items-center"},W=t("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-theme"},null,-1),X={class:"mt-2 text-white text-sm"},Y={__name:"Loading",props:{show:{type:Boolean,default:!1},message:{type:String,default:"\u8AAD\u307F\u8FBC\u307F\u4E2D..."}},setup(s){return(x,g)=>s.show?(n(),l("div",K,[t("div",Q,[W,t("p",X,i(s.message),1)])])):b("",!0)}},Z={class:"py-4"},tt={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},et={class:"bg-white overflow-hidden"},st={class:"p-6 bg-white border-gray-200"},ot={key:0,class:"text-lg font-semibold mb-6"},it={key:1,class:"mb-8 p-6 bg-blue-50 rounded-lg"},nt={class:"flex flex-wrap justify-between md:grid md:grid-cols-3 gap-4"},at=t("p",{class:"text-sm text-blue-600"},"\u30D7\u30E9\u30F3\u540D",-1),lt={class:"font-medium"},rt=t("p",{class:"text-sm text-blue-600"},"\u958B\u59CB\u65E5",-1),ct={class:"font-medium"},dt=t("p",{class:"text-sm text-blue-600"},"\u4ED8\u4E0E\u30DD\u30A4\u30F3\u30C8",-1),ut={class:"font-medium"},mt={class:"flex flex-wrap items-end justify-between mt-3"},bt={key:0,class:"flex items-center py-2"},ft={class:"flex items-center gap-1"},ht=["src","alt"],_t={class:"font-medium"},pt={class:"text-sm text-gray-500"},vt={class:"text-xs text-gray-500"},xt=["disabled"],gt=t("h3",{class:"text-lg font-semibold mb-6"},"\u5229\u7528\u53EF\u80FD\u306A\u30D7\u30E9\u30F3",-1),yt={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},wt={class:"text-xl font-bold mb-2"},St={class:"text-gray-600 mb-4"},kt={class:"mb-4"},Ct={class:"text-xl font-bold leading-8"},$t=t("span",{class:"text-sm font-normal"},"/\u6708",-1),jt={class:"text-green-600 text-sm"},Dt={class:"text-rose-500 text-sm leading-7 font-bold"},Ft=["onSubmit"],Nt=["disabled"],Bt={class:"py-3 px-1 text-center"},Lt={class:"font-bold text-lg"},zt={class:"text-lg font-bold text-theme mt-1"},Vt=t("span",{class:"text-sm font-normal"},"/\u6708",-1),At={class:"p-2"},It={key:0,class:"text-sm text-gray-500 mb-2"},Mt={key:1,class:"space-y-2"},Jt=["onClick"],Pt=["id","value"],Et=["for"],Ht={class:"flex items-center"},qt=["src","alt"],Gt={class:"font-medium"},Ot={class:"text-sm text-gray-500"},Rt={class:"text-xs text-gray-500"},Tt={key:2,class:"text-gray-500 mb-2"},Ut=t("hr",{class:"my-1"},null,-1),Kt={class:"flex justify-between p-2 gap-2"},Qt=["disabled"],se={__name:"Index",props:{plans:Array,currentSubscription:Object,cards:Array},setup(s){const x=s,{confirm:g}=T(),S=C({}),k=y(!1),r=y(""),d=y(null),c=y(!1),f=e=>new Intl.NumberFormat("ja-JP").format(e),A=e=>new Date(e).toLocaleDateString("ja-JP"),F=e=>`/images/credit_cards/${e.toLowerCase()}.svg`,N=e=>e.replace(/(.{4})/g,"$1 ").trim(),B=e=>`${e.slice(0,2)}/${e.slice(2)}`,I=()=>{g("\u89E3\u7D04\u3057\u307E\u3059\u304B\uFF1F \u89E3\u7D04\u5F8C\u30011\u30F6\u6708\u9593\u767B\u9332\u306F\u3067\u304D\u307E\u305B\u3093\u3002").then(e=>{e&&(c.value=!0,S.post(route("user.subscription.cancel",x.currentSubscription.id),{onFinish:()=>{c.value=!1}}))})},M=()=>{c.value=!0,O.get(route("user.point.card_register",{type:"subscription"})).then(e=>{c.value=!1,e.data.status==1&&(window.location.href=e.data.link_url)}).catch(()=>{c.value=!1})},J=e=>{d.value=e,k.value=!0},h=()=>{k.value=!1,r.value="",d.value=null},P=()=>{d.value&&r.value&&(x.currentSubscription?g("\u30D7\u30E9\u30F3\u3092\u5909\u66F4\u3057\u307E\u3059\u304B\uFF1F","\u30A2\u30C3\u30D7\u30B0\u30EC\u30FC\u30C9\u306E\u5834\u5408\u3001\u73FE\u5728\u306E\u30D7\u30E9\u30F3\u3068\u306E\u5DEE\u984D\u5206\u304C\u8ACB\u6C42\u3055\u308C\u3001\u8ACB\u6C42\u65E5\u304C\u4ECA\u65E5\u306B\u5909\u66F4\u3055\u308C\u307E\u3059\u3002<br/>\u30C0\u30A6\u30F3\u30B0\u30EC\u30FC\u30C9\u307E\u305F\u306F\u30AB\u30FC\u30C9\u5909\u66F4\u306E\u5834\u5408\u3001\u8ACB\u6C42\u65E5\u306F\u5909\u66F4\u3055\u308C\u305A\u3001\u6B21\u306E\u8ACB\u6C42\u65E5\u306B\u65B0\u3057\u3044\u30D7\u30E9\u30F3\u306E\u91D1\u984D\u304C\u8ACB\u6C42\u3055\u308C\u307E\u3059\u3002").then(e=>{e&&(c.value=!0,C({plan_id:d.value.id,card_id:r.value}).post(route("user.subscription.update",x.currentSubscription.id),{onFinish:()=>{c.value=!1,h()},preserveScroll:!0}))}):g("\u30B5\u30D6\u30B9\u30AF\u30EA\u30D7\u30B7\u30E7\u30F3\u306B\u767B\u9332\u3057\u307E\u3059\u304B\uFF1F").then(e=>{e&&(c.value=!0,C({card_id:r.value}).post(route("user.subscription.subscribe",d.value.id),{onFinish:()=>{c.value=!1,h()},preserveScroll:!0}))}))};return(e,u)=>(n(),E(R,null,{default:w(()=>[p(m(H),{title:"\u30B5\u30D6\u30B9\u30AF\u30EA\u30D7\u30B7\u30E7\u30F3"}),p(Y,{show:c.value},null,8,["show"]),t("div",Z,[t("div",tt,[t("div",et,[t("div",st,[s.currentSubscription?(n(),l("h3",ot,"\u73FE\u5728\u306E\u30B5\u30D6\u30B9\u30AF\u30EA\u30D7\u30B7\u30E7\u30F3")):b("",!0),s.currentSubscription?(n(),l("div",it,[t("div",nt,[t("div",null,[at,t("p",lt,i(s.currentSubscription.plan.name),1)]),t("div",null,[rt,t("p",ct,i(A(s.currentSubscription.start_date)),1)]),t("div",null,[dt,t("p",ut,i(f(s.currentSubscription.plan.point))+" pt",1)])]),t("div",mt,[(n(!0),l(v,null,$(s.cards,o=>(n(),l(v,null,[s.currentSubscription.card_id===o.id?(n(),l("div",bt,[t("div",ft,[t("img",{src:F(o.brand),alt:o.brand,class:"w-20 h-12 mr-2"},null,8,ht),t("div",null,[t("p",_t,i(N(o.card_no)),1),t("p",pt,"\u6709\u52B9\u671F\u9650: "+i(B(o.expire)),1),t("p",vt,"\u540D\u7FA9\u4EBA: "+i(o.holder_name),1)])])])):b("",!0)],64))),256)),t("form",{onSubmit:u[0]||(u[0]=j(o=>I(),["prevent"])),class:"mt-4"},[t("button",{type:"submit",class:"bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-4 rounded text-sm",disabled:m(S).processing}," \u89E3\u7D04 ",8,xt)],32)])])):b("",!0),gt,t("div",yt,[(n(!0),l(v,null,$(s.plans,o=>{var _;return n(),l("div",{key:o.id,class:D(["border rounded-lg p-6",{"bg-yellow-50 border-yellow-500 border-2":((_=s.currentSubscription)==null?void 0:_.plan_id)===o.id}])},[t("h4",wt,i(o.name),1),t("p",St,i(o.description),1),t("div",kt,[t("p",Ct,[z("\xA5"+i(f(o.amount)),1),$t]),t("p",jt,i(f(o.point))+" \u30DD\u30A4\u30F3\u30C8\u4ED8\u4E0E",1),t("p",Dt,i(f(o.point-o.amount))+" pt\u304A\u5F97!!",1)]),t("div",null,[t("form",{onSubmit:j(a=>J(o),["prevent"])},[t("button",{type:"submit",class:"w-full bg-theme bg-theme-hover text-white font-bold py-2 px-4 rounded text-sm",disabled:m(S).processing},i(s.currentSubscription?s.currentSubscription.plan_id!=o.id?"\u30D7\u30E9\u30F3\u5909\u66F4":"\u30AB\u30FC\u30C9\u5909\u66F4":"\u30B5\u30D6\u30B9\u30AF\u30E9\u30A4\u30D6"),9,Nt)],40,Ft)])],2)}),128))])])])])]),p(m(U),{show:k.value,class:""},{default:w(()=>[p(m(V),{enter:"transition ease-in-out duration-200 transform","enter-from":"translate-y-full","enter-to":"translate-y-0",leave:"transition ease-in-out duration-200 transform","leave-from":"translate-y-0","leave-to":"translate-y-full",as:"template"},{default:w(()=>{var o,_;return[t("div",{class:"fixed inset-0 z-40",onClick:h},[t("div",{class:"flex flex-col text-neutral-700 rounded relative z-20 top-20 w-fit min-w-64 px-4 bg-neutral-50 border-l border-neutral-200 m-auto max-w-[90%] py-2",onClick:u[2]||(u[2]=j(()=>{},["stop"]))},[t("div",Bt,[t("div",Lt,i((o=d.value)==null?void 0:o.name),1),t("div",zt,[z("\xA5 "+i(f((_=d.value)==null?void 0:_.amount)),1),Vt])]),t("div",At,[s.cards.length>0?(n(),l("div",It,"\u304A\u652F\u6255\u3044\u30AB\u30FC\u30C9\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044")):b("",!0),s.cards.length>0?(n(),l("div",Mt,[(n(!0),l(v,null,$(s.cards,a=>(n(),l(v,{key:a.id},[!s.currentSubscription||d.value&&d.value.id!=s.currentSubscription.plan_id||a.id!=s.currentSubscription.card_id?(n(),l("div",{key:0,class:D([{"border-yellow-500 bg-yellow-50 border-2":r.value===a.id,"hover:bg-gray-50 hover:border-gray-300":r.value!==a.id},"flex items-center p-2 border rounded cursor-pointer"]),onClick:L=>r.value=a.id},[q(t("input",{type:"radio",id:"card-"+a.id,value:a.id,"onUpdate:modelValue":u[1]||(u[1]=L=>r.value=L),class:"mr-2 focus:ring-0 focus:ring-offset-0"},null,8,Pt),[[G,r.value]]),t("label",{for:"card-"+a.id,class:"flex-1 cursor-pointer"},[t("div",Ht,[t("img",{src:F(a.brand),alt:a.brand,class:"w-20 h-12 mr-2"},null,8,qt),t("div",null,[t("p",Gt,i(N(a.card_no)),1),t("p",Ot,"\u6709\u52B9\u671F\u9650: "+i(B(a.expire)),1),t("p",Rt,"\u540D\u7FA9\u4EBA: "+i(a.holder_name),1)])])],8,Et)],10,Jt)):b("",!0)],64))),128))])):(n(),l("div",Tt," \u767B\u9332\u6E08\u307F\u306E\u30AB\u30FC\u30C9\u304C\u3042\u308A\u307E\u305B\u3093 "))]),Ut,t("button",{onClick:M,class:"text-blue-500 hover:text-blue-700 text-sm p-2"}," + \u65B0\u3057\u3044\u30AB\u30FC\u30C9\u3092\u767B\u9332 "),t("div",Kt,[t("button",{onClick:h,class:"bg-gray-300 text-gray-700 flex-1 py-2 rounded text-sm"}," \u30AD\u30E3\u30F3\u30BB\u30EB "),t("button",{onClick:P,class:D(["bg-theme text-white flex-1 py-2 rounded text-sm",{"opacity-50":!r.value}]),disabled:!r.value}," \u78BA\u8A8D ",10,Qt)])])])]}),_:1}),p(m(V),{enter:"transition-opacity ease-linear duration-200","enter-from":"opacity-0","enter-to":"opacity-100",leave:"transition-opacity ease-linear duration-200","leave-from":"opacity-100","leave-to":"opacity-0",class:"fixed inset-0 z-30"},{default:w(()=>[t("div",{class:"bg-neutral-600 h-full bg-opacity-50",onClick:h})]),_:1})]),_:1},8,["show"])]),_:1}))}};export{se as default};
