import{p as c,c as n,o as a,a as x,u as I,d as B,w as _,b as e,e as $,i as v,t as i,n as S,F as h,f as y,j as L,k as P,h as w,v as Z,Z as G,g as D}from"./app-CT1Wwlkh.js";import{d as V}from"./index-DdfP3-Kk.js";import{A as K}from"./Admin-DF8nCgVH.js";import{k as C}from"./useConfirm-DQO9RPtQ.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"py-3"},X={class:"w-full"},Y={class:"px-4 sm:px-6 py-1"},ee={class:"bg-white shadow-sm sm:rounded-lg"},te={class:"p-3 sm:p-6 text-gray-900"},se={class:"mb-6 pb-6 border-b border-gray-200"},oe={class:"flex items-start justify-between mb-4"},le={class:"space-y-1"},ne={class:"text-lg font-bold text-gray-900 mb-2"},ae={class:"flex items-center space-x-4 text-sm text-gray-500 px-2"},ie={class:"bg-gray-50 rounded-lg p-4"},re={class:"text-gray-700 whitespace-pre-line mb-4"},de={key:0,class:"mt-4"},ue={class:"text-sm font-semibold text-gray-700 mb-2"},ce={class:"grid grid-cols-2 md:grid-cols-3 gap-3"},ge=["onClick"],me=["src","alt"],fe={key:0,class:"space-y-4 mb-6"},pe={class:"text-base font-bold text-gray-900 flex items-center border-b pb-2"},ve={key:0,class:"flex-1 flex justify-end"},he={class:"max-w-[80%] bg-blue-50 border border-blue-200 rounded-lg p-3"},be={class:"flex items-center gap-2 mb-2"},xe={class:"text-xs font-bold text-blue-700"},ye={class:"text-xs text-gray-500"},we={class:"text-sm text-gray-800 whitespace-pre-line"},ke={key:0,class:"mt-2 grid grid-cols-3 gap-2"},qe=["src","onClick"],_e={key:1,class:"flex-1"},Ce={class:"max-w-[80%] bg-gray-100 border border-gray-300 rounded-lg p-3"},je={class:"flex items-center gap-2 mb-2"},Me={class:"text-xs font-bold text-gray-700"},Ie={class:"text-xs text-gray-500"},Be={class:"text-sm text-gray-800 whitespace-pre-line"},$e={key:0,class:"mt-2 grid grid-cols-3 gap-2"},Se=["src","onClick"],ze={class:"space-y-4 border-t pt-4 mb-6"},Le={class:"flex items-end gap-3"},De={class:"flex-1"},Ve=["disabled"],Ee={key:0,class:"mt-2 grid grid-cols-3 gap-2"},Te=["src"],Ae=["onClick"],Fe={class:"flex justify-end"},Ne=["disabled"],Oe={class:"flex flex-col items-center justify-center h-screen p-4 gap-2"},Re={class:"relative z-10 flex items-center justify-center gap-4 w-full max-w-6xl flex-shrink-0"},Ue={class:"px-4 py-2 bg-white rounded-full text-gray-900 text-sm font-bold shadow-xl"},He={class:"flex-1 flex justify-end"},Je={class:"relative z-10 flex flex-col items-center w-full max-w-6xl flex-1 min-h-0 gap-2"},Pe={class:"flex-1 flex items-center justify-center min-h-0 w-full"},Ze=["src"],Ge={class:"flex items-center justify-center gap-3 flex-shrink-0"},Ke=["disabled"],Qe=["disabled"],We={__name:"Show",props:{question:Object},setup(l){const u=l,f=c(null),r=c(0),p=c(""),g=c([]),E=c(null),k=c(!1),b=c(u.question.status),q=c(!1),j=o=>{const t=[...u.question.images||[],...u.question.replies.flatMap(s=>s.images||[])];f.value=o,r.value=t.indexOf(o)},T=()=>{const o=[...u.question.images||[],...u.question.replies.flatMap(t=>t.images||[])];r.value<o.length-1&&(r.value++,f.value=o[r.value])},A=()=>{if(r.value>0){const o=[...u.question.images||[],...u.question.replies.flatMap(t=>t.images||[])];r.value--,f.value=o[r.value]}},z=()=>{f.value=null},F=o=>{const t=Array.from(o.target.files);if(g.value.length+t.length>3){alert("画像は最大3枚までです");return}t.forEach(s=>{const d=new FileReader;d.onload=m=>{g.value.push({file:s,preview:m.target.result})},d.readAsDataURL(s)}),o.target.value=""},N=o=>{g.value.splice(o,1)},O=()=>{let o=(u.question.images||[]).length;return u.question.replies&&u.question.replies.forEach(t=>{o+=(t.images||[]).length}),o},R=async()=>{if(b.value!==u.question.status){q.value=!0;try{await D.post(route("admin.support-questions.update-status",u.question.id),{status:b.value,admin_response:""}),await C.fire({icon:"success",title:"ステータス更新完了",text:"ステータスを更新しました",confirmButtonColor:"#3b82f6"}),V.Inertia.reload()}catch{await C.fire({icon:"error",title:"エラー",text:"ステータスの更新に失敗しました"})}finally{q.value=!1}}},U=async()=>{if(!p.value.trim())return;k.value=!0;const o=new FormData;o.append("message",p.value),g.value.forEach((t,s)=>{o.append(`images[${s}]`,t.file)});try{await D.post(route("admin.support-questions.reply",u.question.id),o,{headers:{"Content-Type":"multipart/form-data"}}),await C.fire({icon:"success",title:"送信完了",text:"返信を送信しました",confirmButtonColor:"#3b82f6"}),p.value="",g.value=[],V.Inertia.reload()}catch{await C.fire({icon:"error",title:"エラー",text:"送信に失敗しました"})}finally{k.value=!1}},H=o=>({pending:"対応中",answered:"完了",closed:"クローズ"})[o]||o,M=o=>new Date(o).toLocaleDateString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return(o,t)=>(a(),n(h,null,[x(I(B.Head),{title:"サポート質問詳細"}),x(K,null,{default:_(()=>[e("div",W,[e("div",X,[e("div",Y,[x(I(B.Link),{href:o.route("admin.support-questions.index"),class:"inline-flex items-center text-gray-600 hover:text-yellow-600 font-semibold"},{default:_(()=>[...t[4]||(t[4]=[e("svg",{class:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),$(" 質問一覧に戻る ",-1)])]),_:1},8,["href"])]),e("div",ee,[e("div",te,[e("div",se,[e("div",oe,[e("div",le,[e("h3",ne,i(l.question.subject),1),e("div",ae,[e("span",null,i(M(l.question.created_at)),1),t[5]||(t[5]=e("span",null,"•",-1)),x(I(B.Link),{href:o.route("admin.users.detail",l.question.user_id),class:"text-blue-600 hover:text-blue-800 underline"},{default:_(()=>[e("span",null,i(l.question.name)+" ("+i(l.question.email)+")",1)]),_:1},8,["href"])])]),e("span",{class:S({"my-1 px-3 py-1 text-xs font-semibold rounded-full text-nowrap":!0,"bg-yellow-100 text-yellow-800":l.question.status==="pending","bg-green-100 text-green-800":l.question.status==="answered","bg-gray-100 text-gray-800":l.question.status==="closed"})},i(H(l.question.status)),3)]),e("div",ie,[e("p",re,i(l.question.question),1),l.question.images&&l.question.images.length>0?(a(),n("div",de,[e("h4",ue,"添付画像 ("+i(l.question.images.length)+")",1),e("div",ce,[(a(!0),n(h,null,y(l.question.images,(s,d)=>(a(),n("div",{key:d,class:"relative group bg-white rounded-lg overflow-hidden border border-gray-200 hover:border-yellow-400 transition-all cursor-pointer",onClick:m=>j(s)},[e("img",{src:`/images/support_questions/${s}`,alt:`添付画像 ${d+1}`,class:"w-full h-full object-contain"},null,8,me),t[6]||(t[6]=e("div",{class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-opacity flex items-center justify-center pointer-events-none"},[e("svg",{class:"w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))],8,ge))),128))])])):v("",!0)])]),l.question.replies&&l.question.replies.length>0?(a(),n("div",fe,[e("h3",pe,[t[7]||(t[7]=e("svg",{class:"w-5 h-5 mr-2 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1)),$(" 会話履歴 ("+i(l.question.replies.length)+") ",1)]),(a(!0),n(h,null,y(l.question.replies,s=>(a(),n("div",{key:s.id,class:"flex gap-3"},[s.is_admin?(a(),n("div",ve,[e("div",he,[e("div",be,[t[8]||(t[8]=e("svg",{class:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"})],-1)),e("span",xe,"サポート ("+i(s.user.name)+")",1),e("span",ye,i(M(s.created_at)),1)]),e("p",we,i(s.message),1),s.images&&s.images.length>0?(a(),n("div",ke,[(a(!0),n(h,null,y(s.images,(d,m)=>(a(),n("img",{key:m,src:`/images/support_questions/${d}`,class:"w-full h-20 object-cover rounded cursor-pointer",onClick:J=>j(d)},null,8,qe))),128))])):v("",!0)])])):(a(),n("div",_e,[e("div",Ce,[e("div",je,[t[9]||(t[9]=e("svg",{class:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),e("span",Me,i(s.user.name),1),e("span",Ie,i(M(s.created_at)),1)]),e("p",Be,i(s.message),1),s.images&&s.images.length>0?(a(),n("div",$e,[(a(!0),n(h,null,y(s.images,(d,m)=>(a(),n("img",{key:m,src:`/images/support_questions/${d}`,class:"w-full h-20 object-cover rounded cursor-pointer",onClick:J=>j(d)},null,8,Se))),128))])):v("",!0)])]))]))),128))])):v("",!0),e("div",ze,[t[12]||(t[12]=e("h3",{class:"text-base font-bold text-gray-900"},"ステータス管理",-1)),e("div",Le,[e("div",De,[t[11]||(t[11]=e("label",{for:"status-only",class:"block text-sm font-medium text-gray-700 mb-2"}," ステータス ",-1)),L(e("select",{id:"status-only","onUpdate:modelValue":t[0]||(t[0]=s=>b.value=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400"},[...t[10]||(t[10]=[e("option",{value:"pending"},"対応中",-1),e("option",{value:"answered"},"完了",-1),e("option",{value:"closed"},"クローズ",-1)])],512),[[P,b.value]])]),e("button",{onClick:R,disabled:q.value||b.value===l.question.status,class:"px-6 py-2 bg-gradient-to-r from-yellow-500 to-amber-600 hover:from-yellow-600 hover:to-amber-700 text-white font-semibold rounded-lg transition-all duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"},i(q.value?"更新中...":"ステータス更新"),9,Ve)])]),e("form",{onSubmit:w(U,["prevent"]),class:"space-y-4 border-t pt-4"},[t[15]||(t[15]=e("h3",{class:"text-base font-bold text-gray-900"},"返信を送信",-1)),e("div",null,[L(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>p.value=s),rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400",placeholder:"返信メッセージを入力してください...",required:""},null,512),[[Z,p.value]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[$(" 画像を添付 "),e("span",{class:"text-gray-500 text-xs font-normal"},"(任意、最大3枚)")],-1)),e("input",{type:"file",ref_key:"imageInput",ref:E,accept:"image/*",multiple:"",onChange:F,class:"hidden"},null,544),e("button",{type:"button",onClick:t[2]||(t[2]=s=>o.$refs.imageInput.click()),class:"px-4 py-2 border border-gray-300 rounded-lg text-sm text-gray-700 hover:bg-gray-50"}," 画像を選択 "),g.value.length>0?(a(),n("div",Ee,[(a(!0),n(h,null,y(g.value,(s,d)=>(a(),n("div",{key:d,class:"relative"},[e("img",{src:s.preview,class:"w-full h-20 object-cover rounded"},null,8,Te),e("button",{type:"button",onClick:m=>N(d),class:"absolute top-0 right-0 bg-red-500 text-white rounded-full p-1"},[...t[13]||(t[13]=[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Ae)]))),128))])):v("",!0)]),e("div",Fe,[e("button",{type:"submit",disabled:k.value||!p.value.trim(),class:"px-6 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold rounded-lg transition-all duration-200 shadow-md hover:shadow-lg disabled:opacity-50"},i(k.value?"送信中...":"返信する"),9,Ne)])],32)])])])])]),_:1}),x(G,{name:"modal"},{default:_(()=>[f.value?(a(),n("div",{key:0,class:"fixed inset-0 z-[9999]",onClick:z},[e("div",Oe,[t[20]||(t[20]=e("div",{class:"fixed inset-0 bg-gray-900 bg-opacity-90 transition-opacity"},null,-1)),e("div",Re,[t[17]||(t[17]=e("div",{class:"flex-1"},null,-1)),e("div",Ue,i(r.value+1)+" / "+i(O()),1),e("div",He,[e("button",{onClick:w(z,["stop"]),class:"p-3 bg-white rounded-full hover:bg-gray-100 transition-colors shadow-xl",type:"button",title:"閉じる"},[...t[16]||(t[16]=[e("svg",{class:"w-6 h-6 text-gray-800",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",Je,[e("div",Pe,[e("img",{src:`/images/support_questions/${f.value}`,alt:"拡大画像",class:"max-w-full max-h-full w-auto h-auto object-contain rounded-lg shadow-2xl border-4 border-white",onClick:t[3]||(t[3]=w(()=>{},["stop"]))},null,8,Ze)]),e("div",Ge,[e("button",{onClick:w(A,["stop"]),disabled:r.value===0,class:S({"p-3 rounded-full transition-all shadow-xl group":!0,"bg-white hover:bg-gray-100":r.value>0,"bg-gray-300 cursor-not-allowed opacity-50":r.value===0}),type:"button",title:"前へ"},[...t[18]||(t[18]=[e("svg",{class:"w-6 h-6 text-gray-800 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",d:"M15 19l-7-7 7-7"})],-1)])],10,Ke),e("button",{onClick:w(T,["stop"]),disabled:r.value>=l.question.images.length-1,class:S({"p-3 rounded-full transition-all shadow-xl group":!0,"bg-white hover:bg-gray-100":r.value<l.question.images.length-1,"bg-gray-300 cursor-not-allowed opacity-50":r.value>=l.question.images.length-1}),type:"button",title:"次へ"},[...t[19]||(t[19]=[e("svg",{class:"w-6 h-6 text-gray-800 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",d:"M9 5l7 7-7 7"})],-1)])],10,Qe)])])])])):v("",!0)]),_:1})],64))}},ot=Q(We,[["__scopeId","data-v-353213eb"]]);export{ot as default};
